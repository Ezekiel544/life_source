!function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).Settings=function(){}}(FT=FT||{}),function(t){!function(t){function e(t,e,i){i.state("toolbar",{abstract:!0,resolve:{translationsLoaded:["$translate","$stateParams",function(t,e){return t.getApiPromise(e.uid,e.culture).then(function(t){return t})}]},views:{main:{controller:"toolbarController",controllerAs:"ctrl",templateUrl:"/app/widgets/side/views/toolbar.html"}}}),i.state("multi",{cache:!1,url:"/side/:culture/:uid/multi",templateUrl:"/app/widgets/side/views/multi.html",controller:"multiController",controllerAs:"ctrl",parent:"toolbar"}),i.state("book",{cache:!1,url:"/side/:culture/:uid/book?voucherCode&partysize&waitlistItem&date&time&searchTickets",templateUrl:"/app/widgets/side/views/book.html",controller:"bookController",controllerAs:"ctrl",parent:"toolbar"}),i.state("redeem",{url:"/side/:culture/:uid/redeem",templateUrl:"/app/widgets/side/views/redeem.html",controller:"redeemController",controllerAs:"ctrl",parent:"toolbar"}),i.state("ticket",{cache:!1,url:"/side/:culture/:uid/ticket/:ticketId?partysize&waitlistItem&date&time",templateUrl:"/app/widgets/side/views/ticket.html",controller:"ticketController",controllerAs:"ctrl",params:{from:null},parent:"toolbar"}),i.state("vouchers",{url:"/side/:culture/:uid/vouchers",templateUrl:"/app/widgets/side/views/vouchers.html",controller:"vouchersController",controllerAs:"ctrl",parent:"toolbar"}),i.state("takeaway",{url:"/side/:culture/:uid/takeaway?productUid",templateUrl:"/app/widgets/side/views/takeaway.html",controller:"takeAwayController",controllerAs:"ctrl",parent:"toolbar"}),i.state("terms",{url:"/side/:culture/:uid/terms",templateUrl:"/app/widgets/side/views/terms.html",controller:"termsController",controllerAs:"ctrl",parent:"toolbar"}),i.state("help",{url:"/side/:culture/:uid/help",templateUrl:"/app/widgets/side/views/help.html",controller:"helpController",controllerAs:"ctrl",parent:"toolbar"}),i.state("group",{url:"/side/:culture/:uid/group",templateUrl:"/app/widgets/side/views/group.html",controller:"groupController",controllerAs:"ctrl",parent:"toolbar"}),i.state("error",{url:"/side/:culture/:uid/error",params:{errorMessage:null,errorCode:null},templateUrl:"/app/widgets/side/views/error.html",controller:"errorController",controllerAs:"ctrl",parent:"toolbar"}),i.state("checkout",{url:"/side/:culture/:uid/checkout",templateUrl:"/app/widgets/side/views/checkout.html",controller:"checkoutController",controllerAs:"ctrl",parent:"toolbar"}),i.state("waitlist",{url:"/side/:culture/:uid/waitlist",templateUrl:"/app/widgets/side/views/waitlist.html",controller:"waitlistController",controllerAs:"ctrl",parent:"toolbar"}),i.state("voucherCheckout",{url:"/side/:culture/:uid/voucher/checkout/:productUid",templateUrl:"/app/widgets/side/views/voucherCheckout.html",controller:"voucherCheckoutController",controllerAs:"ctrl",parent:"toolbar",resolve:{product:["apiService","$stateParams",function(t,e){return e.productUid?t.getProduct(e.uid,e.productUid).then(function(t){return t.data}):null}]}}),i.state("takeAwayCheckout",{url:"/side/:culture/:uid/takeaway/checkout",templateUrl:"/app/widgets/side/views/takeAwayCheckout.html",controller:"takeAwayCheckoutController",controllerAs:"ctrl",parent:"toolbar",resolve:{product:["apiService","$stateParams",function(t,e){return e.productUid?t.getProduct(e.uid,e.productUid).then(function(t){return t.data}):null}]}}),i.state("option",{url:"/side/:culture/:uid/option?optionId&accept&message",templateUrl:"/app/widgets/side/views/option.html",controller:"optionController",controllerAs:"ctrl",parent:"toolbar"}),i.state("finish",{url:"/side/:culture/:uid/finish?booking&type&paymentRequired&option-action&ft-booking&order",templateUrl:"/app/widgets/side/views/finish.html",controller:"finishController",controllerAs:"ctrl",parent:"toolbar"}),i.state("voucherFinish",{url:"/side/:culture/:uid/voucher/finish?type&order&paymentRequired",templateUrl:"/app/widgets/side/views/voucherFinish.html",controller:"voucherFinishController",controllerAs:"ctrl",parent:"toolbar"}),i.state("takeAwayFinish",{url:"/side/:culture/:uid/takeAway/finish?type&order&paymentRequired",templateUrl:"/app/widgets/side/views/takeAwayFinish.html",controller:"takeAwayFinishController",controllerAs:"ctrl",parent:"toolbar"}),i.state("waitlistSpotUnavailable",{url:"/side/:culture/:uid/waitlist/:waitlistItem/spotunavailable",templateUrl:"/app/widgets/side/views/waitlistSpotUnavailable.html",controller:"waitlistSpotUnavailableController",controllerAs:"ctrl",parent:"toolbar"}),i.state("waitlistFinish",{url:"/side/:culture/:uid/waitlist/finish?type&waitlistItem",templateUrl:"/app/widgets/side/views/waitlistFinish.html",controller:"waitlistFinishController",controllerAs:"ctrl",parent:"toolbar"}),i.state("unsubscribe",{url:"/side/:culture/:uid/unsubscribe?email&code&recipientId",templateUrl:"/app/widgets/side/views/unsubscribe.html",controller:"unsubscribeController",controllerAs:"ctrl",parent:"toolbar"}),i.state("subscribe",{url:"/side/:culture/:uid/subscribe?email&code&autoSubscribe",templateUrl:"/app/widgets/side/views/subscribe.html",controller:"subscribeController",controllerAs:"ctrl",parent:"toolbar"}),e.html5Mode({enabled:!0,requireBase:!1})}t=t.Side||(t.Side={}),e.$inject=["$routeProvider","$locationProvider","$stateProvider"],t.RouteConfig=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide",["ngRoute","ngTouch","ui.router","ngAnimate","ngStorage","angular.filter","ft.translate","debounce","ng-clamp","ft.signal","ngSanitize","angularMoment","ng-drag-scroll"]).value("settings",new FT.Widget.Side.Settings).constant("translationContext","widget").config(FT.Widget.Side.RouteConfig).config(["$translateProvider","$animateProvider","signalRServiceProvider","signalRUrl","widgetApiUrl","translationUrl","translationContext",function(t,e,i,r,o,n,s){e.classNameFilter(/angular-animate/),i.setLogging(!1),i.setConnectionUrl(r+"/widget-hub"),t.setup(o,n,s)}]).run(["$transitions","$rootScope","cssService","$injector",function(t,e,o,n){t.onStart({},function(t){e.stateTo=t.$to().name,e.stateFrom=t.$from().name,$(".widget-container").attr("animate-from",t.$from().name),$(".widget-container").attr("animate-to",t.$to().name)}),t.onSuccess({},function(t){var e=t.$to().name,i=t.$from().name,r=n.get("widgetService").getWidgetId();"book"==t.$from().name?o.removeClass("ft-w-page-"+n.get("widgetService").bookView,r):o.removeClass("ft-w-page-"+i,r),"book"==t.$to().name?o.addClass("ft-w-page-"+n.get("widgetService").bookView,r):o.addClass("ft-w-page-"+e,r)})}]),function(t){var e,i;function r(t,e,i,r,o,n){var s=this;this.$stateParams=t,this.apiService=e,this.widgetService=i,this.timespanService=r,this.$state=o,this.$q=n,this.voucherDiscount=0,this.totalAmount=0,this.widgetService.promotionCodeLoaded().then(function(){s.setPromotionCode()}),i.voucher&&this.setVoucher(),this.ticket&&"-1"!==this.ticket.refundPolicy&&"0"!==this.ticket.refundPolicy&&(this.ticketUntilTimeSpan=this.timespanService.toString(this.ticket.refundPolicy)),this.calculateAmounts()}(e=t.Widget||(t.Widget={})).Side||(e.Side={}),r.prototype.getPlaceholderText=function(){return this.widgetService.hasActivePromotionCodes?this.voucher&&this.promotionCode?"":this.voucher?"Promotion code":this.promotionCode?"Voucher code":"Voucher or promotion code":this.voucher?"":"Voucher code"},r.prototype.getApplyButtonText=function(){return this.widgetService.hasActivePromotionCodes?this.voucher&&this.promotionCode?"":this.voucher?"Apply promotion code":this.promotionCode?"Redeem voucher":"Apply":this.voucher?"":"Redeem voucher"},r.prototype.getInvalidCodeText=function(){return this.widgetService.hasActivePromotionCodes?this.voucher||this.promotionCode?this.voucher?"This promotion code is invalid.":this.promotionCode?"This voucher code is invalid.":"":"This voucher or promotion code is invalid.":this.voucher?"":"This code may be invalid or may be from a third party. In that case, it cannot be cashed in this way. Enter a promotion code or 8-digit gift card issued by Formitable."},r.prototype.applyVoucherOrPromotionCode=function(){var e=this;this.applyVoucher().then(function(t){t||e.applyPromotionCode().then(function(t){t||(e.invalidVoucherOrPromotionCode=!0,e.calculateAmounts())})})},r.prototype.applyVoucher=function(){var e=this,i=this.$q.defer();return this.voucher?i.resolve(!1):this.widgetService.checkVoucherCode(this.voucherOrPromotionCode).then(function(t){t&&(e.setVoucher(),e.invalidVoucherOrPromotionCode=!1,i.resolve(!0)),i.resolve(!1)}),i.promise},r.prototype.applyPromotionCode=function(){var e=this,i=this.$q.defer();return this.promotionCode?i.resolve(!1):this.widgetService.checkPromotionCode("TICKET",this.voucherOrPromotionCode).then(function(t){t&&(e.setPromotionCode(),e.invalidVoucherOrPromotionCode=!1,i.resolve(!0)),i.resolve(!1)}),i.promise},r.prototype.setVoucher=function(){this.voucherOrPromotionCode="",this.voucher=this.widgetService.voucher,this.voucher.invalid=!1,this.voucher.ticket&&this.ticket&&this.voucher.ticket.uid!==this.ticket.uid||this.voucher.ticket&&!this.ticket?(this.voucher.invalid=!0,this.invalidVoucherTicket=!0):this.voucher.ticket&&this.voucher.quantity>this.booking.numberOfPeople?(this.voucher.invalid=!0,this.invalidVoucherNumberOfPeople=!0):this.calculateAmounts()},r.prototype.setPromotionCode=function(){var e=this;this.voucherOrPromotionCode="",this.promotionCode=this.widgetService.promotionCode,this.promotionCode&&(this.amountOfApplicableTicketsForPromotionCode=t.Helpers.PromotionCodeHelper.amountOfSpecificApplicableProducts(this.promotionCode),"TICKET"!==this.promotionCode.productType&&(this.promotionCode.invalid=!0,this.invalidPromotionCodeProductType=!0),this.ticket&&(t.Helpers.PromotionCodeHelper.promotionCodeAppliesToProduct(this.promotionCode,this.ticket.uid)||this.getApplicableTicketIfRequired().then(function(t){e.promotionCodeApplicableTicket=t,e.promotionCode.invalid=!0,e.invalidPromotionCodeTicket=!0})),this.calculateAmounts())},r.prototype.getApplicableTicketIfRequired=function(){var e=this.$q.defer();1!==this.amountOfApplicableTicketsForPromotionCode&&e.resolve(null);var t=this.widgetService.promotionCode.applicableProductUids[0];return this.apiService.getProduct(this.widgetService.restaurant.uid,t,this.widgetService.friendCode).then(function(t){e.resolve(t.data)}),e.promise},r.prototype.goToVoucherTicket=function(){this.$state.go("ticket",{ticketId:this.widgetService.voucher.ticket.uid,uid:this.widgetService.restaurant.uid,culture:this.booking.culture})},r.prototype.goToPromotionCodeTicket=function(){this.$state.go("ticket",{ticketId:this.promotionCodeApplicableTicket.uid,uid:this.widgetService.restaurant.uid,culture:this.booking.culture})},r.prototype.removeVoucher=function(){this.invalidVoucherTicket=!1,this.invalidVoucherNumberOfPeople=!1,this.invalidVoucherOrPromotionCode=!1,this.widgetService.voucher=null,this.voucher=null,this.calculateAmounts()},r.prototype.removePromotionCode=function(){this.invalidPromotionCodeTicket=!1,this.invalidPromotionCodeProductType=!1,this.amountOfApplicableTicketsForPromotionCode=0,this.promotionCodeApplicableTicket=null,this.invalidVoucherOrPromotionCode=!1,this.widgetService.promotionCode=null,this.promotionCode=null,this.calculateAmounts()},r.prototype.calculateAmounts=function(){this.quantity=this.booking.numberOfPeople,this.ticket?(this.calculateQuantity(),this.totalAmount=0,this.totalAmount=t.Helpers.PromotionCodeHelper.applyPromotionCodeToTotalAmount(this.totalAmount,!this.promotionCode||this.promotionCode.perOrder||this.promotionCode.invalid?null:this.promotionCode,this.ticket.uid,this.quantity,this.ticket.price),this.promotionCode&&this.promotionCode.perOrder&&(this.totalAmount=t.Helpers.PromotionCodeHelper.applyPerOrderPromotionCodeToTotalAmount(this.totalAmount,this.promotionCode.invalid?null:this.promotionCode)),this.applyVoucherToTotalAmount()):this.totalAmount=0},r.prototype.calculateQuantity=function(){this.voucher&&(this.voucher.invalid||this.voucher.ticket&&(this.quantity=this.booking.numberOfPeople-this.voucher.quantity))},r.prototype.applyVoucherToTotalAmount=function(){this.voucher&&(this.voucher.invalid||this.voucher.ticket||(this.totalAmount-=this.voucher.price))},r.prototype.getTillTime=function(){return 24===this.restaurant.timeFormat?moment(this.widgetService.dateFromBooking(this.booking)).add(this.booking.bookingDuration,"minutes").format("H:mm"):moment(this.widgetService.dateFromBooking(this.booking)).add(this.booking.bookingDuration,"minutes").format("h:mm A")},r.$inject=["$stateParams","apiService","widgetService","timeSpanService","$state","$q"],i=r,e=function(){this.bindings={booking:"<",ticket:"<",restaurant:"<",voucher:"=",promotionCode:"=",totalAmount:"=",showDescription:"<"},this.controller=i,this.templateUrl="/app/widgets/side/components/checkoutSummary.html"},angular.module("widgetSide").component("checkoutSummary",new e)}(FT=FT||{}),function(t){var e;function i(t,e,i,r,o){var n=this;this.$translate=t,this.$stateParams=e,this.webUrl=i,this.widgetService=r,this.timespanService=o,this.widgetService.restaurantLoaded().then(function(){n.newsletterSubscriptionText=n.widgetService.restaurant.newsletterSubscriptionText||n.$translate.getTranslation("Don't miss out on the latest events, promotions and other offers from {0}.",n.widgetService.restaurant.name)})}(t=t.Widget||(t.Widget={})).Side||(t.Side={}),i.$inject=["$translate","$stateParams","webUrl","widgetService","timeSpanService","$filter"],e=i,t=function(){this.bindings={model:"="},this.controller=e,this.templateUrl="/app/widgets/side/components/checkoutTerms.html"},angular.module("widgetSide").component("checkoutTerms",new t)}(FT=FT||{}),function(t){var e;function i(t,e,i,r,o){this.$element=t,this.$scope=e,this.widgetService=i,this.$filter=r,this.$stateParams=o}(t=t.Widget||(t.Widget={})).Side||(t.Side={}),i.$inject=["$element","$scope","widgetService","$filter","$stateParams"],e=i,t=function(){this.bindings={voucher:"<",restaurant:"<"},this.controller=e,this.templateUrl="/app/widgets/side/components/voucherInfo.html"},angular.module("widgetSide").component("voucherInfo",new t)}(FT=FT||{}),function(i){!function(t){var d;function e(t,e,i,r,o,n,s,a,c){var u=this;this.$translate=t,this.$scope=e,this.$state=i,this.$stateParams=r,this.widgetService=o,this.apiService=n,this.cssService=s,this.sdkService=a,this.guestService=c,this.voucherCode="",this.weekDays=[moment.weekdaysShort(1),moment.weekdaysShort(2),moment.weekdaysShort(3),moment.weekdaysShort(4),moment.weekdaysShort(5),moment.weekdaysShort(6),moment.weekdaysShort(0)],this.userChangedNumberOfPeople=!1,this.userChangedTime=!1,this.userChangedDate=!1,this.BookViewStateType=d.BookViewState,this.widgetService.multiVenue&&this.widgetService.reinitializeRestaurantWidget("book",this.$stateParams.uid,this.$stateParams.culture),this.widgetService.restaurantLoaded().then(function(t){u.restaurant=t,u.showCalendar=!1,u.showPeople=!1,u.showTimes=!1,r.voucherCode&&u.widgetService.checkVoucherCode(r.voucherCode).then(function(t){t&&u.widgetService.voucher.ticket&&(u.widgetService.booking.numberOfPeople=u.widgetService.voucher.quantity,u.$state.go("ticket",{ticketId:u.widgetService.voucher.ticket.uid,uid:u.uid,culture:u.culture}))}),u.$scope.$watch(function(){return Number(u.showCalendar)+Number(u.showPeople)+Number(u.showTimes)},function(t,e){e!==t&&(0<t?u.cssService.addClass("ft-w-select-open"):u.cssService.removeClass("ft-w-select-open"))},!1),u.$scope.$on("searchReady",function(){u.widgetService.searchTickets()}),u.initialize()}),this.$scope.$watch(function(t){return u.widgetService.bookView},function(t,e){return u.updateBookViewCss(t,e)})}d=t.Side||(t.Side={}),e.prototype.initialize=function(){var t=this.widgetService.getWidgetId();this.cssService.setWidgetId(t),this.cssService.small(),this.widgetService.ticketOnly=!1,this.culture=this.$stateParams.culture,this.uid=this.$stateParams.uid,this.currentBooking=this.widgetService.booking,this.widgetService.selectedTicket=null,this.$stateParams.searchTickets&&this.widgetService.searchTickets(),"search"===this.widgetService.bookView&&this.sdkService.call("event",t,["ft-widget-navigated",{productType:"ticket",widgetUid:t,page:"search"}],!0)},e.prototype.closeWidgetOnBack=function(){return!this.widgetService.multiVenue&&(!this.widgetService.embedded&&((!this.widgetService.widgetToTableLandingEnabled||this.widgetService.bookView!=d.BookViewState.Suggested)&&this.widgetService.bookView!=d.BookViewState.Search))},e.prototype.moveBack=function(){!this.widgetService.multiVenue||this.widgetService.embedded||(this.widgetService.bookView!=this.BookViewStateType.Suggested||this.widgetService.widgetToTableLandingEnabled)&&this.widgetService.bookView!=this.BookViewStateType.Landing?this.widgetService.bookView===d.BookViewState.Search?this.widgetService.bookView=d.BookViewState.Suggested:this.widgetService.bookView==d.BookViewState.Suggested&&this.widgetService.widgetToTableLandingEnabled?this.widgetService.bookView=d.BookViewState.Landing:this.cssService.close():this.widgetService.backToMultiVenue()},e.prototype.openSelect=function(e){var i=this;this[e="show"+e]?this[e]=!1:(this.showCalendar=!1,this.showPeople=!1,this.showTimes=!1,this[e]=!0,$(".widget-container").on("click."+e,function(t){i[e]=!1,i.$scope.$apply(),$(".widget-container").off("click."+e)}))},e.prototype.getTillTime=function(t){return 24===this.restaurant.timeFormat?moment(t.time).add(t.maxDuration,"minutes").format("H:mm"):moment(t.time).add(t.maxDuration,"minutes").format("h:mm A")},e.prototype.setPeople=function(t){this.resetUserInteractionFlags(),this.userChangedNumberOfPeople=!0,this.widgetService.searchParams.numberOfPeople=t,this.showPeople=!1},e.prototype.changeBookView=function(t){this.widgetService.triggerBookingIntent(),this.widgetService.widgetToTableLandingEnabled&&this.widgetService.trackNavAction(t),this.widgetService.bookView=t},e.prototype.onRedirectToTable=function(t){var e=this;t.preventDefault(),this.widgetService.trackNavAction("TableLinkTapped").then(function(){window.top.location=e.widgetService.currentTableLink.directLink}),setTimeout(function(){window.top.location=e.widgetService.currentTableLink.directLink},500)},e.prototype.bookDirect=function(){this.currentBooking.numberOfPeople=this.widgetService.searchParams.numberOfPeople,this.currentBooking.bookingTime=this.widgetService.searchParams.bookingTime,this.currentBooking.bookingDate=this.widgetService.searchParams.bookingDate,this.currentBooking.short=this.widgetService.searchParams.short,this.currentBooking.bookingDuration=this.widgetService.searchParams.bookingDuration,this.widgetService.selectedTicket=this.widgetService.result[0],this.$state.go("checkout",{uid:this.uid,culture:this.culture})},e.prototype.waitlist=function(e){var t=this.widgetService.result.filter(function(t){return t.uid===e})[0];this.widgetService.waitlistItem.partySize=this.widgetService.searchParams.numberOfPeople,this.widgetService.waitlistItem.fromTime=i.Helpers.DateHelper.minutesFromTime(this.widgetService.searchParams.bookingTime),this.widgetService.waitlistItem.untilTime=i.Helpers.DateHelper.minutesFromTime(this.widgetService.searchParams.bookingTime),this.widgetService.waitlistItem.sendNotifications=t.sendNotifications,this.widgetService.waitlistItem.date=this.widgetService.searchParams.bookingDate,this.widgetService.waitlistItem.duration=this.widgetService.searchParams.bookingDuration,this.widgetService.waitlistItem.productUid=t.uid,this.widgetService.selectedTicket=t,this.$state.go("waitlist",{uid:this.uid,culture:this.culture})},e.prototype.setTime=function(t){this.resetUserInteractionFlags(),this.userChangedTime=!0,this.widgetService.setParams(t,!1),this.showTimes=!1},e.prototype.getOptionQuantity=function(){return this.widgetService.result.length},e.prototype.goToTicket=function(e,t){var i=this;this.showPeople||this.showCalendar||this.showTimes||(!e.default&&e.description||!t?this.$state.go("ticket",{ticketId:e.uid,uid:this.uid,culture:this.culture,from:this.widgetService.bookView}):e.waitlistEnabled&&e.availability<=0?this.waitlist(e.uid):this.apiService.getFirstDateTime(this.widgetService.restaurant,this.widgetService.dateFromBooking(this.widgetService.searchParams),this.$translate.getCurrentCulture(),this.widgetService.searchParams.numberOfPeople,e.uid,this.widgetService.friendCode,this.widgetService.voucher?this.widgetService.voucher.code:"").then(function(t){t=t.data;i.currentBooking.numberOfPeople=i.widgetService.searchParams.numberOfPeople,i.widgetService.setBookingTimes(t,!0),i.widgetService.selectedTicket=e,i.$state.go("checkout",{uid:i.uid,culture:i.culture})}))},e.prototype.searchTickets=function(){var t=this.widgetService.getWidgetId();this.widgetService.bookView=d.BookViewState.Search,this.sdkService.call("event",t,["ft-widget-navigated",{widgetUid:t,page:"search",productType:"ticket"}],!0)},e.prototype.truncate=function(t,e){return t?i.Helpers.StringHelper.truncate(t,e):""},e.prototype.checkIfWeHaveToNotifyUser=function(){var t=!1;return this.userChangedNumberOfPeople||(t=this.widgetService.getIsNumberOfPeopleChanged()),this.userChangedTime||(t=this.widgetService.getIsSearchTimeChanged()),this.userChangedDate||(t=this.widgetService.getIsSearchDateChanged()),t="suggested"===this.widgetService.bookView?!1:t},e.prototype.hideNotificationPopup=function(){this.resetUserInteractionFlags()},e.prototype.resetUserInteractionFlags=function(){this.userChangedNumberOfPeople=!1,this.userChangedTime=!1,this.userChangedDate=!1,this.widgetService.resetSearchParamChangeFlags()},e.prototype.selectDate=function(){this.resetUserInteractionFlags(),this.userChangedDate=!0},e.prototype.updateBookViewCss=function(t,e){t!==e&&(this.cssService.removeClass("ft-w-page-"+e),t&&this.cssService.addClass("ft-w-page-"+t))},e.$inject=["$translate","$scope","$state","$stateParams","widgetService","apiService","cssService","sdkService","guestService"],d.BookController=e}(i.Widget||(i.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("bookController",FT.Widget.Side.BookController),function(i){!function(t){function e(t,e,i,r,o,n,s,a,c,u,d,l,h,p,m,g,f){this.$filter=t,this.$scope=e,this.$rootScope=i,this.$http=r,this.$state=o,this.$stateParams=n,this.$location=s,this.$timeout=a,this.$route=c,this.$localStorage=u,this.widgetService=d,this.apiService=l,this.timeSpanService=h,this.cssService=p,this.checkoutService=m,this.sdkService=g,this.guestService=f,this.submitting=!1,this.totalAmount=0,this.initialize()}t=t.Side||(t.Side={}),e.prototype.initialize=function(){var t=this;this.cssService.full(),this.culture=this.$stateParams.culture,this.uid=this.$stateParams.uid,this.currentBooking=this.widgetService.booking,this.selectedTicket=this.widgetService.selectedTicket,this.guestService.hasGuestData()&&((e=this.guestService.guest).title&&this.widgetService.showTitleInCheckout()&&(this.currentBooking.title=e.title),this.currentBooking.company=e.company,this.currentBooking.companyName=e.companyName,this.currentBooking.firstName=e.firstName,this.currentBooking.lastName=e.lastName,this.currentBooking.email=e.email,this.currentBooking.telephone=e.telephone),i.Helpers.StorageHelper.storageAvailable("sessionStorage")&&(sessionStorage.setItem("ticket",JSON.stringify(this.selectedTicket)),sessionStorage.setItem("booking",JSON.stringify(this.currentBooking))),this.$scope.$watch(function(){return t.totalAmount},function(){t.getPaymentMethods()});var e={widgetUid:this.widgetService.getWidgetId(),productType:"ticket",page:"checkout"};this.selectedTicket&&(e.products=[{type:"ticket",title:this.selectedTicket.title,uid:this.selectedTicket.uid,amount:this.selectedTicket.price/100,quantity:this.currentBooking.numberOfPeople}]),this.sdkService.call("event",this.widgetService.getWidgetId(),["ft-widget-navigated",e],!0)},e.prototype.checkHouseHold=function(){return 2<this.currentBooking.numberOfPeople&&!this.widgetService.restaurant.features.some(function(t){return"DISABLE_COVID_CHECK"==t})},e.prototype.checkCanHouseHoldBook=function(){return!!this.widgetService.restaurant.features.some(function(t){return"DISABLE_COVID_CHECK"==t})||(this.currentBooking.numberOfPeople<=2||(!!this.singleHousehold||2<this.currentBooking.numberOfPeople&&!this.widgetService.restaurant.features.some(function(t){return"ONLY_ACCEPT_SINGLE_HOUSEHOLD"==t})))},e.prototype.showCovidFooter=function(){return!this.widgetService.hasFeature("DISABLE_COVID_FOOTER")},e.prototype.getIdealIssuers=function(){var e=this;this.apiService.getIdealIssuers(this.widgetService.restaurant).then(function(t){e.issuers=t.data})},e.prototype.getPaymentMethods=function(){var e=this;0<this.totalAmount&&this.apiService.getPaymentMethods(this.widgetService.restaurant,this.totalAmount).then(function(t){e.paymentMethods=t.data,e.widgetService.applePayEligible()||(e.paymentMethods=e.paymentMethods.filter(function(t){return"applepay"!==t.id})),1===e.paymentMethods.length&&e.selectMethod(e.paymentMethods[0])})},e.prototype.selectMethod=function(t){"ideal"!==(this.paymentMethod=t).id||this.issuers||this.getIdealIssuers()},e.prototype.checkout=function(){var t;this.submitting=!0,this.btnDisable=!0,2<this.currentBooking.numberOfPeople&&!this.widgetService.restaurant.features.some(function(t){return"DISABLE_COVID_CHECK"==t})&&(t=this.currentBooking.tags.indexOf("MULTIPLEHOUSEHOLDS"),this.singleHousehold&&-1<t&&this.currentBooking.tags.splice(t),this.singleHousehold||-1!=t||this.currentBooking.tags.push("MULTIPLEHOUSEHOLDS")),this.widgetService.showAreaToGuest&&this.currentBooking.tags.push("SHOWAREATOGUEST"),this.$scope.checkout.$valid?(t=this.paymentMethod,(0<this.totalAmount||this.selectedTicket.noShowFee)&&"Stripe"==this.widgetService.restaurant.paymentProvider&&(t={id:"Stripe",description:"",image:"",paymentFee:0}),this.checkoutService.createBooking(this.currentBooking,this.totalAmount,this.voucher?this.voucher.code:null,this.promotionCode?this.promotionCode.code:null,this.selectedTicket,t,this.issuer)):this.btnDisable=!1},e.$inject=["$filter","$scope","$rootScope","$http","$state","$stateParams","$location","$timeout","$route","$localStorage","widgetService","apiService","timeSpanService","cssService","checkoutService","sdkService","guestService"],t.CheckoutController=e}(i.Widget||(i.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("checkoutController",FT.Widget.Side.CheckoutController),function(t){!function(t){function e(t,e,i,r,o,n,s,a,c,u){this.$scope=t,this.$http=e,this.$state=i,this.$stateParams=r,this.$location=o,this.$timeout=n,this.$route=s,this.$localStorage=a,this.widgetService=c,this.cssService=u,this.initialize()}t=t.Side||(t.Side={}),e.prototype.initialize=function(){this.cssService.setWidgetId(this.widgetService.getWidgetId()),this.culture=this.$stateParams.culture,this.uid=this.$stateParams.uid,this.restaurant=this.widgetService.restaurant,this.errorMessage=this.$stateParams.errorMessage,this.errorCode=this.$stateParams.errorCode,this.cssService.open()},e.$inject=["$scope","$http","$state","$stateParams","$location","$timeout","$route","$localStorage","widgetService","cssService"],t.ErrorController=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("errorController",FT.Widget.Side.ErrorController),function(t){!function(t){function e(t,e,i,r,o,n,s,a,c,u,d,l,h,p){this.$translate=t,this.signalRService=e,this.$scope=i,this.$http=r,this.$state=o,this.$stateParams=n,this.$location=s,this.$timeout=a,this.$route=c,this.$localStorage=u,this.widgetService=d,this.apiService=l,this.cssService=h,this.sdkService=p,this.initialize()}t=t.Side||(t.Side={}),e.prototype.initialize=function(){var e=this,t=this.widgetService.getWidgetId();this.cssService.setWidgetId(t),this.cssService.full(),this.purchaseEventThrown=!1,this.checking=!0,this.culture=this.$stateParams.culture,this.firstTry=(new Date).getTime(),this.uid=this.$stateParams.uid,this.type=this.$stateParams.type,this.paymentRequired="true"==this.$stateParams.paymentRequired,this.bookingUid=this.$state.params.booking||this.$state.params["ft-booking"],this.signalRService.subscribe("reservation_"+this.bookingUid),this.$scope.$on("$destroy",function(){e.signalRService.unSubscribe("reservation_"+e.booking.uid)}),this.signalRService.addListener("paymentRedirect","finishController",function(t){e.widgetService.redirect(t)}),this.signalRService.addListener("bookingChanged","finishController",function(t){("ACCEPTED"==t.status||"CREATED"==t.status&&t.optionExpiresDateTime)&&e.$timeout(function(){e.loadBooking(t.uid)},Math.max(0,e.firstTry+1e3-(new Date).getTime()))}),this.signalRService.addListener("bookingCancelled","finishController",function(t){e.$timeout(function(){e.cancelOrFailReason=t.reason,e.loadBooking(t.bookingUid)},Math.max(0,e.firstTry+1e3-(new Date).getTime()))});t="prepaid"==this.$state.params.type?3e3:6e3;this.$timeout(function(){e.checking&&(e.loadBooking(e.bookingUid),e.paymentRequired&&e.redirectToPayment())},t)},e.prototype.redirectToPayment=function(){var e=this;this.apiService.getPaymentUrlForBooking(this.bookingUid).then(function(t){t.data?e.widgetService.redirect(t.data):e.$timeout(function(){e.redirectToPayment()},5e3)})},e.prototype.goToPayment=function(){window.top.location.href=this.paymentUrl},e.prototype.loadBooking=function(e){var i=this;this.apiService.getBooking(this.widgetService.restaurant,e).then(function(t){return i.booking=t.data,i.checking=!1,$(".ticket-screen").addClass("finished"),i.registerPageView(),i.booking.isOption&&i.booking.totalAmount&&"Open"!==i.booking.paymentStatus?(i.$state.go("option",{uid:i.$stateParams.uid,culture:i.$stateParams.culture,optionId:e,accept:!0,message:i.$translate.getTranslation("Your payment did not succeed. Please try again.")}),!1):("ACCEPTED"!==i.booking.status||i.purchaseEventThrown||i.registerPurchaseEvent(),void i.$timeout(function(){var t=document.getElementById("booking_qr");t&&!i.qrCode&&(i.qrCode=new QRCode(t,{text:i.booking.tableDeepLink,width:160,height:160,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.L}))}))})},e.prototype.registerPageView=function(){var t=this.widgetService.getWidgetId(),e={productType:"ticket",widgetUid:t,page:"finish"};this.booking.ticket&&(e.products=[{type:"ticket",title:this.booking.ticket.title,uid:this.booking.ticket.uid,amount:this.booking.ticket.price,quantity:this.booking.numberOfPeople}]),this.sdkService.call("event",t,["ft-widget-navigated",e],!0)},e.prototype.registerPurchaseEvent=function(){var t,e=this.widgetService.getWidgetId();"ORDERED"===this.booking.orderStatus&&(t={productType:"ticket",widgetUid:e,order:{uid:this.booking.orderUid,totalAmount:this.booking.totalAmount/100,products:[]},reservation:{uid:this.booking.uid,numberOfPeople:this.booking.numberOfPeople,bookingDateTime:this.widgetService.dateFromBooking(this.booking),source:this.booking.source,culture:this.booking.culture}},this.booking.ticket?t.order.products=[{type:"ticket",title:this.booking.ticket.title,uid:this.booking.ticket.uid,amount:this.booking.ticket.price,quantity:this.booking.numberOfPeople}]:t.order.products=[{type:"regular",title:"Regular reservation",uid:"1",amount:0,quantity:this.booking.numberOfPeople}],this.sdkService.call("event",e,["ft-widget-ordered",t],!0),this.purchaseEventThrown=!0,t.page="success",this.sdkService.call("event",e,["ft-widget-navigated",t],!0))},e.prototype.close=function(){var t=this;this.cssService.close(),this.$timeout(function(){t.widgetService.home()},500)},e.$inject=["$translate","signalRService","$scope","$http","$state","$stateParams","$location","$timeout","$route","$localStorage","widgetService","apiService","cssService","sdkService"],t.FinishController=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("finishController",FT.Widget.Side.FinishController),function(t){!function(t){function e(t,e,i,r,o,n,s,a,c,u){this.$scope=t,this.$http=e,this.$state=i,this.$stateParams=r,this.$location=o,this.$timeout=n,this.$route=s,this.$localStorage=a,this.widgetService=c,this.cssService=u,this.amount=0,this.initialize()}t=t.Side||(t.Side={}),e.prototype.initialize=function(){this.cssService.setWidgetId(this.widgetService.getWidgetId()),this.cssService.full(),this.culture=this.$stateParams.culture,this.uid=this.$stateParams.uid,this.currentBooking=this.widgetService.booking},e.$inject=["$scope","$http","$state","$stateParams","$location","$timeout","$route","$localStorage","widgetService","cssService"],t.GroupController=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("groupController",FT.Widget.Side.GroupController),function(t){!function(t){function e(t,e,i,r,o,n,s,a,c,u,d){this.$scope=t,this.$http=e,this.$state=i,this.$stateParams=r,this.$location=o,this.$timeout=n,this.$route=s,this.$localStorage=a,this.widgetService=c,this.cssService=u,this.sdkService=d,this.initialize()}t=t.Side||(t.Side={}),e.prototype.initialize=function(){var t=this.widgetService.getWidgetId();this.cssService.setWidgetId(t),this.cssService.full(),this.sdkService.call("event",t,["ft-widget-navigated",{widgetUid:t,page:"help"}],!0),this.culture=this.$stateParams.culture,this.uid=this.$stateParams.uid,this.$timeout(function(){$('.help-index a[href^="#"], .help-content a[href^="#"]').on("click",function(t){t.preventDefault();t=t.currentTarget.hash,t=$(t);t&&$(".screen-wrap").stop().animate({scrollTop:t.offset().top+$(".screen-wrap").scrollTop()-50},400,"swing",function(){})})},600)},e.$inject=["$scope","$http","$state","$stateParams","$location","$timeout","$route","$localStorage","widgetService","cssService","sdkService"],t.HelpController=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("helpController",FT.Widget.Side.HelpController),function(t){(function(r){r.BOOK="book",r.VOUCHERS="vouchers",r.TAKEAWAY="takeaway";var t=(e.prototype.initialize=function(){var i=this,t=this.widgetService.getWidgetId();this.cssService.setWidgetId(t),this.cssService.small(),this.sdkService.call("event",t,["ft-widget-navigated",{widgetUid:t,page:"multi"}],!0),this.setSortPropertyPerRestaurant(r.BOOK),this.culture=this.$stateParams.culture,this.$scope.$watch(function(){return i.widgetService.clickedToolbarState},function(t,e){e&&t!==e&&i.setSortPropertyPerRestaurant(t)})},e.prototype.openRestaurantBooking=function(t){this.openRestaurant(r.BOOK,t)},e.prototype.openRestaurantGiftVouchers=function(t){this.openRestaurant(r.VOUCHERS,t)},e.prototype.openRestaurantTakeAway=function(t){this.openRestaurant(r.TAKEAWAY,t)},e.prototype.closeWidget=function(){this.cssService.close("toolbar")},e.prototype.openRestaurant=function(t,e){var i=this.getRestaurantLanguage(e);this.widgetService.resetClassesForRestaurant(),this.$state.go(t,{uid:e,culture:i})},e.prototype.setSortPropertyPerRestaurant=function(e){this.multiVenueGroup.restaurants.forEach(function(t){t.sortPriority=0,(e===r.BOOK&&!t.isBookable||e===r.VOUCHERS&&!t.giftVouchersEnabled||e===r.TAKEAWAY&&!t.takeawayEnabled)&&(t.sortPriority=999999),t.sortPriority+=t.priority})},e.prototype.getRestaurantLanguage=function(e){var i=this,t=this.multiVenueGroup.restaurants.filter(function(t){return t.uid===e})[0];if(!t)return"en";var r=t.cultures.map(function(t){return t.substring(0,2)});return 0!==r.filter(function(t){return t===i.culture}).length?this.culture:0!==r.filter(function(t){return"en"===t}).length?"en":t.startCulture},e.$inject=["$translate","$scope","$state","$stateParams","widgetService","cssService","sdkService"],e);function e(t,e,i,r,o,n,s){var a=this;this.$translate=t,this.$scope=e,this.$state=i,this.$stateParams=r,this.widgetService=o,this.cssService=n,this.sdkService=s,this.widgetService.multiVenueGroupLoaded().then(function(t){a.multiVenueGroup=t,a.widgetService.preview||(a.multiVenueGroup.restaurants=a.multiVenueGroup.restaurants.filter(function(t){return t.live&&(t.isBookable||t.giftVouchersEnabled||t.takeawayEnabled)})),a.initialize()})}r.MultiController=t})((t=t.Widget||(t.Widget={})).Side||(t.Side={}))}(FT=FT||{}),angular.module("widgetSide").controller("multiController",FT.Widget.Side.MultiController),function(t){!function(t){var r;function e(t,e,i,r,o,n,s,a,c,u,d,l,h,p,m,g,f,v,S,y,w){this.settings=t,this.$q=e,this.signalRService=i,this.$filter=r,this.reservationUrl=o,this.$scope=n,this.$rootScope=s,this.$http=a,this.$state=c,this.$stateParams=u,this.$location=d,this.$timeout=l,this.$route=h,this.$localStorage=p,this.widgetService=m,this.apiService=g,this.timeSpanService=f,this.cssService=v,this.checkoutService=S,this.sdkService=y,this.guestService=w,this.submitting=!1,this.totalAmount=0,this.loading=!0,this.btnDisable=!1,this.validationErrors=[],this.externalAccept=!0,this.initialize()}r=t.Side||(t.Side={}),e.prototype.initialize=function(){var e=this,t=this.widgetService.getWidgetId();this.cssService.setWidgetId(t);var i={productType:"ticket",widgetUid:t,page:"option"};this.selectedTicket&&(i.products=[{type:"ticket",title:this.selectedTicket.title,uid:this.selectedTicket.uid,amount:this.selectedTicket.price/100,quantity:this.currentBooking.numberOfPeople}]),this.sdkService.call("event",t,["ft-widget-navigated",i],!0),this.culture=this.$stateParams.culture,this.uid=this.$stateParams.uid,this.externalAccept=this.$stateParams.accept,this.message=this.$stateParams.message,this.widgetService.restaurantLoaded().then(function(t){e.loadOption(),e.signalRService.subscribe("reservation_"+e.$stateParams.optionId),e.signalRService.addListener("bookingChanged","optionController",function(t){e.message="",e.loadOption()}),e.signalRService.addListener("bookingCancelled","optionController",function(t){e.message="",e.loadOption()}),e.$scope.$on("$destroy",function(){e.signalRService.subscribe("reservation_"+e.$stateParams.optionId)})})},e.prototype.loadOption=function(){var i=this;this.apiService.getOption(this.widgetService.restaurant,this.$stateParams.optionId).then(function(t){i.cssService.full(),i.loading=!1;var e=t.data;i.widgetService.booking=i.currentBooking=t.data,i.widgetService.selectedTicket=i.selectedTicket=t.data.ticket,i.widgetService.selectedArea=e.areaName,i.widgetService.showAreaToGuest=-1<e.tags.indexOf("SHOWAREATOGUEST"),i.status=new Date(i.widgetService.dateFromBooking(i.currentBooking))<new Date?"PASSED":e.status,i.currentBooking.tags=e.tags,i.currentBooking.company=e.company,i.currentBooking.companyName=e.companyName,i.currentBooking.title=e.title,i.currentBooking.firstName=e.firstName,i.currentBooking.lastName=e.lastName,i.currentBooking.email=e.email,i.currentBooking.telephone=e.telephone,i.currentBooking.newsletter=e.newsletter,0===i.currentBooking.optionExpiresDateTime.getHours()&&(i.currentBooking.optionExpiresDateTime=moment(i.currentBooking.optionExpiresDateTime).add("minutes",-1).toDate()),i.$scope.$watch(function(){return i.totalAmount},function(){i.getPaymentMethods()})})},e.prototype.openCancel=function(){this.externalAccept=!1},e.prototype.closeCancel=function(){this.externalAccept=!0},e.prototype.getIdealIssuers=function(){var e=this;this.apiService.getIdealIssuers(this.widgetService.restaurant).then(function(t){e.issuers=t.data})},e.prototype.getPaymentMethods=function(){var e=this;0<this.totalAmount&&this.apiService.getPaymentMethods(this.widgetService.restaurant,this.totalAmount).then(function(t){e.paymentMethods=t.data,e.widgetService.applePayEligible()||(e.paymentMethods=e.paymentMethods.filter(function(t){return"applepay"!==t.id})),1===e.paymentMethods.length&&e.selectMethod(e.paymentMethods[0])})},e.prototype.selectMethod=function(t){"ideal"!==(this.paymentMethod=t).id||this.issuers||this.getIdealIssuers()},e.prototype.checkHouseHold=function(){return 2<this.currentBooking.numberOfPeople&&!this.widgetService.restaurant.features.some(function(t){return"DISABLE_COVID_CHECK"==t})},e.prototype.showCovidFooter=function(){return!this.widgetService.hasFeature("DISABLE_COVID_FOOTER")},e.prototype.accept=function(){var e=this;if(this.submitting=!0,this.btnDisable=!0,2<this.currentBooking.numberOfPeople&&!this.widgetService.restaurant.features.some(function(t){return"DISABLE_COVID_CHECK"==t})&&(t=this.currentBooking.tags.indexOf("MULTIPLEHOUSEHOLDS"),this.singleHousehold&&-1<t&&this.currentBooking.tags.splice(t),this.singleHousehold||-1!=t||this.currentBooking.tags.push("MULTIPLEHOUSEHOLDS")),!this.$scope.checkout.$invalid){var t=new r.OptionAcceptModel;t.booking=this.currentBooking;var i=this.paymentMethod;return(0<this.totalAmount||this.selectedTicket.noShowFee)&&"Stripe"==this.widgetService.restaurant.paymentProvider&&(i={id:"Stripe",description:"",image:"",paymentFee:0}),t.paymentMethodId=i?i.id:"",t.issuerId=this.issuer?this.issuer.id:"",t.returnUrl=this.settings.returnUrl,this.voucher&&(t.voucherCode=this.voucher.code),this.promotionCode&&(t.promotionCode=this.promotionCode.code),this.apiService.acceptOption(this.widgetService.restaurant,t).then(function(t){t=t.data;e.guestService.saveBookingData(e.currentBooking),t.paymentUrl?window.top.location.href=t.paymentUrl:e.$state.go("finish",{uid:e.$stateParams.uid,culture:e.$stateParams.culture,booking:e.currentBooking.uid,"option-action":"confirm",type:"option",paymentRequired:!!i})})}this.btnDisable=!1},e.prototype.cancel=function(){var e=this;this.apiService.cancelOption(this.widgetService.restaurant,this.currentBooking.uid).then(function(t){e.$state.go("finish",{uid:e.$stateParams.uid,culture:e.$stateParams.culture,booking:e.currentBooking.uid,"option-action":"cancel",type:"option"})})},e.prototype.close=function(){var t=this;this.cssService.close(),this.$timeout(function(){t.widgetService.home()},500)},e.prototype.getTillTime=function(){return 24===this.widgetService.restaurant.timeFormat?moment(this.widgetService.dateFromBooking(this.currentBooking)).add(this.currentBooking.bookingDuration,"minutes").format("H:mm"):moment(this.widgetService.dateFromBooking(this.currentBooking)).add(this.currentBooking.bookingDuration,"minutes").format("h:mm A")},e.prototype.isValid=function(e){return 0===this.validationErrors.filter(function(t){return t.field===e}).length},e.$inject=["settings","$q","signalRService","$filter","reservationUrl","$scope","$rootScope","$http","$state","$stateParams","$location","$timeout","$route","$localStorage","widgetService","apiService","timeSpanService","cssService","checkoutService","sdkService","guestService"],r.OptionController=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("optionController",FT.Widget.Side.OptionController),function(t){!function(t){function e(t,e,i,r,o,n,s){this.widgetService=t,this.$stateParams=e,this.$state=i,this.cssService=r,this.$timeout=o,this.sdkService=n,this.$translate=s;s=this.widgetService.getWidgetId();this.cssService.setWidgetId(s),this.voucher=this.widgetService.voucher,this.$timeout(function(){$(".redeem-btn").focus()},200),this.sdkService.call("event",s,["ft-widget-navigated",{widgetUid:s,page:"redeem",productType:"ticket"}],!0)}t=t.Side||(t.Side={}),e.prototype.checkVoucher=function(){var e=this;this.widgetService.checkVoucherCode(this.voucherCode).then(function(t){t?e.voucher=e.widgetService.voucher:e.message=e.$translate.getTranslation("This code may be invalid or may be from a third party. In that case, it cannot be cashed in this way. Enter a promotion code or 8-digit gift card issued by Formitable.")})},e.prototype.continue=function(){this.voucher.ticket?this.$state.go("ticket",{ticketId:this.voucher.ticket.uid,uid:this.$stateParams.uid,culture:this.$stateParams.culture}):this.$state.go("book",{uid:this.$stateParams.uid,culture:this.$stateParams.culture})},e.prototype.removeVoucher=function(){this.widgetService.voucher=this.voucher=this.voucherCode=null},e.$inject=["widgetService","$stateParams","$state","cssService","$timeout","sdkService","$translate"],t.RedeemController=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("redeemController",FT.Widget.Side.RedeemController),function(t){!function(t){function e(t,e,i,r,o,n,s){this.$state=t,this.$stateParams=e,this.$timeout=i,this.widgetService=r,this.apiService=o,this.cssService=n,this.trackingService=s,this.initialize()}t=t.Side||(t.Side={}),e.prototype.initialize=function(){this.cssService.setWidgetId(this.widgetService.getWidgetId()),this.cssService.small(),this.culture=this.$stateParams.culture,this.uid=this.$stateParams.uid,this.email=this.$state.params.email||this.$state.params["ft-subscribe"],this.email&&(this.email=this.email.replace(/ /g,"+")),this.code=this.$state.params.code||this.$state.params["ft-code"],this.code&&this.confirmSubscription(),this.autoSubscribe=this.$state.params.autoSubscribe,this.autoSubscribe&&this.subscribe()},e.prototype.subscribe=function(){var e=this;this.apiService.subscribe(this.email,this.uid).then(function(t){t.data&&(e.trackingService.logRequestSubscribeGuest(e.email),e.subscribed=!0)})},e.prototype.confirmSubscription=function(){var e=this;this.apiService.confirmSubscription(this.email,this.uid,this.code).then(function(t){t.data&&(e.trackingService.logConfirmSubscribeGuest(e.email),e.subscriptionConfirmed=!0)})},e.prototype.close=function(){var t=this;this.cssService.close(),this.$timeout(function(){t.widgetService.home()},500)},e.$inject=["$state","$stateParams","$timeout","widgetService","apiService","cssService","trackingService"],t.SubscribeController=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("subscribeController",FT.Widget.Side.SubscribeController),function(o){!function(t){var r;function e(t,e,i,r,o,n,s,a,c,u,d,l,h,p,m,g,f,v,S,y,w){var k=this;this.$translate=t,this.product=e,this.$filter=i,this.$interval=r,this.$scope=o,this.$rootScope=n,this.$http=s,this.$state=a,this.$stateParams=c,this.$location=u,this.$timeout=d,this.$route=l,this.$localStorage=h,this.widgetService=p,this.apiService=m,this.takeAwayService=g,this.cssService=f,this.checkoutService=v,this.sdkService=S,this.cart=y,this.$q=w,this.terms=!1,this.submitting=!1,this.zipCodeInvalid=!1,this.itemsUnavailable=!1,this.itemMethodUnavailable=!1,this.timeSlotExpired=!1,this.btnDisable=!1,this.today=moment(new Date).add(-1,"days").toDate(),this.widgetService.restaurantLoaded().then(function(t){k.initialize()})}r=t.Side||(t.Side={}),e.prototype.initialize=function(){var i=this,t=this.widgetService.getWidgetId();this.cssService.setWidgetId(t),this.cssService.full();var e={productType:"takeaway",widgetUid:t,page:"takeaway-checkout",products:[]};this.cart.products.length&&(this.cart.products.forEach(function(t){e.products.push({type:"takeaway",title:t.title,uid:t.uid,amount:t.priceIncOptions*t.quantity/100,quantity:t.quantity})}),"delivery"==this.cart.takeAwayMethod&&e.products.push({type:"takeaway",title:"Delivery",uid:"NA",amount:this.cart.getTotalAmount()-this.cart.getTotalWithoutDelivery()})),this.sdkService.call("event",t,["ft-widget-navigated",e],!0),this.culture=this.$stateParams.culture,this.uid=this.$stateParams.uid,this.$localStorage.title&&this.widgetService.showTitleInCheckout()&&(this.cart.orderInfo.title=this.$localStorage.title),this.cart.orderInfo.company="true"===this.$localStorage.company,this.cart.orderInfo.companyName||(this.cart.orderInfo.companyName=this.$localStorage.companyName),this.cart.orderInfo.firstName||(this.cart.orderInfo.firstName=this.$localStorage.firstName),this.cart.orderInfo.lastName||(this.cart.orderInfo.lastName=this.$localStorage.lastName),this.cart.orderInfo.email||(this.cart.orderInfo.email=this.$localStorage.email),this.cart.orderInfo.telephone||(this.cart.orderInfo.telephone=this.$localStorage.telephone),this.cart.orderInfo.address||(this.cart.orderInfo.address=this.$localStorage.address),this.cart.orderInfo.zipcode||(this.cart.orderInfo.zipcode=this.$localStorage.zipcode),this.cart.orderInfo.city||(this.cart.orderInfo.city=this.$localStorage.city),this.cart.orderInfo.culture=this.culture,this.$scope.$watch(function(){return i.cart.products},function(t,e){0<i.cart.getTotalAmount()&&i.getPaymentMethods()},!0),this.$scope.$watch(function(){return i.cart.orderInfo.zipcode},function(t,e){i.zipCodeInvalid="delivery"==i.cart.takeAwayMethod&&!i.takeAwayService.validateZipcode(t)},!0),this.$scope.$watch(function(){return i.cart.takeAwayMethod},function(t,e){i.zipCodeInvalid="delivery"==t&&!i.takeAwayService.validateZipcode(i.cart.orderInfo.zipcode),i.updateCartProductQuantity()},!0),this.$scope.$on("$destroy",function(){i.$interval.cancel(i.slotTimer)}),o.Helpers.StorageHelper.storageAvailable("sessionStorage")&&sessionStorage.setItem("product",JSON.stringify(this.product)),this.cart.paymentMethod&&"ideal"===this.cart.paymentMethod.id&&!this.issuers&&this.getIdealIssuers(),this.takeAwayService.preferredTimeIsAvailable(this.cart.preferredTime)||(this.cart.preferredTime=this.takeAwayService.getFirstAvailableTime()),this.selectedOrderTimeAvailable(),this.updateCartProductQuantity()},e.prototype.updateCartProductQuantity=function(){var o=this;this.apiService.getTakeawayProductsForDate(this.widgetService.restaurant.uid,this.cart.preferredDate).then(function(t){var r=t.data;o.unavailableProducts=[],o.itemsUnavailable=!1,o.itemMethodUnavailable=!1,o.cart.products.forEach(function(e){var t=r.filter(function(t){return t.uid==e.uid})[0];e.availability=t.availability;var i=0;null!=t.availability&&e.quantity>t.availability&&(i=e.quantity-t.availability,e.quantity=0<t.availability?t.availability:0,o.itemsUnavailable=!0),("delivery"==o.cart.takeAwayMethod&&!t.deliveryEnabled&&0<e.quantity||"pick-up"==o.cart.takeAwayMethod&&!t.pickUpEnabled&&0<e.quantity)&&(i=e.quantity,e.quantity=0,o.itemMethodUnavailable=!0),0<i&&o.unavailableProducts.push({name:e.title,quantity:i})}),(o.itemMethodUnavailable||o.itemsUnavailable)&&o.cart.setPreferredTime()})},e.prototype.getIdealIssuers=function(){var e=this;this.apiService.getIdealIssuers(this.widgetService.restaurant).then(function(t){e.issuers=t.data})},e.prototype.showDivider=function(t){if(0<t){var e=this.takeAwayService.dates[t-1].date;if(1<moment(this.takeAwayService.dates[t].date).diff(moment(e),"days"))return!0}return!1},e.prototype.getPaymentMethods=function(){var e=this;this.apiService.getPaymentMethods(this.widgetService.restaurant,this.cart.getTotalAmount(),"TAKEAWAY").then(function(t){e.paymentMethods=t.data,e.widgetService.applePayEligible()||(e.paymentMethods=e.paymentMethods.filter(function(t){return"applepay"!==t.id})),1===e.paymentMethods.length&&e.selectMethod(e.paymentMethods[0])})},e.prototype.selectMethod=function(t){"ideal"!==(this.cart.paymentMethod=t).id||this.issuers||this.getIdealIssuers()},e.prototype.minOrderAmountValid=function(){return"delivery"==this.cart.takeAwayMethod&&this.takeAwayService.takeAwaySettings.minDeliveryOrderAmount&&0<this.takeAwayService.takeAwaySettings.minDeliveryOrderAmount?this.cart.getTotalWithoutDelivery(!1)>=this.takeAwayService.takeAwaySettings.minDeliveryOrderAmount:!("pick-up"==this.cart.takeAwayMethod&&this.takeAwayService.takeAwaySettings.minPickUpOrderAmount&&0<this.takeAwayService.takeAwaySettings.minPickUpOrderAmount)||this.cart.getTotalWithoutDelivery(!1)>=this.takeAwayService.takeAwaySettings.minPickUpOrderAmount},e.prototype.otherDayWarning=function(){return!moment().isSame(this.cart.preferredDate,"day")},e.prototype.checkout=function(){var t=this;this.submitting=!0,this.btnDisable=!0;var e=this.cart.getTotalAmount(),i=0<e?this.cart.paymentMethod:null;0<e&&"Stripe"==this.widgetService.restaurant.paymentProvider&&(i={id:"Stripe",description:"",image:"",paymentFee:0}),this.$scope.checkout.$valid?("delivery"!==this.cart.takeAwayMethod&&(this.cart.orderInfo.address=null,this.cart.orderInfo.zipcode=null,this.cart.orderInfo.city=null),this.$timeout(function(){t.checkoutMessage=t.$translate.getTranslation("Redirecting to the payment provider may take a little longer. You will be redirected automatically. If not, please try again in a few minutes.")},3e3),this.checkoutService.createTakeAwayOrder(this.cart.orderInfo,new r.TakeAwayInfo(this.cart.takeAwayMethod,this.cart.orderInfo.comments,this.cart.preferredTime,this.cart.preferredDate),this.cart.products.map(function(t){var e=new r.OrderItem;return e.productUid=t.uid,e.quantity=t.quantity,e.priceIncOptions=t.priceIncOptions,e.options=t.options,e}),e,this.widgetService.promotionCode?this.widgetService.promotionCode.code:null,i,this.cart.issuer)):this.btnDisable=!1},e.prototype.selectedOrderTimeAvailable=function(){var i=this;this.slotTimer=this.$interval(function(){var e=i.cart.preferredTime;i.takeAwayService.updateTimes(i.cart.preferredDate,i.cart.takeAwayMethod,i.cart.products).then(function(t){t.some(function(t){return t.time==e})||(i.timeSlotExpired=!0,i.cart.preferredTime=i.takeAwayService.getFirstAvailableTime())})},6e4)},e.prototype.dateFromTime=function(t,e){t=t.split(":");return e.setHours(parseInt(t[0]),parseInt(t[1]),0,0)},e.prototype.canCheckout=function(){return this.minOrderAmountValid()&&this.takeAwayService.timesAvailable()&&!this.zipCodeInvalid},e.prototype.applyPromotionCode=function(){this.cart.applyPromotionCode(this.promotionCode)},e.$inject=["$translate","product","$filter","$interval","$scope","$rootScope","$http","$state","$stateParams","$location","$timeout","$route","$localStorage","widgetService","apiService","takeAwayService","cssService","checkoutService","sdkService","cartService","$q"],r.TakeAwayCheckoutController=e}(o.Widget||(o.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("takeAwayCheckoutController",FT.Widget.Side.TakeAwayCheckoutController),function(t){!function(t){function e(t,e,i,r,o,n,s,a,c,u,d,l,h,p,m,g){var f=this;this.$translate=t,this.$scope=e,this.$http=i,this.$state=r,this.$stateParams=o,this.$location=n,this.$timeout=s,this.$route=a,this.$localStorage=c,this.widgetService=u,this.apiService=d,this.cssService=l,this.sdkService=h,this.cart=p,this.takeAwayService=m,this.$interval=g,this.productGroups=[],this.productGroupWayPoints=[],this.expanded="",this.highlighted="",this.highlightedOnce=!1,this.orderBy=function(t){return t.ticket?1e4*-t.price:-t.price},this.widgetService.multiVenue&&(this.widgetService.reinitializeRestaurantWidget("takeaway",this.$stateParams.uid,this.$stateParams.culture),this.takeAwayService.reinitialize(),this.cart.reinitialize()),this.widgetService.restaurantLoaded().then(function(t){f.restaurant=t,f.takeAwayService.getTakeAwaySettings().then(function(t){f.takeAwayService.getFirstPossibleDate().then(function(t){f.cart.preferredDate||(f.cart.selectedDate=t,f.cart.preferredDate=moment(t.date).format("YYYY-MM-DD")),f.takeAwayService.updateTimes(f.cart.preferredDate,f.cart.takeAwayMethod,f.cart.products),f.getProducts()},function(t){f.shopClosed=!0})}),f.initialize()})}t=t.Side||(t.Side={}),e.prototype.initialize=function(){var o=this,t=this.widgetService.getWidgetId();this.cssService.setWidgetId(t),this.cssService.full(),this.sdkService.call("event",t,["ft-widget-navigated",{productType:"takeaway",widgetUid:t,page:"takeAway"}],!0),this.culture=this.$stateParams.culture,this.uid=this.$stateParams.uid;var i=this.$scope.$watch(function(){return o.takeAwayService.loaded},function(t,e){t&&(o.loaded=!0,i())}),e=this.$interval(function(){var r;!o.products||o.hasProductGroups()?o.productGroups&&0!==o.productGroups.length&&(r=document.getElementById("widget-content"),o.productGroups.forEach(function(e){var t=document.getElementById(e);if(!t)return o.productGroupWayPoints.forEach(function(t){t.destroy()}),void(o.productGroupWayPoints=[]);var i=new Waypoint({element:t,handler:function(t){o.setProductGroupInView(e),o.$scope.$apply()},context:r,offset:25}),t=new Waypoint({element:t,handler:function(t){o.setProductGroupInView(e),o.$scope.$apply()},context:r,offset:-25});o.productGroupWayPoints.push(i),o.productGroupWayPoints.push(t)}),o.$interval.cancel(e)):o.$interval.cancel(e)},500)},e.prototype.getPriceIncOptions=function(t){var i=t.price;return t.productOptions.forEach(function(e){e.chosenValue?i+=e.chosenValue.price*(e.chosenValueQuantity||1):e.chosenValues&&e.chosenValues.forEach(function(t){i+=t.price*(e.chosenValueQuantity||1)})}),i*t.quantity},e.prototype.productImageClicked=function(t,e){this.zoomedImage=t.image,e.stopPropagation()},e.prototype.showDivider=function(t){if(0<t){var e=this.takeAwayService.dates[t-1].date;if(1<moment(this.takeAwayService.dates[t].date).diff(moment(e),"days"))return!0}return!1},e.prototype.addProduct=function(t){var e=this;this.forms["product_"+t.uid].submitting=!0,this.forms["product_"+t.uid].$valid&&(this.cart.addProduct(t),this.expanded="",this.forms["product_"+t.uid].submitting=!1,this.registerAddToCartEvent(t),this.productAdded=!0,this.$timeout(function(){e.productAdded=!1},1e3),this.$timeout(function(){e.isTopVisible(t.uid)||e.scrollToProduct(t.uid)},100))},e.prototype.expandProduct=function(t){var e=this,i=this.expanded!==t;this.expanded=i?t:"",i&&this.$timeout(function(){e.isTopVisible(t)||e.scrollToProduct(t)},100)},e.prototype.scrollToProduct=function(t,e){void 0===e&&(e=5);var i=$(".widget-content.scroll").first(),r=$(".options-header").first()[0].clientHeight,t=$("#product_"+t).first()[0].offsetTop;i.animate({scrollTop:t-r-e},200)},e.prototype.isTopVisible=function(t){var e=$(".widget-content.scroll").first()[0],i=$(".options-header").first()[0].clientHeight,r=$("#product_"+t).first()[0].getBoundingClientRect(),t=r.top;r.bottom,r.height;return t>=e.getBoundingClientRect().top+i},e.prototype.minOrderAmountValid=function(){return"delivery"==this.cart.takeAwayMethod&&this.takeAwayService.takeAwaySettings.minDeliveryOrderAmount&&0<this.takeAwayService.takeAwaySettings.minDeliveryOrderAmount?this.cart.getTotalWithoutDelivery(!1)>=this.takeAwayService.takeAwaySettings.minDeliveryOrderAmount:!("pick-up"==this.cart.takeAwayMethod&&this.takeAwayService.takeAwaySettings.minPickUpOrderAmount&&0<this.takeAwayService.takeAwaySettings.minPickUpOrderAmount)||this.cart.getTotalWithoutDelivery(!1)>=this.takeAwayService.takeAwaySettings.minPickUpOrderAmount},e.prototype.toggleOptionValue=function(t,e){t.chosenValues||(t.chosenValues=[]);var i=t.chosenValues.indexOf(e);i<0?(t.chosenValues.push(e),e.selected=!0):(t.chosenValues.splice(i,1),e.selected=!1)},e.prototype.productSelected=function(t){return this.cart.getProduct(t)&&0<this.cart.getProduct(t).quantity},e.prototype.getProductOptionsSummary=function(t){return t.productOptions.map(function(t){return t.title}).join(", ").replace(/,([^,]*)$/," "+this.$translate.getTranslation("and")+"$1")},e.prototype.hasProductGroups=function(){return this.products.some(function(t){return!!t.productGroup})},e.prototype.doesPickUp=function(){return 0<this.takeAwayService.takeAwaySettings.days.filter(function(t){return 1==t.pickUpEnabled}).length},e.prototype.getStartTime=function(){var t=this.cart.selectedDate;return t?"pick-up"==this.cart.takeAwayMethod?t.pickUpStartTime:t.deliveryStartTime:0},e.prototype.getMaxOrderTime=function(){var t=this.takeAwayService.getTakeAwayDateSettings(this.cart.preferredDate);return t&&t.lastMomentToOrderDelivery&&"delivery"==this.cart.takeAwayMethod?24===this.restaurant.timeFormat?moment(t.lastMomentToOrderDelivery).format("H:mm")+" "+moment(t.lastMomentToOrderDelivery).format("L"):moment(t.lastMomentToOrderDelivery).format("h:mm A")+" "+moment(t.lastMomentToOrderDelivery).format("L"):t&&t.lastMomentToOrderPickup&&"pick-up"==this.cart.takeAwayMethod?24===this.restaurant.timeFormat?moment(t.lastMomentToOrderPickup).format("H:mm")+" "+moment(t.lastMomentToOrderPickup).format("L"):moment(t.lastMomentToOrderPickup).format("h:mm A")+" "+moment(t.lastMomentToOrderPickup).format("L"):0},e.prototype.getEndTime=function(){var t=this.cart.selectedDate;return t?"pick-up"==this.cart.takeAwayMethod?t.pickUpEndTime:t.deliveryEndTime:0},e.prototype.isInAWeek=function(t){return moment(t).diff(moment().startOf("day"),"days")<7},e.prototype.doesDelivery=function(){return 0<this.takeAwayService.takeAwaySettings.days.filter(function(t){return 1==t.deliveryEnabled}).length},e.prototype.readmore=function(t){this.opened==t?this.opened="":this.opened=t},e.prototype.productIsAvailable=function(t){return("pick-up"==this.cart.takeAwayMethod&&t.pickUpEnabled||"delivery"==this.cart.takeAwayMethod&&t.deliveryEnabled)&&(0<t.availability||null==t.availability)},e.prototype.setProductGroupInView=function(t){this.currentProductGroupInView=t},e.prototype.getProducts=function(){var r=this;this.apiService.getTakeawayProductsForDate(this.widgetService.restaurant.uid,this.cart.preferredDate).then(function(t){r.products=t.data,r.products.forEach(function(t,e){var i=r.cart.getProduct(t.uid);r.hasProductGroups()&&(t.productGroup&&"null"!==t.productGroup||(r.products[e].productGroup=r.$translate.getTranslation("Other"))),i?i.quantity<=t.availability||null==t.availability?(t.quantity=i.quantity,i.availability=t.availability):i.quantity=0:t.quantity=1}),r.hasProductGroups()&&(r.productGroups=r.products.map(function(t){return t.productGroup}).filter(function(t,e,i){return i.indexOf(t)===e}),r.setProductGroupInView(r.productGroups[0])),r.$stateParams.productUid&&!r.highlightedOnce&&r.$timeout(function(t){var e=r.products.filter(function(t){return t.uid===r.$stateParams.productUid})[0];e&&(r.highlighted=e.uid,r.expanded=e.uid,0===e.availability&&0<e.productAvailability.length&&r.selectDate(e.productAvailability[0].from),r.scrollToProduct(e.uid,15),r.$timeout(function(t){r.highlighted="",r.highlightedOnce=!0},2e3))},100)})},e.prototype.registerAddToCartEvent=function(t){var e=this.widgetService.getWidgetId(),i={productType:"takeaway",widgetUid:e,page:"takeaway-addtocart",products:[]};i.products.push({type:"takeaway",title:t.title,uid:t.uid,amount:this.getPriceIncOptions(t)*t.quantity/100,quantity:t.quantity}),this.sdkService.call("event",e,["ft-widget-navigated",i],!0)},e.prototype.closeWidget=function(){var t=this;this.cssService.close(),this.$timeout(function(){t.widgetService.home()},500)},e.prototype.checkout=function(){var e=this;this.checkingOut=!0,this.takeAwayService.updateTimes(this.cart.preferredDate,this.cart.takeAwayMethod,this.cart.products).then(function(t){e.$state.go("takeAwayCheckout",{uid:e.$stateParams.uid,culture:e.$stateParams.culture}),e.checkingOut=!1})},e.prototype.selectDate=function(t){moment(t).isSameOrAfter(moment(),"day")&&(this.cart.preferredDate=moment(t).format("YYYY-MM-DD"),this.getProducts())},e.$inject=["$translate","$scope","$http","$state","$stateParams","$location","$timeout","$route","$localStorage","widgetService","apiService","cssService","sdkService","cartService","takeAwayService","$interval"],t.TakeAwayController=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("takeAwayController",FT.Widget.Side.TakeAwayController),function(t){!function(t){function e(t,e,i,r,o,n,s,a,c,u,d,l,h){this.signalRService=t,this.$scope=e,this.$http=i,this.$state=r,this.$stateParams=o,this.$location=n,this.$timeout=s,this.$route=a,this.$localStorage=c,this.widgetService=u,this.apiService=d,this.cssService=l,this.sdkService=h,this.purchaseEventThrown=!1,this.initialize()}t=t.Side||(t.Side={}),e.prototype.initialize=function(){var e=this;this.cssService.setWidgetId(this.widgetService.getWidgetId()),this.cssService.full(),this.checking=!0,this.culture=this.$stateParams.culture,this.uid=this.$stateParams.uid,this.type=this.$stateParams.type,this.orderUid=this.$state.params.order||this.$state.params["ft-order"],this.paymentRequired="true"==this.$stateParams.paymentRequired,this.signalRService.subscribe("order_"+this.orderUid),this.signalRService.addListener("paymentRedirect","takeAwayFinishController",function(t){e.widgetService.redirect(t)}),this.$scope.$on("$destroy",function(){e.signalRService.unSubscribe("order_"+e.uid)}),this.$timeout(function(){e.loadOrder(e.orderUid),e.checking&&(e.loadOrder(e.orderUid),e.paymentRequired&&e.redirectToPayment())},3e3)},e.prototype.redirectToPayment=function(){var e=this;this.apiService.getPaymentUrlForOrder(this.orderUid).then(function(t){t=t.data;t?e.widgetService.redirect(t):e.$timeout(function(){e.redirectToPayment()},5e3)})},e.prototype.goToPayment=function(){window.top.location.href=this.paymentUrl},e.prototype.isToday=function(t){return moment(t).isSame(new Date,"day")},e.prototype.loadOrder=function(t){var e=this;this.apiService.getOrder(this.widgetService.restaurant,t).then(function(t){return e.order=t.data,e.checking=!1,$(".ticket-screen").addClass("finished"),"CREATED"===e.order.status?(e.signalRService.addListener("updateOrder","takeAwayFinishController",function(t){e.order.uid===t&&e.loadOrder(e.order.uid)}),!1):void("ORDERED"!==e.order.status||e.purchaseEventThrown||e.registerPurchaseEvent())})},e.prototype.registerPurchaseEvent=function(){var t=this.widgetService.getWidgetId();this.sdkService.call("event",t,["ft-widget-ordered",{productType:"takeaway",widgetUid:t,order:{uid:this.order.uid,totalAmount:this.order.totalAmount/100,products:this.order.products.map(function(t){return{type:"takeAway",uid:t.productId,title:t.description,quantity:t.quantity,amount:t.singlePrice/100}})}}],!0),this.purchaseEventThrown=!0,this.sdkService.call("event",t,["ft-widget-navigated",{productType:"takeaway",widgetUid:t,page:"finish",products:this.order.products&&this.order.products.map(function(t){return{type:"takeAway",uid:t.productId,title:t.description,quantity:t.quantity,amount:t.singlePrice/100}})}],!0)},e.prototype.close=function(){var t=this;this.cssService.close(),this.$timeout(function(){t.widgetService.home()},500)},e.$inject=["signalRService","$scope","$http","$state","$stateParams","$location","$timeout","$route","$localStorage","widgetService","apiService","cssService","sdkService"],t.TakeAwayFinishController=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("takeAwayFinishController",FT.Widget.Side.TakeAwayFinishController),function(t){!function(t){function e(t,e,i,r,o,n,s,a,c,u,d,l){this.webUrl=t,this.$scope=e,this.$http=i,this.$state=r,this.$stateParams=o,this.$location=n,this.$timeout=s,this.$route=a,this.$localStorage=c,this.widgetService=u,this.cssService=d,this.sdkService=l,this.initialize()}t=t.Side||(t.Side={}),e.prototype.initialize=function(){var t=this.widgetService.getWidgetId();this.cssService.setWidgetId(t),this.cssService.full(),this.sdkService.call("event",t,["ft-widget-navigated",{widgetUid:t,page:"terms"}],!0),this.culture="nl"===this.$stateParams.culture?"nl":"de"===this.$stateParams.culture?"de":"en",this.uid=this.$stateParams.uid},e.$inject=["webUrl","$scope","$http","$state","$stateParams","$location","$timeout","$route","$localStorage","widgetService","cssService","sdkService"],t.TermsController=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("termsController",FT.Widget.Side.TermsController),function(i){!function(t){function e(t,e,i,r,o,n,s,a,c,u,d,l,h,p){var m=this;this.$translate=t,this.$scope=e,this.$http=i,this.$state=r,this.$stateParams=o,this.$location=n,this.$timeout=s,this.$route=a,this.$localStorage=c,this.widgetService=u,this.apiService=d,this.timeSpanService=l,this.cssService=h,this.sdkService=p,this.weekDays=[moment.weekdaysShort(1),moment.weekdaysShort(2),moment.weekdaysShort(3),moment.weekdaysShort(4),moment.weekdaysShort(5),moment.weekdaysShort(6),moment.weekdaysShort(0)],this.handoffDrawerOpen=!1,this.showCalendar=!1,this.showPeople=!1,this.showTimes=!1,this.noAvailability=!1,this.widgetService.restaurantLoaded().then(function(t){m.restaurant=t,m.initialize()})}t=t.Side||(t.Side={}),e.prototype.initialize=function(){this.cssService.setWidgetId(this.widgetService.getWidgetId()),this.cssService.small(),this.culture=this.$stateParams.culture,this.uid=this.$stateParams.uid,this.ticketId=this.$stateParams.ticketId,this.currentBooking=this.widgetService.booking,(this.widgetService.getIsNumberOfPeopleChanged()||this.widgetService.getIsSearchDateChanged()||this.widgetService.getIsSearchTimeChanged())&&(this.message="We've changed the reservation details to match the availability of this ticket."),this.tableTicketLink=this.widgetService.currentTableLink,this.getTicket()},e.prototype.clearMessage=function(){this.message="",this.widgetService.resetSearchParamChangeFlags()},e.prototype.getTicket=function(){var i=this;this.apiService.getProduct(this.widgetService.restaurant.uid,this.ticketId,this.widgetService.friendCode).then(function(t){i.ticket=t.data;t=i.widgetService.getWidgetId();i.sdkService.call("event",t,["ft-widget-navigated",{productType:"ticket",widgetUid:t,page:"ticket/"+i.ticket.uid,from:i.$stateParams.from,products:[{type:"ticket",title:i.ticket.title,uid:i.ticket.uid,amount:i.ticket.price/100,quantity:i.currentBooking.numberOfPeople}]}],!0),i.widgetService.voucher&&i.widgetService.voucher.ticket&&i.widgetService.voucher.ticket.uid===i.ticket.uid?i.currentBooking.numberOfPeople=i.widgetService.voucher.quantity:i.widgetService.waitlistItem.partySize?i.currentBooking.numberOfPeople=i.widgetService.waitlistItem.partySize:i.currentBooking.numberOfPeople=i.widgetService.searchParams.numberOfPeople,null!==i.currentBooking.numberOfPeople&&i.ticket.minPartySize>i.currentBooking.numberOfPeople&&(i.currentBooking.numberOfPeople=i.ticket.minPartySize,!i.widgetService.ticketOnly&&i.$stateParams.from&&(i.message="We've changed the reservation details to match the availability of this ticket.",i.widgetService.setIsNumberOfPeopleChanged())),i.ticket.maxPartySize<i.currentBooking.numberOfPeople&&(i.currentBooking.numberOfPeople=i.ticket.maxPartySize,!i.widgetService.ticketOnly&&i.$stateParams.from&&(i.message="We've changed the reservation details to match the availability of this ticket.",i.widgetService.setIsNumberOfPeopleChanged())),i.currentBooking.bookingDate=i.widgetService.searchParams.bookingDate,i.currentBooking.bookingTime=i.widgetService.searchParams.bookingTime;t="search"==i.$stateParams.from||void 0!==i.widgetService.waitlistItem.date&&void 0!==i.widgetService.waitlistItem.fromTime;i.apiService.getFirstDateTime(i.widgetService.restaurant,i.widgetService.dateFromBooking(i.currentBooking),i.$translate.getCurrentCulture(),i.currentBooking.numberOfPeople,i.ticketId,i.widgetService.friendCode,i.widgetService.voucher?i.widgetService.voucher.code:"",t).then(function(t){var e=t.data;null===i.currentBooking.numberOfPeople&&(i.currentBooking.numberOfPeople=e.partySize),moment(e.time).format("YYYY-MM-DD")==moment(i.widgetService.searchParams.bookingDate).format("YYYY-MM-DD")&&e.timeString==i.widgetService.searchParams.bookingTime||i.widgetService.ticketOnly||!i.$stateParams.from||(i.message="We've changed the reservation details to match the availability of this ticket.",i.widgetService.setIsSearchDateChanged(),i.widgetService.setIsSearchTimeChanged()),i.$stateParams.waitlistItem&&i.widgetService.waitlistItemLoaded().then(function(t){(moment(e.time).format("YYYY-MM-DD")!=moment(t.date).format("YYYY-MM-DD")||e.minutes>t.untilTime||e.minutes<t.fromTime)&&i.$state.go("waitlistSpotUnavailable",{uid:i.$stateParams.uid,culture:i.$stateParams.culture,waitlistItem:i.$stateParams.waitlistItem})}),i.setTime(e,!0),i.apiService.getTableLinkForTicket(i.uid,i.ticketId,i.currentBooking.numberOfPeople,i.currentBooking.bookingDate,e.minutes).then(function(t){return i.tableTicketLink=t}),i.apiService.getTimesForDay(i.widgetService.restaurant,new Date(i.widgetService.dateFromBooking(i.currentBooking)),i.currentBooking.numberOfPeople,i.ticket.uid,i.widgetService.friendCode,i.widgetService.voucher?i.widgetService.voucher.code:"").then(function(t){i.ticketTimes=t.data});i.$scope.$watch(function(){return i.currentBooking.bookingDate},function(t,e){e!==t&&i.apiService.getTimesForDay(i.widgetService.restaurant,new Date(i.widgetService.dateFromBooking(i.currentBooking)),i.currentBooking.numberOfPeople,i.ticket.uid,i.widgetService.friendCode,i.widgetService.voucher?i.widgetService.voucher.code:"").then(function(t){i.ticketTimes=t.data;var e=i.ticketTimes.filter(function(t){return"UNAVAILABLE"!=t.status});e.length?(i.noAvailability=!1,0<(t=e.filter(function(t){return moment(t.time).format("HH:mm")==i.currentBooking.bookingTime})).length?(i.verifyAndNotifyForTimeChanges(t[0].time,t[0].timeString,t[0].partySize),i.setTime(t[0],!1)):(i.verifyAndNotifyForTimeChanges(e[0].time,e[0].timeString,e[0].partySize),i.setTime(e[0],!1))):i.noAvailability=!0})},!1),i.$scope.$watch(function(){return i.currentBooking.numberOfPeople},function(t,e){e!==t&&i.apiService.getFirstDateTime(i.widgetService.restaurant,i.widgetService.dateFromBooking(i.currentBooking),i.currentBooking.culture,i.currentBooking.numberOfPeople,i.ticket.uid,i.widgetService.friendCode,i.widgetService.voucher?i.widgetService.voucher.code:"").then(function(t){t=t.data;i.verifyAndNotifyForTimeChanges(t.time,t.timeString,t.partySize),i.setTime(t,!0)},function(t){i.noAvailability=!0})},!1)},function(t){i.noAvailability=!0})})},e.prototype.verifyAndNotifyForTimeChanges=function(t,e,i){moment(t).format("YYYY-MM-DD")==moment(this.currentBooking.bookingDate).format("YYYY-MM-DD")&&e==this.currentBooking.bookingTime&&i==this.currentBooking.numberOfPeople||(this.message="We've changed the reservation details to match the availability of this ticket.",this.widgetService.setIsNumberOfPeopleChanged(),this.widgetService.setIsSearchDateChanged(),this.widgetService.setIsSearchTimeChanged())},e.prototype.close=function(){var t=this;this.cssService.close(),this.$timeout(function(){t.widgetService.home()},500)},e.prototype.openSelect=function(e){var i=this;this[e="show"+e]?this[e]=!1:(this.showCalendar=!1,this.showPeople=!1,this.showTimes=!1,this[e]=!0,$(".widget-container").on("click."+e,function(t){i[e]=!1,i.$scope.$apply(),$(".widget-container").off("click."+e)}))},e.prototype.continue=function(){if(!this.showPeople&&!this.showCalendar&&!this.showTimes){if(!this.currentBooking.bookingTime||!this.currentBooking.bookingDate)return this.$state.go("error",{uid:this.uid,culture:this.culture,errorMessage:this.$translate.getTranslation("No correct booking date or time selected."),errorCode:400}),!1;this.widgetService.widgetToTableLandingEnabled&&this.widgetService.trackNavAction("TicketContinueOnWidget",{ticketUid:this.ticket.uid}),this.widgetService.selectedTicket=this.ticket,this.$state.go("checkout",{uid:this.uid,culture:this.culture})}},e.prototype.waitlist=function(){this.widgetService.waitlistItem.partySize=this.currentBooking.numberOfPeople,this.widgetService.waitlistItem.fromTime=i.Helpers.DateHelper.minutesFromTime(this.currentBooking.bookingTime),this.widgetService.waitlistItem.untilTime=i.Helpers.DateHelper.minutesFromTime(this.currentBooking.bookingTime),this.widgetService.waitlistItem.date=this.currentBooking.bookingDate,this.widgetService.waitlistItem.duration=this.currentBooking.bookingDuration,this.widgetService.waitlistItem.productUid=this.ticket.uid,this.widgetService.selectedTicket=this.ticket,this.$state.go("waitlist",{uid:this.uid,culture:this.culture})},e.prototype.getTillTime=function(t){return 24===this.restaurant.timeFormat?moment(t.time).add(t.maxDuration,"minutes").format("H:mm"):moment(t.time).add(t.maxDuration,"minutes").format("h:mm A")},e.prototype.setPeople=function(t){this.currentBooking.numberOfPeople=t,this.widgetService.searchParams.numberOfPeople=t,this.showPeople=!1,this.updateTicketDeepLink()},e.prototype.setTime=function(t,e){this.widgetService.setBookingTimes(t,e),this.showTimes=!1,this.onlyWaitlist="WAITLIST"==t.status,this.updateTicketDeepLink()},e.prototype.updateTicketDeepLink=function(){var e=this;this.apiService.getTableLinkForTicket(this.uid,this.ticketId,this.currentBooking.numberOfPeople,this.widgetService.booking.bookingDate,i.Helpers.DateHelper.minutesFromTime(this.widgetService.booking.bookingTime)).then(function(t){return e.tableTicketLink=t})},e.prototype.windowDisplayLimits=function(t){return!!t&&(!("y"==t[1]&&1<=parseInt(t[0]))&&(!("M"==t[1]&&12<parseInt(t[0]))&&(!("w"==t[1]&&52<parseInt(t[0]))&&(("m"!=t[1]||0!=parseInt(t[0]))&&!("d"==t[1]&&365<parseInt(t[0]))))))},e.prototype.bookingWindowString=function(t,e){var i=this.windowDisplayLimits(t),r=this.windowDisplayLimits(e);return i||r?i&&r?this.$translate.getTranslation("Bookable from {0} up to {1} in advance",this.timeSpanService.toString(e),this.timeSpanService.toString(t)):i?this.$translate.getTranslation("Bookable up to {0} in advance",this.timeSpanService.toString(t)):r?this.$translate.getTranslation("Bookable {0} in advance",this.timeSpanService.toString(e)):void 0:""},e.prototype.showBookingWindowMessage=function(){return-1<this.restaurant.features.indexOf("WIDGET_BOOKING_WINDOW_MESSAGE")&&""!==this.bookingWindowString(this.ticket.bookingWindowMin,this.ticket.bookingWindowMax)},e.prototype.onRedirectToTable=function(t){var e=this;t.preventDefault(),this.widgetService.trackNavAction("TableTicketLinkTapped",{ticketUid:this.ticket.uid}).then(function(){window.top.location=e.tableTicketLink.directLink}),setTimeout(function(){window.top.location=e.tableTicketLink.directLink},500)},e.$inject=["$translate","$scope","$http","$state","$stateParams","$location","$timeout","$route","$localStorage","widgetService","apiService","timeSpanService","cssService","sdkService"],t.TicketController=e}(i.Widget||(i.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("ticketController",FT.Widget.Side.TicketController),function(t){(function(i){i.MULTI_STATE_NAME="multi";var t=(e.prototype.open=function(t){var e=this.$state.current.name;$("body").hasClass("ft-open")&&(e===t||this.widgetService.multiVenue&&e===i.MULTI_STATE_NAME)?this.cssService.close("toolbar"):($("body").hasClass("ft-open")||(this.cssService.open("toolbar"),"book"===t&&this.widgetService.triggerBookingIntent()),this.widgetService.multiVenue?this.widgetService.clickedToolbarState=t:this.$state.go(t,{uid:this.$stateParams.uid,culture:this.$stateParams.culture}))},e.$inject=["$scope","$timeout","widgetService","$stateParams","$state","cssService","sdkService","takeAwayService"],e);function e(t,e,i,r,o,n,s,a){var c=this;this.$scope=t,this.$timeout=e,this.widgetService=i,this.$stateParams=r,this.$state=o,this.cssService=n,this.sdkService=s,this.takeAwayService=a,this.cssService.setWidgetId(this.widgetService.getWidgetId()),this.$scope.$on("searchReady",function(){c.ready=!0}),this.$timeout(function(){c.ready=!0},3e3)}i.ToolbarController=t})((t=t.Widget||(t.Widget={})).Side||(t.Side={}))}(FT=FT||{}),angular.module("widgetSide").controller("toolbarController",FT.Widget.Side.ToolbarController),function(t){!function(t){function e(t,e,i,r,o,n,s){this.$state=t,this.$stateParams=e,this.$timeout=i,this.widgetService=r,this.apiService=o,this.cssService=n,this.trackingService=s,this.initialize()}t=t.Side||(t.Side={}),e.prototype.initialize=function(){var t=this;this.cssService.setWidgetId(this.widgetService.getWidgetId()),this.cssService.small(),this.culture=this.$stateParams.culture,this.uid=this.$stateParams.uid,this.recipientId=this.$stateParams.rid,this.email=this.$state.params.email||this.$state.params["ft-unsubscribe"],this.email&&(this.email=this.email.replace(/ /g,"+")),this.code=this.$state.params.code||this.$state.params["ft-code"],this.recipientId=this.$state.params.recipientId||this.$state.params["ft-rid"],this.$timeout(function(){t.unsubscribe()},1500)},e.prototype.unsubscribe=function(){var e=this;this.apiService.unsubscribe(this.email,this.uid,this.code,this.recipientId).then(function(t){t.data?(e.trackingService.logUnsubscribeGuest(e.email),e.unsubscribed=!0):e.failed=!0})},e.prototype.close=function(){var t=this;this.cssService.close(),this.$timeout(function(){t.widgetService.home()},500)},e.$inject=["$state","$stateParams","$timeout","widgetService","apiService","cssService","trackingService"],t.UnsubscribeController=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("unsubscribeController",FT.Widget.Side.UnsubscribeController),function(r){!function(t){var y;function e(t,e,i,r,o,n,s,a,c,u,d,l,h,p,m,g,f,v){var S=this;this.product=t,this.$filter=e,this.$scope=i,this.$rootScope=r,this.$http=o,this.$state=n,this.$stateParams=s,this.$location=a,this.$timeout=c,this.$route=u,this.$localStorage=d,this.widgetService=l,this.apiService=h,this.timeSpanService=p,this.cssService=m,this.checkoutService=g,this.sdkService=f,this.$q=v,this.orderInfo=new y.OrderInfo,this.voucherInfo=new y.VoucherInfo,this.quantity=1,this.minQuantity=1,this.maxQuantity=null,this.terms=!1,this.sendLater=!1,this.submitting=!1,this.btnDisable=!1,this.sendAtDate=p.dateFromNow(0,0,1),this.sendAtTime="12:00",this.sendAtStartTimeOptions="00:00",this.today=moment(new Date).add(-1,"days").toDate(),this.$scope.$watch(function(){return S.sendAtDate.toString()+S.sendAtTime},function(t,e){t!==e&&S.setSendAt()}),this.widgetService.restaurantLoaded().then(function(t){S.initialize()})}y=t.Side||(t.Side={}),e.prototype.initialize=function(){var t=this,e=this.widgetService.getWidgetId();this.cssService.setWidgetId(e),this.cssService.full();var i={widgetUid:e,productType:"voucher",page:"checkout"};this.product&&(i.products=[{type:"voucher",title:this.product.title,uid:this.product.uid,amount:this.product.price/100,quantity:this.quantity}]),this.sdkService.call("event",e,["ft-widget-navigated",i],!0),this.culture=this.$stateParams.culture,this.uid=this.$stateParams.uid,this.$localStorage.title&&this.widgetService.showTitleInCheckout()&&(this.orderInfo.title=this.$localStorage.title),this.orderInfo.company="true"===this.$localStorage.company,this.orderInfo.companyName=this.$localStorage.companyName,this.orderInfo.firstName=this.$localStorage.firstName,this.orderInfo.lastName=this.$localStorage.lastName,this.orderInfo.email=this.$localStorage.email,this.orderInfo.telephone=this.$localStorage.telephone,this.orderInfo.culture=this.culture,this.widgetService.voucherService.getVoucherSettings(this.widgetService.restaurant.uid).then(function(){t.expirationDate=t.timeSpanService.dateFromNow(t.widgetService.voucherService.voucherSettings.expirationTime)}),r.Helpers.StorageHelper.storageAvailable("sessionStorage")&&sessionStorage.setItem("product",JSON.stringify(this.product)),this.product.ticket&&(this.minQuantity=(0<this.product.ticket.minPartySize?this.product.ticket:this.widgetService.restaurant).minPartySize,this.maxQuantity=(0<this.product.ticket.maxPartySize?this.product.ticket:this.widgetService.restaurant).maxPartySize,this.quantity=this.minQuantity<=2&&2<=this.maxQuantity?2:this.minQuantity),0<this.getTotalAmount()&&this.getPaymentMethods(),this.voucherInfo.culture=this.$stateParams.culture,this.widgetService.promotionCodeLoaded().then(function(){t.setPromotionCode()})},e.prototype.changeQuantity=function(t){this.quantity+t<=this.maxQuantity&&this.quantity+t>=this.minQuantity&&(this.quantity=this.quantity+t)},e.prototype.sendToFriendChanged=function(){this.voucherInfo.sendToFriend||(this.voucherInfo.sendAt=null,this.sendLater=!1)},e.prototype.setSendAt=function(){moment(this.sendAtDate).isSame(new Date,"day")?(this.sendAtStartTimeOptions=this.getNextQuarter(),this.dateFromTime(this.sendAtTime,new Date)<(new Date).getTime()&&(this.sendAtTime=this.sendAtStartTimeOptions)):this.sendAtStartTimeOptions="00:00";var t=this.sendAtTime.split(":");this.voucherInfo.sendAt=new Date(this.sendAtDate.setHours(parseInt(t[0]),parseInt(t[1])))},e.prototype.toggleSendAt=function(){this.sendLater=!this.sendLater,this.sendLater?this.setSendAt():this.voucherInfo.sendAt=null},e.prototype.getNextQuarter=function(){var t=(new Date).getMinutes()%15;return moment().add(15-t,"minutes").format("HH:mm")},e.prototype.getIdealIssuers=function(){var e=this;this.apiService.getIdealIssuers(this.widgetService.restaurant).then(function(t){e.issuers=t.data})},e.prototype.getPaymentMethods=function(){var e=this;this.apiService.getPaymentMethods(this.widgetService.restaurant,this.getProductAmount(),"GIFTVOUCHER").then(function(t){e.paymentMethods=t.data,e.widgetService.applePayEligible()||(e.paymentMethods=e.paymentMethods.filter(function(t){return"applepay"!==t.id})),1===e.paymentMethods.length&&e.selectMethod(e.paymentMethods[0])})},e.prototype.getProductAmount=function(){return this.product?this.product.price*this.quantity:0},e.prototype.getTotalAmount=function(t,e){if(void 0===t&&(t=!0),void 0===e&&(e=!1),!this.product)return 0;var i=0,i=r.Helpers.PromotionCodeHelper.applyPromotionCodeToTotalAmount(i,this.promotionCode&&t&&!this.promotionCode.perOrder&&!this.promotionCode.invalid?this.promotionCode:null,this.product.uid,this.quantity,this.product.price);return this.promotionCode&&this.promotionCode.perOrder&&(i=r.Helpers.PromotionCodeHelper.applyPerOrderPromotionCodeToTotalAmount(i,t&&!this.promotionCode.invalid?this.promotionCode:null)),this.paymentMethod&&(i+=this.paymentMethod.paymentFee),i<0&&!e?0:i},e.prototype.selectMethod=function(t){"ideal"!==(this.paymentMethod=t).id||this.issuers||this.getIdealIssuers()},e.prototype.checkout=function(){this.submitting=!0,this.btnDisable=!0;var t=this.getTotalAmount(),e=0<t?this.paymentMethod:null;0<t&&"Stripe"==this.widgetService.restaurant.paymentProvider&&(e={id:"Stripe",description:"",image:"",paymentFee:0}),this.$scope.checkout.$valid?this.checkoutService.createProductOrder(this.orderInfo,this.product.uid,this.quantity,t,this.widgetService.promotionCode?this.widgetService.promotionCode.code:null,e,this.issuer,this.voucherInfo,this.product):this.btnDisable=!1},e.prototype.dateFromTime=function(t,e){t=t.split(":");return e.setHours(parseInt(t[0]),parseInt(t[1]),0,0)},e.prototype.applyPromotionCode=function(){var e=this;this.checkAndApplyPromotionCode().then(function(t){t||(e.invalidPromotionCode=!0,e.getTotalAmount())})},e.prototype.removePromotionCode=function(){this.invalidPromotionCode=!1,this.invalidPromotionCodeTicket=!1,this.invalidPromotionCodeProductType=!1,this.widgetService.promotionCode=null,this.promotionCode=null,this.getTotalAmount()},e.prototype.checkAndApplyPromotionCode=function(){var e=this,i=this.$q.defer();return this.promotionCode?i.resolve(!1):this.widgetService.checkPromotionCode("GIFTVOUCHER",this.code).then(function(t){t&&(e.setPromotionCode(),e.invalidPromotionCode=!1,i.resolve(!0)),i.resolve(!1)}),i.promise},e.prototype.setPromotionCode=function(){this.code="",this.promotionCode=this.widgetService.promotionCode,this.promotionCode&&("GIFTVOUCHER"!==this.promotionCode.productType&&(this.promotionCode.invalid=!0,this.invalidPromotionCodeProductType=!0),r.Helpers.PromotionCodeHelper.promotionCodeAppliesToProduct(this.promotionCode,this.product.uid)||(this.promotionCode.invalid=!0,this.invalidPromotionCodeTicket=!0),this.getTotalAmount())},e.$inject=["product","$filter","$scope","$rootScope","$http","$state","$stateParams","$location","$timeout","$route","$localStorage","widgetService","apiService","timeSpanService","cssService","checkoutService","sdkService","$q"],y.VoucherCheckoutController=e}(r.Widget||(r.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("voucherCheckoutController",FT.Widget.Side.VoucherCheckoutController),function(t){!function(t){function e(t,e,i,r,o,n,s,a,c,u,d,l,h){this.signalRService=t,this.$scope=e,this.$http=i,this.$state=r,this.$stateParams=o,this.$location=n,this.$timeout=s,this.$route=a,this.$localStorage=c,this.widgetService=u,this.apiService=d,this.cssService=l,this.sdkService=h,this.initialize()}t=t.Side||(t.Side={}),e.prototype.initialize=function(){var e=this;this.cssService.setWidgetId(this.widgetService.getWidgetId()),this.cssService.full(),this.checking=!0,this.culture=this.$stateParams.culture,this.uid=this.$stateParams.uid,this.type=this.$stateParams.type,this.orderUid=this.$state.params.order||this.$state.params["ft-order"],this.paymentRequired="true"==this.$stateParams.paymentRequired,this.signalRService.subscribe("order_"+this.orderUid),this.signalRService.addListener("paymentRedirect","shopFinishController",function(t){e.widgetService.redirect(t)}),this.$scope.$on("$destroy",function(){e.signalRService.unSubscribe("order_"+e.uid)}),this.$timeout(function(){e.checking&&(e.loadOrder(e.orderUid),e.paymentRequired&&e.redirectToPayment())},3e3)},e.prototype.redirectToPayment=function(){var e=this;this.apiService.getPaymentUrlForOrder(this.orderUid).then(function(t){t.data?e.widgetService.redirect(t.data):e.$timeout(function(){e.redirectToPayment()},5e3)})},e.prototype.goToPayment=function(){window.top.location.href=this.paymentUrl},e.prototype.loadOrder=function(e){var i=this;this.apiService.getOrder(this.widgetService.restaurant,e).then(function(t){i.order=t.data;t=i.widgetService.getWidgetId();i.sdkService.call("event",t,["ft-widget-navigated",{productType:"voucher",widgetUid:t,page:"finish",products:i.order.products.map(function(t){return{type:"voucher",uid:t.productId,title:t.description,quantity:t.quantity,amount:t.singlePrice/100}})}],!0),i.apiService.getVoucherInfoForOrder(i.widgetService.restaurant,e).then(function(t){return i.voucherInfo=t.data,i.checking=!1,$(".ticket-screen").addClass("finished"),"CREATED"===i.order.status?(i.signalRService.addListener("updateOrder","voucherFinishController",function(t){i.order.uid===t&&(i.loadOrder(i.order.uid),i.registerPurchaseEvent())}),!1):void i.registerPurchaseEvent()})})},e.prototype.registerPurchaseEvent=function(){var t=this.widgetService.getWidgetId();"ORDERED"===this.order.status&&this.sdkService.call("event",t,["ft-widget-ordered",{productType:"voucher",widgetUid:t,order:{uid:this.order.uid,totalAmount:this.order.totalAmount/100,products:this.order.products.map(function(t){return{type:"voucher",uid:t.productId,title:t.description,quantity:t.quantity,amount:t.singlePrice/100}})}}],!0)},e.prototype.close=function(){var t=this;this.cssService.close(),this.$timeout(function(){t.widgetService.home()},500)},e.$inject=["signalRService","$scope","$http","$state","$stateParams","$location","$timeout","$route","$localStorage","widgetService","apiService","cssService","sdkService"],t.VoucherFinishController=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("voucherFinishController",FT.Widget.Side.VoucherFinishController),function(t){!function(t){function e(t,e,i,r,o,n,s,a,c,u,d,l,h){var p=this;this.$scope=t,this.$http=e,this.$state=i,this.$stateParams=r,this.$location=o,this.$timeout=n,this.$route=s,this.$localStorage=a,this.widgetService=c,this.apiService=u,this.cssService=d,this.sdkService=l,this.voucherService=h,this.orderBy=function(t){return t.ticket?1e4*-t.price:-t.price},this.widgetService.multiVenue?this.apiService.getRestaurant(this.$stateParams.uid,this.$stateParams.culture).then(function(t){t=t.data;p.widgetService.reinitializeRestaurantWidget("vouchers",p.$stateParams.uid,p.$stateParams.culture),p.widgetService.reloadRestaurant(t),p.restaurant=t,p.initialize()}):this.widgetService.restaurantLoaded().then(function(t){p.restaurant=t,p.initialize()})}t=t.Side||(t.Side={}),e.prototype.readmore=function(t){this.opened==t?this.opened="":this.opened=t},e.prototype.getProducts=function(){var e=this;this.apiService.getProducts(this.restaurant.uid,"GIFTVOUCHER").then(function(t){e.products=t.data})},e.prototype.initialize=function(){var t=this.widgetService.getWidgetId();this.cssService.setWidgetId(t),this.cssService.full(),this.sdkService.call("event",t,["ft-widget-navigated",{productType:"voucher",widgetUid:t,page:"voucher"}],!0),this.culture=this.$stateParams.culture,this.widgetService.voucherService.getVoucherSettings(this.restaurant.uid),this.getProducts()},e.prototype.selectProduct=function(t){this.$state.go("voucherCheckout",{uid:this.restaurant.uid,culture:this.$stateParams.culture,productUid:t.uid})},e.prototype.closeWidget=function(){var t=this;this.cssService.close(),this.$timeout(function(){t.widgetService.home()},500)},e.$inject=["$scope","$http","$state","$stateParams","$location","$timeout","$route","$localStorage","widgetService","apiService","cssService","sdkService","voucherService"],t.VouchersController=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("vouchersController",FT.Widget.Side.VouchersController),function(i){!function(t){function e(t,e,i,r,o,n,s,a,c,u,d,l,h,p,m,g){this.$filter=t,this.$scope=e,this.$rootScope=i,this.$http=r,this.$state=o,this.$stateParams=n,this.$location=s,this.$timeout=a,this.$route=c,this.$localStorage=u,this.widgetService=d,this.apiService=l,this.timeSpanService=h,this.cssService=p,this.checkoutService=m,this.sdkService=g,this.submitting=!1,this.showRange=!1,this.initialize()}t=t.Side||(t.Side={}),e.prototype.initialize=function(){var e=this,t=this.widgetService.getWidgetId();this.cssService.setWidgetId(t),this.cssService.full(),this.culture=this.$stateParams.culture,this.uid=this.$stateParams.uid,this.waitlistItem=this.widgetService.waitlistItem,this.ticket=this.widgetService.selectedTicket,this.restaurant=this.widgetService.restaurant,this.$localStorage.title&&this.widgetService.showTitleInCheckout()&&(this.waitlistItem.title=this.$localStorage.title),this.waitlistItem.company="true"===this.$localStorage.company,this.waitlistItem.companyName=this.$localStorage.companyName,this.waitlistItem.firstName=this.$localStorage.firstName,this.waitlistItem.lastName=this.$localStorage.lastName,this.waitlistItem.email=this.$localStorage.email,this.waitlistItem.telephone=this.$localStorage.telephone,i.Helpers.StorageHelper.storageAvailable("sessionStorage")&&(sessionStorage.setItem("ticket",JSON.stringify(this.ticket)),sessionStorage.setItem("waitlistItem",JSON.stringify(this.waitlistItem))),this.apiService.getTimesForDay(this.widgetService.restaurant,this.waitlistItem.date,this.waitlistItem.partySize,this.waitlistItem.productUid,this.widgetService.friendCode).then(function(t){e.times=t.data.filter(function(t){return"WAITLIST"===t.status})}),this.sdkService.call("event",t,["ft-widget-navigated",{widgetUid:t,page:"waitinglist"}],!0)},e.prototype.toggleRange=function(){this.showRange?this.waitlistItem.untilTime=Math.min(this.waitlistItem.fromTime+60,Math.max.apply(Math,this.times.map(function(t){return t.minutes}))):this.waitlistItem.untilTime=this.waitlistItem.fromTime},e.prototype.fromTimeChanged=function(t){(!this.showRange||this.waitlistItem.untilTime<this.waitlistItem.fromTime)&&(this.waitlistItem.untilTime=this.waitlistItem.fromTime)},e.prototype.untilTimeChanged=function(t){this.waitlistItem.fromTime>this.waitlistItem.untilTime&&(this.waitlistItem.fromTime=this.waitlistItem.untilTime)},e.prototype.submit=function(){this.submitting=!0,this.btnDisable=!0,this.$scope.waitlistItemForm.$valid?this.checkoutService.createWaitlistItem(this.waitlistItem):this.btnDisable=!1},e.$inject=["$filter","$scope","$rootScope","$http","$state","$stateParams","$location","$timeout","$route","$localStorage","widgetService","apiService","timeSpanService","cssService","checkoutService","sdkService"],t.WaitlistController=e}(i.Widget||(i.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("waitlistController",FT.Widget.Side.WaitlistController),function(t){!function(t){function e(t,e,i,r,o){this.$stateParams=t,this.$timeout=e,this.widgetService=i,this.apiService=r,this.cssService=o,this.initialize()}t=t.Side||(t.Side={}),e.prototype.initialize=function(){this.cssService.setWidgetId(this.widgetService.getWidgetId()),this.cssService.full(),this.waitlistItem=this.widgetService.waitlistItem,this.ticket=this.widgetService.selectedTicket,this.uid=this.$stateParams.uid,this.initWidgetToTablePromotion()},e.prototype.isToday=function(t){return moment(t).isSame(new Date,"day")},e.prototype.close=function(){var t=this;this.cssService.close(),this.$timeout(function(){t.widgetService.home()},500)},e.prototype.initWidgetToTablePromotion=function(){var i=this;this.apiService.getTableLinkForWaitlist(this.uid,this.waitlistItem.id).then(function(t){var e=document.getElementById("waitlist_qr");e&&!i.qrCode&&(i.qrCode=new QRCode(e,{text:t.directLink,width:160,height:160,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.L}))})},e.$inject=["$stateParams","$timeout","widgetService","apiService","cssService"],t.WaitlistFinishController=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("waitlistFinishController",FT.Widget.Side.WaitlistFinishController),function(t){!function(t){function e(t,e,i,r,o,n,s,a){var c=this;this.$translate=t,this.widgetService=e,this.$stateParams=i,this.$state=r,this.apiService=o,this.sdkService=n,this.cssService=s,this.$timeout=a,this.unsubScribeButtonEnabled=!0;a=this.widgetService.getWidgetId();this.cssService.setWidgetId(a),this.widgetService.waitlistItemLoaded().then(function(t){c.waitlistItem=t}),this.sdkService.call("event",a,["ft-widget-navigated",{widgetUid:a,page:"waitlistSpotUnavailableController",productType:"waitlist"}],!0)}t=t.Side||(t.Side={}),e.prototype.bookAnotherTime=function(){this.sdkService.call("clearParams",this.widgetService.getWidgetId(),["widget"]),this.widgetService.home()},e.prototype.unsubscribeFromWaitlist=function(){var e=this;this.unsubScribeButtonEnabled=!1,this.message=this.$translate.getTranslation("Unsubscribing..."),this.apiService.unsubscribeFromWaitlist(this.$stateParams.uid,this.$stateParams.waitlistItem).then(function(t){e.message=e.$translate.getTranslation("Unsubscribed!")}).catch(function(t){e.message=e.$translate.getTranslation("Unsubscribe failed! Please try again."),e.initUnsubscribeButton()})},e.prototype.close=function(){var t=this;this.cssService.close(),this.$timeout(function(){t.widgetService.home()},500)},e.prototype.initUnsubscribeButton=function(){this.unsubScribeButtonEnabled=!0},e.$inject=["$translate","widgetService","$stateParams","$state","apiService","sdkService","cssService","$timeout"],t.WaitlistSpotUnavailableController=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").controller("waitlistSpotUnavailableController",FT.Widget.Side.WaitlistSpotUnavailableController),function(m){var t,g;t=m.Widget||(m.Widget={}),function(t){var e=(i.prototype.select=function(t){this.selected=t.date,this.onDateSelect(this.selected),this.active=!1,this.hideTooltip()},i.prototype.openDay=function(t,e){t.message?this.showTooltip(t):0!=t.status&&6!=t.status||this.select(t)},i.prototype.isSelected=function(t){return moment(this.selected).isSame(t.date,"day")},i.prototype.isToday=function(t){return moment().isSame(t.date,"day")},i.prototype.load=function(){var e=this;this.widgetService.restaurantLoaded().then(function(t){e.loadMonth(e.selected.getMonth()+1,e.selected.getFullYear())})},i.prototype.prevMonth=function(){var t=moment([this.month.fullYear,this.month.monthNumber-1,1]);t.add(-1,"month"),this.loadMonth(t.month()+1,t.year()),this.hideTooltip()},i.prototype.nextMonth=function(){var t=moment([this.month.fullYear,this.month.monthNumber-1,1]);t.add(1,"month"),this.loadMonth(t.month()+1,t.year()),this.hideTooltip()},i.prototype.loadMonth=function(u,d){var l=this;this.loading=!0;var t=("search"==this.type?this.widgetService.searchParams:this.booking).numberOfPeople;this.apiService.getAvailabilityMonthWeeks(this.widgetService.restaurant,u,d,t,this.ticket,this.widgetService.friendCode,this.widgetService.voucher?this.widgetService.voucher.code:"").then(function(r){var t=m.Helpers.DateHelper.getWeekDaysForMonth(u,d).map(function(e){var t,i=r.data.filter(function(t){return t.day==e.getDate()&&t.month===e.getMonth()+1})[0];return i?t=i:((t=new g.BookingDate).day=e.getDate(),t.date=e,t.month=e.getMonth()+1,t.status=1,t.dayOfWeek=e.getDay()-1,t.week=moment(e).week()),t}),e=new h;e.shortName=moment(new Date(d,u-1)).format("MMM"),e.monthName=moment(new Date(d,u-1)).format("MMMM"),e.monthNumber=u,e.fullYear=d,e.color=l.getColorFromString((e.monthNumber+e.fullYear).toString());for(var i=new p,o=0;o<t.length;o++){var n=t[o],s=n.backgroundColor,a=t[o-1]?t[o-1].backgroundColor:null,c=t[o+1]?t[o+1].backgroundColor:null;s&&0<o&&a!=s&&(n.firstDayOfPeriod=!0),s&&t.length>o+1&&c!=s&&(n.lastDayOfPeriod=!0),n.otherMonth=n.month!==u,0===n.dayOfWeek&&0<i.days.length&&(e.weeks.push(i),i=new p),i.days.push(n)}e.weeks.push(i),l.month=e,l.prevDisabled=moment().month()+1===u&&moment().year()===d,l.monthHasWaitlist=l.month.weeks.reduce(function(t,e){return t.concat(e.days)},[]).some(function(t){return t.month===e.monthNumber&&6===t.status}),l.loading=!1})},i.prototype.getColorFromString=function(t){return null==t?"transparent":(new ColorHash).hex(t)},i.prototype.showTooltip=function(t){this.tooltip.title="en"===this.$translate.getCurrentCulture()?moment(t.date).format("MMMM D, YYYY"):moment(t.date).format("D MMMM YYYY"),this.tooltip.message=t.message,this.tooltip.selectable=0==t.status||6==t.status,this.tooltip.day=t,this.tooltip.active=!0},i.prototype.hideTooltip=function(){this.tooltip.active=!1},i.$inject=["$scope","$element","$timeout","$stateParams","$location","$animate","apiService","widgetService","$translate"],i);function i(t,e,i,r,o,n,s,a,c){var u=this;this.$scope=t,this.$element=e,this.$timeout=i,this.$stateParams=r,this.$location=o,this.$animate=n,this.apiService=s,this.widgetService=a,this.$translate=c,this.weekDays=[moment.weekdaysShort(1),moment.weekdaysShort(2),moment.weekdaysShort(3),moment.weekdaysShort(4),moment.weekdaysShort(5),moment.weekdaysShort(6),moment.weekdaysShort(0)],this.prevDisabled=!0,this.nextDisabled=!1,this.touchDaySelected=null,this.tooltip={active:!1,title:"",message:"",selectable:!1,day:null},this.loading=!1,this.booking=this.widgetService.booking,this.$scope.$watch(function(){return u.active},function(t){t||u.hideTooltip()})}t.CalendarDirectiveController=e,t.CalendarDirective=function(){this.restrict="E",this.templateUrl="/app/widgets/side/directives/calendar.html",this.scope={selected:"=",active:"=",ticket:"=",onDateSelect:"&onDateSelect",type:"@"},this.replace=!0,this.controllerAs="ctrl",this.controller=e,this.bindToController=!0,this.link=function(t,e,i,r){t.$watch(function(){return r.active},function(t,e){e!==t&&1==t&&r.load()},!1),t.$watch(function(){return r.booking.numberOfPeople+r.widgetService.searchParams.numberOfPeople},function(t,e){e!==t&&(r.month=null)},!1)}};var h=function(){this.weeks=[]};t.Month=h;var p=function(){this.days=[]};t.Week=p}((g=t.Side||(t.Side={})).Directives||(g.Directives={}))}(FT=FT||{}),angular.module("widgetSide").controller("calendarDirectiveController",FT.Widget.Side.Directives.CalendarDirectiveController).directive("calendar",[function(){return new FT.Widget.Side.Directives.CalendarDirective}]),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).ConvertToDateDirective=function(){this.restrict="A",this.require="?ngModel",this.link=function(t,e,i,r){r.$parsers.push(function(t){return t?new Date(t):null}),r.$formatters.push(function(t){return t})}}}(FT=FT||{}),angular.module("widgetSide").directive("convertToDate",function(){return new FT.Widget.Side.ConvertToDateDirective}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).ConvertToNumberDirective=function(){this.restrict="A",this.require="?ngModel",this.link=function(t,e,i,r){r.$parsers.push(function(t){return parseInt(t,10)}),r.$formatters.push(function(t){return""+t})}}}(FT=FT||{}),angular.module("widgetSide").directive("convertToNumber",function(){return new FT.Widget.Side.ConvertToNumberDirective}),function(t){var u,e;function i(t,e,i,r,o,n){this.$scope=t,this.$element=e,this.$timeout=i,this.$routeParams=r,this.$location=o,this.$animate=n,this.today=new Date((new Date).setHours(0,0,0,0)),this.weekDays=[moment.weekdaysShort(1),moment.weekdaysShort(2),moment.weekdaysShort(3),moment.weekdaysShort(4),moment.weekdaysShort(5),moment.weekdaysShort(6),moment.weekdaysShort(0)],this.$animate.enabled(e,!1),this.weeks=[],this.selectedDate?this.loadMonth(this.selectedDate.getMonth(),this.selectedDate.getFullYear()):this.loadMonth((new Date).getMonth(),(new Date).getFullYear()),this.$scope.$on("$destroy",function(){$(document).off("click.datePicker")})}t=t.Widget||(t.Widget={}),t=(u=t.Side||(t.Side={})).Directives||(u.Directives={}),i.prototype.openCalendar=function(){var e=this;this.open=!0,$(document).off("click.datePicker"),$(document).on("click.datePicker",function(t){$(t.target).closest(".dp-calendar, .dp-select").length||(e.closeCalendar(),e.$scope.$apply())})},i.prototype.closeCalendar=function(){this.open=!1,$(document).off("click.datePicker")},i.prototype.getMonthDays=function(t){return new Date(2018,t,0).getDate()},i.prototype.select=function(t){this.max&&t.date>this.max||this.min&&t.date<=this.min||(this.selectedDate=new Date(t.date.setHours(0,0,0,0)),this.open=!1)},i.prototype.isSelected=function(t){return moment(this.selectedDate).isSame(t.date,"day")},i.prototype.isToday=function(t){return moment().isSame(t.date,"day")},i.prototype.isSameMonth=function(){return moment().isSame(this.month,"month")},i.prototype.loadMonth=function(t,e){e=this.getDaysInMonth(t,e);this.month=moment(e[0]).clone().startOf("month"),this.weeks=[],this.buildCalendar(e)},i.prototype.getDaysInMonth=function(t,e){for(var i=new Date(e,t,1),r=[];i.getMonth()===t;)r.push(i),i=new Date(e,t,i.getDate()+1);return r},i.prototype.canMoveNext=function(){return!this.max||moment(this.max).isAfter(this.month,"month")},i.prototype.canMovePrevious=function(){return!this.min||moment(this.min).isBefore(this.month,"month")},i.prototype.next=function(){var t=this.month.month()+1,e=this.month.year();12===t&&(t=0,e+=1),this.loadMonth(t,e)},i.prototype.removeDate=function(){this.selectedDate=null},i.prototype.toggleCalendar=function(){this.open?this.closeCalendar():this.openCalendar(),this.open&&!this.month&&this.loadMonth(this.selectedDate.getMonth(),this.selectedDate.getFullYear())},i.prototype.previous=function(){var t=this.month.month()-1,e=this.month.year();-1===t&&(t=11,e-=1),this.loadMonth(t,e)},i.prototype.buildCalendar=function(t){for(var i=this,r=moment(t[0]).isoWeek(),e=moment(t[0]).isoWeekday()-1,o=t[0].getMonth(),n=[],s=0;s<e;s++)(a=new u.BookingDate).status=-1,a.month=o-1,a.day=this.getMonthDays(o-1)-s,a.date=new Date(this.month.year(),this.month.month(),this.month.day()),n.unshift(a);if(t.forEach(function(t){var e=new u.BookingDate;e.status=i.max&&t>i.max||i.min&&t<=i.min?2:1,e.month=t.getMonth(),e.day=t.getDate(),e.date=t;t=moment(t).isoWeek();t!==r&&(i.weeks.push(n),r=t,n=[]),n.push(e)}),n.length){for(var a,c=7-n.length,s=1;s<=c;s++)(a=new u.BookingDate).status=-1,a.month=o+1,a.day=s,a.date=new Date(this.month.year(),this.month.month(),this.month.day()),n.push(a);this.weeks.push(n)}},i.$inject=["$scope","$element","$timeout","$routeParams","$location","$animate"],e=i,t.DatePickerDirectiveController=e,t.DatePickerDirective=function(){this.restrict="E",this.templateUrl="/app/widgets/side/directives/datePicker.html",this.scope={selectedDate:"=",dateFormat:"@",min:"=",max:"="},this.controllerAs="ctrl",this.controller=e,this.bindToController=!0}}(FT=FT||{}),angular.module("widgetSide").controller("datePickerDirectiveController",FT.Widget.Side.Directives.DatePickerDirectiveController).directive("datePicker",[function(){return new FT.Widget.Side.Directives.DatePickerDirective}]),function(t){((t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).Directives||(t.Directives={})).GlobalClickDirective=function(t){this.$timeout=t,this.restrict="A",this.link=function(o,t,n,e){t.on("click",function(e){var i=n.exclude,r=n.globalClick;$(document).off("click.global"),$(document).on("click.global",function(t){if(!$(t.target).is(i))return o.$event=e,o.$apply(r),t.preventDefault(),t.stopImmediatePropagation(),!1})}),o.$on("$destroy",function(){$(document).off("click.global")})}}}(FT=FT||{}),angular.module("widgetSide").directive("globalClick",["$timeout",function(t){return new FT.Widget.Side.Directives.GlobalClickDirective(t)}]),function(a){var t;((t=(t=a.Widget||(a.Widget={})).Side||(t.Side={})).Directives||(t.Directives={})).IntTelDirective=function(t,e,i){var s=this;this.$log=t,this.$window=e,this.$parse=i,this.require="ngModel",this.link=function(t,e,i,r){var o,n;i.type&&"text"!==i.type&&"tel"!==i.type||"INPUT"!==e[0].tagName?s.$log.warn("ng-intl-tel-input can only be applied to a *text* or *tel* input"):(window.intlTelInputUtils||s.$log.warn("intlTelInputUtils is not defined. Formatting and validation will not work."),o=a.Helpers.StorageHelper.storageAvailable("localStorage"),n=i&&i.telDefaultCountry?i.telDefaultCountry.toLocaleLowerCase():"nl",s.intlTelInp=window.intlTelInput(e[0],{initialCountry:n,preferredCountries:["nl","be","de","es","dk","fr","no","se","gb"],geoIpLookup:function(t){o&&localStorage.getItem("int-tel-country")||$.get("https://ipinfo.io",function(){},"jsonp").always(function(t){t=t&&t.country?t.country:n;s.intlTelInp.setCountry(t),o&&localStorage.setItem("int-tel-country",t)})}}),(i=o&&localStorage.getItem("int-tel-country"))&&s.intlTelInp.setCountry(i),angular.element(s.$window).on("countrychange",function(){var t=s.intlTelInp.getNumber();r.$setViewValue(t)}),r.$validators.ngIntlTelInput=function(t){t=t||0<e[0].value.length;return!t||(!("se"!==s.intlTelInp.getSelectedCountryData().iso2||!t.startsWith("+4675")&&!t.startsWith("+4677"))||s.intlTelInp.isValidNumber())},r.$parsers.push(function(t){return o&&s.intlTelInp.selectedCountryData&&s.intlTelInp.selectedCountryData.iso2&&localStorage.setItem("int-tel-country",s.intlTelInp.selectedCountryData.iso2),s.intlTelInp.getNumber()}),r.$formatters.push(function(t){return t&&(o&&s.intlTelInp.selectedCountryData&&s.intlTelInp.selectedCountryData.iso2&&localStorage.setItem("int-tel-country",s.intlTelInp.selectedCountryData.iso2),s.intlTelInp.setNumber(t),"+"!==t.charAt(0)&&r.$setViewValue(t)),t}))}}}(FT=FT||{}),angular.module("widgetSide").directive("intTel",["$log","$window","$parse",function(t,e,i,r){return new FT.Widget.Side.Directives.IntTelDirective(e,i,r)}]),function(t){var e;function i(t,e,i,r,o,n,s){this.$scope=t,this.$element=e,this.$timeout=i,this.$routeParams=r,this.$location=o,this.$animate=n,this.$translate=s}t=(t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).Directives||(t.Directives={}),i.prototype.init=function(t){this.content&&(0===this.content.length&&t.css("height","0px"),this.content=this.content,this.hasLimit=this.content.length>this.limit,this.open=!1,this.currentLimit=this.limit,this.readMoreText=this.$translate.getTranslation("read more"))},i.prototype.getContent=function(){return this.content?this.content.replace("&nbsp;",""):null},i.prototype.readMore=function(){this.open?(this.currentLimit=this.limit,this.open=!1,this.readMoreText=this.$translate.getTranslation("read more")):(this.currentLimit=1e8,this.open=!0,this.readMoreText=this.$translate.getTranslation("read less"))},i.$inject=["$scope","$element","$timeout","$routeParams","$location","$animate","$translate"],e=i,t.ReadMoreDirectiveController=e,t.ReadMoreDirective=function(){this.restrict="EA",this.template='<span ng-click="ctrl.readMore()" ng-class="{limited : ctrl.hasLimit}" ng-bind-html="ctrl.getContent() | limitTo: ctrl.currentLimit"></span><span ng-if="ctrl.hasLimit && !ctrl.open">...</span>',this.scope={limit:"<",content:"<"},this.controllerAs="ctrl",this.controller=e,this.bindToController=!0,this.link=function(t,e,i,r){r.init(e)}}}(FT=FT||{}),angular.module("widgetSide").controller("readMoreDirectiveController",FT.Widget.Side.Directives.ReadMoreDirectiveController).directive("readMore",[function(){return new FT.Widget.Side.Directives.ReadMoreDirective}]),function(t){!function(t){function e(t){var o=this;this.$timeout=t,this.restrict="A",this.link=function(t,e,i,r){t.$watch(i.scrollHereOn,function(t){o.isElementInViewport(e[0])||e[0].scrollIntoView(!1)})}}t=t.Directives||(t.Directives={}),e.prototype.isElementInViewport=function(t){t=t.getBoundingClientRect();return 0<t.bottom&&0<t.right&&t.left<(window.innerWidth||document.documentElement.clientWidth)&&t.top<(window.innerHeight-200||document.documentElement.clientHeight-200)},t.ScrollHereOnDirective=e}(t.Shared||(t.Shared={}))}(FT=FT||{}),angular.module("widgetSide").directive("scrollHereOn",["$timeout",function(t){return new FT.Shared.Directives.ScrollHereOnDirective(t)}]),function(t){((t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).Directives||(t.Directives={})).StopEventDirective=function(t){this.$timeout=t,this.scope={stopEvent:"=?"},this.restrict="A",this.link=function(t,e,i,r){t.stopEvent?e.on("click."+t.stopEvent+" mousedown."+t.stopEvent+" mouseup."+t.stopEvent,function(t){t.stopImmediatePropagation()}):e.on("click mousedown mouseup",function(t){t.stopImmediatePropagation()})}}}(FT=FT||{}),angular.module("widgetSide").directive("stopEvent",["$timeout",function(t){return new FT.Widget.Side.Directives.StopEventDirective(t)}]),function(t){((t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).Directives||(t.Directives={})).StopParentScroll=function(t){var s=this;this.$timeout=t,this.restrict="A",this.link=function(t,n,e,i){n[0].addEventListener("wheel",function(t){var e=n[0],i=Math.round(e.scrollTop),r=Math.round(e.scrollHeight-e.offsetHeight),e=t.deltaY;(r<=i&&0<e||0===i&&e<0)&&t.preventDefault()}),n[0].addEventListener("touchstart",function(t){s.previousClientY=t.touches[0].clientY}),n[0].addEventListener("touchmove",function(t){var e=n[0],i=Math.round(e.scrollTop),r=Math.round(e.scrollHeight-e.offsetHeight),o=t.touches[0].clientY,e=s.previousClientY-o;(r<=i&&0<e||0===i&&e<0)&&t.preventDefault(),s.previousClientY=o})}}}(FT=FT||{}),angular.module("widgetSide").directive("stopParentScroll",["$timeout",function(t){return new FT.Widget.Side.Directives.StopParentScroll(t)}]),function(t){(function(t){function e(t){var s=this;this.$timeout=t,this.restrict="EA",this.require="?ngModel",this.scope={start:"@",end:"@",format:"<"},this.template='<option ng-repeat="time in timesArray track by $index" value="{{time.value}}">{{time.text}}</option>',this.replace=!1,this.link=function(i,r,o,n){i.$watch(function(){return i.start+i.end},function(t,e){s.renderOptions(i,r,o,n)})}}t=t.Directives||(t.Directives={}),e.prototype.renderOptions=function(t,e,i,r){for(var o=new Array,n=e,s=new Date(0,0,0,parseInt(t.start.split(":")[0]),parseInt(t.start.split(":")[1])),a=this.minutesFromTime(moment(s).format("HH:mm")),c=new Date(0,0,parseInt(t.end.split(":")[0])<7?1:0,parseInt(t.end.split(":")[0]),parseInt(t.end.split(":")[1]));s<=c;){var u=moment(s).format("HH:mm"),d={text:"",value:""};d.text=moment(s).format(12==t.format?"hh:mm A":"HH:mm"),d.value="minutes"==i.unit?a:u,o.push(d),s.setMinutes(s.getMinutes()+parseInt(i.interval)),a+=parseInt(i.interval)}t.timesArray=o,this.$timeout(function(){r&&(r.$render=function(){n.val(r.$viewValue),null==n.val()&&n.val(n.find("option").first().val())},n.on("change",function(){r.$setViewValue(this.value)})),r.$render()})},e.prototype.minutesFromTime=function(t){t=t.split(":");return 60*parseInt(t[0])+parseInt(t[1])},e.factory=function(){function t(t){return new e(t)}return t.$inject=["$timeout"],t},t.TimePickerDirective=e})((t=t.Widgets||(t.Widgets={})).Side||(t.Side={}))}(FT=FT||{}),angular.module("widgetSide").directive("timepicker",FT.Widgets.Side.Directives.TimePickerDirective.factory()),function(t){var e;function i(t,e,i,r,o,n,s){var a=this;this.$scope=t,this.$element=e,this.$timeout=i,this.$routeParams=r,this.$location=o,this.$animate=n,this.$translate=s,this.$scope.$watch(function(){return a.to},function(t,e){t!==e&&a.setupTimer()})}t=(t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).Directives||(t.Directives={}),i.prototype.setupTimer=function(){var t=this;this.to&&this.$timeout(function(){t.to instanceof Date||(t.to=new Date(t.to)),t.countDownDate=t.to.getTime(),document.getElementById("timer_"+t.uid).classList.remove("timer-expired"),t.calculateTime(),t.resetCalculateInterval(1e3),t.$scope.$on("$destroy",function(){clearInterval(t.interval)})})},i.prototype.resetCalculateInterval=function(t){var e=this;clearInterval(this.interval),this.interval=setInterval(function(){e.calculateTime()},t),this.intervalMs=t},i.prototype.calculateTime=function(){var t=(new Date).getTime(),e=this.countDownDate-t,i=Math.floor(e/864e5),r=Math.floor(e%864e5/36e5),o=Math.floor(e%36e5/6e4),t=Math.floor(e%6e4/1e3);0<i?(this.updateTimer(i+" "+this.$translate.getTranslation(1===i?"day":"days")),this.resetCalculateInterval(6e4)):0<r?this.updateTimer(this.pad(r,2)+":"+this.pad(o,2)+":"+this.pad(t,2)):(this.updateTimer(this.pad(o,2)+":"+this.pad(t,2)),1e3<this.intervalMs&&this.resetCalculateInterval(1e3)),e<0&&(clearInterval(this.interval),this.updateTimer("<strong>00:00</strong>"),document.getElementById("timer_"+this.uid).classList.add("timer-expired"))},i.prototype.pad=function(t,e){return("00"+t).substr(-e)},i.prototype.updateTimer=function(t){document.getElementById("timer_"+this.uid).innerHTML=t},i.$inject=["$scope","$element","$timeout","$routeParams","$location","$animate","$translate"],e=i,t.TimerDirectiveController=e,t.TimerDirective=function(){this.restrict="E",this.template='<span id="timer_{{ctrl.uid}}"></span>',this.scope={to:"<",uid:"@"},this.controllerAs="ctrl",this.controller=e,this.bindToController=!0,this.link=function(t,e,i,r){r.setupTimer()}}}(FT=FT||{}),angular.module("widgetSide").controller("timerDirectiveController",FT.Widget.Side.Directives.TimerDirectiveController).directive("timer",[function(){return new FT.Widget.Side.Directives.TimerDirective}]),function(t){(function(t){function e(){this.restrict="A"}t=t.Directives||(t.Directives={}),e.prototype.link=function(t,r,o){t.$on("$destroy",function(){$("body").off("click.tooltip")});var n=!1,s=$("#tooltip");window.tooltipTimeOut&&clearTimeout(window.tooltipTimeOut),r.off("click mouseenter"),r.on("click mouseenter",function(t){t.stopPropagation(),t.preventDefault();var e=o.title;if(!e||""==e)return a(),!1;clearTimeout(window.tooltipRemover);function i(){r.removeAttr("title"),s.html(e),n=!0,clearTimeout(window.tooltipRemover),s.addClass("open")}window.tooltipTimeOut=setTimeout(function(){i()},150),$(window).resize(i),s.off("click"),s.on("click",a),$("body").on("click.tooltip",function(){a()})}),r.off("mouseleave"),r.on("mouseleave",function(){clearTimeout(window.tooltipTimeOut),window.tooltipRemover=setTimeout(function(){a()},200)});var a=function(){n&&(s.removeClass("open"),r.attr("title",s.html()),n=!1)}},t.TooltipDirective=e})((t=t.Widget||(t.Widget={})).Side||(t.Side={}))}(FT=FT||{}),angular.module("widgetSide").directive("tooltip",function(){return new FT.Widget.Side.Directives.TooltipDirective}),function(t){((t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).Filters||(t.Filters={})).Capitalize=function(){return function(t){return t.charAt(0).toUpperCase()+t.slice(1)}}}(FT=FT||{}),angular.module("widgetSide").filter("capitalize",FT.Widget.Side.Filters.Capitalize),function(t){((t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).Filters||(t.Filters={})).CurrencyPrice=function(r){return function(t,e,i){void 0===i&&(i=!0);t=Math.abs(t),t=r("price",i)(t);return e?(t=function(t){switch(t){case"AED":return"AED {0}";case"AUD":case"CAD":case"MXN":case"NZD":case"SGD":case"USD":return"${0}";case"BGN":return"{0} лв.";case"BRL":return"R$ {0}";case"CHF":return"CHF {0}";case"CZK":return"{0} Kč";case"DKK":case"ISK":case"NOK":case"SEK":return"{0} kr";case"EUR":return"€{0}";case"GBP":return"£{0}";case"HKD":return"HK$ {0}";case"HRK":return"{0} kn";case"HUF":return"{0} ft";case"ILS":return"₪ {0}";case"JPY":return"¥ {0}";case"MYR":return"RM {0}";case"PHP":return"₱";case"PLN":return"{0} zł";case"RON":return"{0} lei";case"RUB":return"{0} ₽";case"THB":return"฿{0}";case"TWD":return"NT$ {0}";case"ZAR":return"R {0}";default:return"{0}"}}(e).replace("{0}",t),["AED","AUD","CAD","MXN","NZD","SGD","USD","GBP","HKD","ILS","JPY","MYR","PHP","THB","TWD"].some(function(t){return t==e})?t.replace(",","."):t):t}}}(FT=FT||{}),angular.module("widgetSide").filter("currencyPrice",["$filter",function(t){return FT.Widget.Side.Filters.CurrencyPrice(t)}]),function(t){((t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).Filters||(t.Filters={})).ExternalUrlsFilter=function(){return function(t){if(t){t=$("<div>"+t+"</div>");return $("a",t).each(function(){$(this).attr("target","_blank")}),t.html()}}}}(FT=FT||{}),angular.module("widgetSide").filter("externalUrls",function(){return FT.Widget.Side.Filters.ExternalUrlsFilter()}),function(t){((t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).Filters||(t.Filters={})).FriendlyDateFilter=function(n){return function(t,e,i,r){if(void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===r&&(r=!1),t){t instanceof Date||(t=new Date(t));t=moment(t);if(!i){var o=t.diff(moment().startOf("day"),"days");if(-1===o)return n.getTranslation("yesterday");if(0===o)return n.getTranslation("today");if(1===o)return n.getTranslation("tomorrow");if(o<7&&0<o)return t.format("dddd");if(-7<o&&o<0)return n.getTranslation("last {0}",t.format("dddd"))}i=void 0;i=t.year()===moment().year()?"de"===(o=n.getCurrentCulture())?"D. MMMM":"es"===o?"D [de] MMMM":"D MMMM":"LL";i=r?t.format("dddd")+" "+t.format(i):t.format(i);return e?n.getTranslation("on {0}",i):i}}}}(FT=FT||{}),angular.module("widgetSide").filter("friendlyDate",["$translate",function(t){return FT.Widget.Side.Filters.FriendlyDateFilter(t)}]),function(i){var t;((t=(t=i.Widget||(i.Widget={})).Side||(t.Side={})).Filters||(t.Filters={})).FriendlyTimeFilter=function(t){return function(t,e){if(t){t=(t=(t=t instanceof Date?24===e?moment(t).format("HH:mm"):moment(t).format("hh:mm A"):t)===parseInt(t,10)?i.Helpers.DateHelper.timeFromMinutes(t,e):t).split(":");return 24===e?moment().hour(t[0]).minute(t[1]).format("H:mm"):moment().hour(t[0]).minute(t[1]).format("h:mm A")}}}}(FT=FT||{}),angular.module("widgetSide").filter("friendlyTime",["$routeParams",function(t){return FT.Widget.Side.Filters.FriendlyTimeFilter(t)}]),function(i){var t;((t=(t=i.Widget||(i.Widget={})).Side||(t.Side={})).Filters||(t.Filters={})).ImageSize=function(t){return function(t,e){return i.Helpers.StringHelper.addFilenameSuffix(t,"_"+e)}}}(FT=FT||{}),angular.module("widgetSide").filter("imageSize",["$parse",function(t){return FT.Widget.Side.Filters.ImageSize(t)}]),function(t){((t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).Filters||(t.Filters={})).OpenDaysHeader=function(){return function(i){return 1==i.length?i[0].day:i.every(function(t,e){return e==i.length-1||i[e+1].dayOfWeek-t.dayOfWeek==1||i[e+1].dayOfWeek-t.dayOfWeek==-6})?i[0].day+" - "+i[i.length-1].day:i.map(function(t){return t.day}).join(" / ")}}}(FT=FT||{}),angular.module("widgetSide").filter("openDaysHeader",FT.Widget.Side.Filters.OpenDaysHeader),function(t){((t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).Filters||(t.Filters={})).PriceFilter=function(){return function(t,e){t=parseInt(t);return t%100!=0||e?(t/100).toFixed(2).replace(".",","):t/100}}}(FT=FT||{}),angular.module("widgetSide").filter("price",function(){return FT.Widget.Side.Filters.PriceFilter()}),function(t){((t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).Filters||(t.Filters={})).Range=function(){return function(t,e,i,r){for(var o=r||1,n=e;n<=parseInt(i);n+=o)t.push(n);return t}}}(FT=FT||{}),angular.module("widgetSide").filter("range",FT.Widget.Side.Filters.Range),function(i){var t;((t=(t=i.Widget||(i.Widget={})).Side||(t.Side={})).Filters||(t.Filters={})).TimeFromMinutesFilter=function(t){return function(t,e){if(t){t=i.Helpers.DateHelper.dateFromMinutes(new Date,t);return 24===e?moment(t).format("H:mm"):moment(t).format("h:mm A")}}}}(FT=FT||{}),angular.module("widgetSide").filter("timeFromMinutes",["$routeParams",function(t){return FT.Widget.Side.Filters.TimeFromMinutesFilter(t)}]),function(t){((t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).Filters||(t.Filters={})).TrustHtml=function(e){return function(t){return e.trustAsHtml(t)}}}(FT=FT||{}),angular.module("widgetSide").filter("trustHtml",["$sce",function(t){return FT.Widget.Side.Filters.TrustHtml(t)}]),function(t){function r(){}t=t.Helpers||(t.Helpers={}),r.getDateArray=function(t,e){function i(t){var e=new Date(this.valueOf());return e.setDate(e.getDate()+t),e}for(var r=[],o=t;o<=e;)r.push(o),o=i.call(o,1);return r},r.isToday=function(t,e){return moment(this.getRestaurantNow(t)).format("YYYY-MM-DD")==moment(e).format("YYYY-MM-DD")},r.parseDate=function(t){return new Date(t.replace(/-/g,"/"))},r.getWeekDaysForMonth=function(t,e){for(var e=moment(new Date(e,t-1,1)),t=moment(e).endOf("month"),e=moment(e).startOf("isoWeek"),i=moment(t).endOf("isoWeek"),r=[],o=e;o<=i;)r.push(o.toDate()),o=o.clone().add(1,"d");return r},r.getRestaurantNow=function(t){var e=new Date,t=e.getTimezoneOffset()+t.timezoneOffset;return moment(e).add(t,"minutes").toDate()},r.isDST=function(t){var e=new Date(r.lastDayOfMonth(t.getFullYear(),3,"sun").setHours(3)),i=new Date(r.lastDayOfMonth(t.getFullYear(),10,"sun").setHours(3));return e<=t&&t<i},r.lastDayOfMonth=function(t,e,i){for(var r={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},o=new Date(t+"/"+e+"/1"),n=e,s=!1;n===e;)s=o.getDay()===r[i]||s,o.setDate(o.getDate()+(s?7:1)),n=o.getMonth()+1;return o.setDate(o.getDate()-7),o},r.timeSpanString=function(t,e){if(t){var i,r=/([0-9]+?)([A-Za-z])([0-9]{1,4})?/g.exec(t),o=parseInt(r[1]),t=r[2],r=r[3]?parseInt(r[3]):null;switch(t){case"s":i="second";break;case"m":i="minute";break;case"h":i="hour";break;case"d":i="day";break;case"w":i="week";break;case"M":i="month";break;case"y":i="year"}return o+" "+i+(1==o?"":"s")+(r?" at "+this.timeFromMinutes(r,e):"")}return""},r.shortTimeSpanString=function(t,e){if(t){var i=/(\d{1,2})([A-Za-z]{1})(\d{2,4})?/g.exec(t),r=parseInt(i[1]),t=i[2],i=i[3]?parseInt(i[3]):null;return r+t+(i?" ("+this.timeFromMinutes(i,e)+")":"")}return""},r.timeSpanToMinutes=function(t){if(t){var e=/(\d{1,2})([A-Za-z]{1})(\d{2,4})?/g.exec(t),i=parseInt(e[1]),t=e[2];e[3]&&parseInt(e[3]);return moment.duration(i,t).asMinutes()}return 0},r.minutesFromMidnight=function(t){t=new Date(t);var e=new Date(t);return e.setHours(0,0,0,0),(t-e)/6e4},r.dateFromMinutes=function(t,e){return(t=new Date(t)).setHours(Math.floor(e/60),e%60,0),t},r.minutesFromTime=function(t){t=t.split(":");return 60*parseInt(t[0])+parseInt(t[1])},r.secondsFromDate=function(t){return 3600*t.getHours()+60*t.getMinutes()+t.getSeconds()},r.minutesFromDate=function(t){return 60*t.getHours()+t.getMinutes()},r.timeFromMinutes=function(t,e){void 0===e&&(e=24);var i=new Date;return i.setHours(Math.floor(t/60),t%60,0),24===e?moment(i).format("HH:mm"):moment(i).format("hh:mm A")},t.DateHelper=r}(FT=FT||{}),function(t){function e(){}t=t.Helpers||(t.Helpers={}),e.short=function(){var t=46656*Math.random()|0,e=46656*Math.random()|0;return("000"+t.toString(36)).slice(-3)+("000"+e.toString(36)).slice(-3)},t.GuidHelper=e}(FT=FT||{}),function(t){function e(){}t=t.Helpers||(t.Helpers={}),e.MD5=function(t){return CryptoJS.MD5(t).toString(CryptoJS.enc.Hex)},t.HashHelper=e}(FT=FT||{}),function(t){var n,s;function e(){}t=t.Helpers||(t.Helpers={}),n="AMOUNT",s="PERCENTAGE",e.promotionCodeAppliesToProduct=function(t,e){return!!t&&(!t.applicableProductUids||(0===t.applicableProductUids.length||-1<t.applicableProductUids.indexOf(e)))},e.promotionCodeAppliesToAnyProduct=function(t,e){return!!t&&(!t.applicableProductUids||(0===t.applicableProductUids.length||t.applicableProductUids.some(function(t){return-1<e.indexOf(t)})))},e.amountOfSpecificApplicableProducts=function(t){return t&&t.applicableProductUids?t.applicableProductUids.length:0},e.applyPromotionCodeToTotalAmount=function(t,e,i,r,o){if(!e)return t+r*o;if(!this.promotionCodeAppliesToProduct(e,i))return t+r*o;if("NONE"===e.discountType)return t+r*o;if(e.discountType===n&&!e.amount)return t+r*o;if(e.discountType===s&&!e.percentage)return t+r*o;if(e.discountType===n)return t+r*(o-e.amount);if(e.discountType!==s)return t+r*o;e=e.percentage/100;return t+Math.round(r*(o*(1-e)))},e.applyPerOrderPromotionCodeToTotalAmount=function(t,e){if(!e)return t;if("NONE"===e.discountType)return t;if(e.discountType===n&&!e.amount)return t;if(e.discountType===s&&!e.percentage)return t;if(e.discountType===n)return t-e.amount;if(e.discountType!==s)return t;e=e.percentage/100;return Math.round(t*(1-e))},t.PromotionCodeHelper=e}(FT=FT||{}),function(t){function e(){}t=t.Helpers||(t.Helpers={}),e.storageAvailable=function(t){try{var e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),!0}catch(t){return!1}},t.StorageHelper=e}(FT=FT||{}),function(t){function e(){}t=t.Helpers||(t.Helpers={}),e.addFilenameSuffix=function(t,e){if(!t)return"";if(!e)return t;var i=t,r="",o="",n="",t=i.indexOf("?"),i=(o=-1!==t?(n=i.substring(t),i.substring(0,t)):i).lastIndexOf("/");-1!==i&&(r=o.substring(0,i),o=o.substring(i));i=o.lastIndexOf(".");return-1!==i?o=o.substring(0,i)+e+o.substring(i):o+=e,r+o+n},e.truncate=function(t,e){return t.substr(0,e)+(t.length>e?"...":"")},t.StringHelper=e}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).Booking=function(){this.title="",this.source="Widget",this.culture="en",this.sendFeedbackMail=!0,this.newsletter=!0,this.comments="",this.color="#3edca8",this.walkIn=!1,this.companyName="",this.company=!1,this.bookingDuration=0,this.short=!1,this.tags=new Array}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).BookingDate=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).BookingTime=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).CreateBookingModel=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).CreateBookingResultModel=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).CreateOrderResultModel=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).CreateProductOrderModel=function(){this.quantity=1}}(FT=FT||{}),function(t){(t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).CreateTakeAwayOrderModel=function(){this.items=[]},t.OrderItem=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).CreateWaitlistItemResultModel=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).FinishBookingModel=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).Guest=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).Issuer=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).MultiVenueGroup=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).MultiVenueGroupRestaurant=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).Option=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).OptionAcceptModel=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).OptionAcceptResultModel=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).Order=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).OrderInfo=function(){this.title="",this.source="Widget",this.culture="en",this.comments="",this.companyName="",this.company=!1,this.address="",this.zipcode="",this.city="",this.newsletter=!0}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).OrderProduct=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).OrderTicket=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).PaymentMethod=function(){}}(FT=FT||{}),function(t){(t=(t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).PaymentProvider||(t.PaymentProvider={})).MOLLIE="Mollie",t.STRIPE="Stripe"}(FT=FT||{}),function(t){(t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).PaymentRedirectData=function(){},t.ListenerResult=function(){}}(FT=FT||{}),function(t){(t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).Product=function(){this.quantity=0},t.ProductOption=function(){this.chosenValueQuantity=1,this.title={},this.title.nl="",this.title.en="",this.title.ca="",this.title.de="",this.title.es="",this.title.fr="",this.title.da="",this.title.nb="",this.title.sv="",this.description={},this.description.nl="",this.description.en="",this.description.ca="",this.description.de="",this.description.es="",this.description.fr="",this.description.da="",this.description.nb="",this.description.sv="",this.productOptionValues=[]},t.ProductOptionValue=function(){this.title={},this.title.nl="",this.title.en="",this.title.ca="",this.title.de="",this.title.es="",this.title.fr="",this.title.da="",this.title.nb="",this.title.sv="",this.price=0}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).PromotionCode=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).Restaurant=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).Search=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).SearchProduct=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).TakeAway=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).TakeAwayDate=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).TakeAwayInfo=function(t,e,i,r){this.takeAwayMethod=t,this.comments=e,this.preferredTime=i,this.date=r}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).TakeAwayOrder=function(){}}(FT=FT||{}),function(t){(t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).TakeAwayProduct=function(){this.quantity=1,this.quantity=0,this.validationErrors=[]},t.ProductAvailability=function(){}}(FT=FT||{}),function(t){(t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).TakeAwaySettings=function(){},t.TakeAwayDay=function(){}}(FT=FT||{}),function(t){(t=(t=t.Widget||(t.Widget={})).Side||(t.Side={})).TakeAwayTimes=function(){},t.TakeAwayTime=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).TranslationSet=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).Voucher=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).VoucherInfo=function(){this.message="",this.sendAt=null}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).VoucherSettings=function(){}}(FT=FT||{}),function(t){((t=t.Widget||(t.Widget={})).Side||(t.Side={})).WaitlistItem=function(){this.title="",this.source="Widget",this.culture="en",this.newsletter=!1,this.comments="",this.companyName="",this.company=!1,this.duration=0}}(FT=FT||{});var __spreadArray=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var r,o=0,n=e.length;o<n;o++)!r&&o in e||((r=r||Array.prototype.slice.call(e,0,o))[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))};!function(t){!function(t){var e=(i.prototype.setLogging=function(t){this.logging=t},i.prototype.setConnectionUrl=function(t){this.connectionUrl=t},i.service=null,i);function i(){var e=this;this.$get=["$rootScope",function(t){return null!=i.service||(i.service=new r(t),i.service.logging=e.logging,i.service.connectionUrl=e.connectionUrl,i.service.init()),i.service}],this.logging=!1}t.SignalRServiceProvider=e;var r=(o.prototype.init=function(){this.connectionUrl=this.connectionUrl||"/widget-hub",this.connect(),this.keepAlive()},o.prototype.invoke=function(t){for(var e,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];return this.hubStarted?(e=this.hubConnection).invoke.apply(e,__spreadArray([t],i,!1)):new Promise(function(t){t()})},o.prototype.addListener=function(i,t,e){var r=this,o={senderId:t,method:e},e=this.getEventRegistration(i);null==e?this.events.push(e={event:i,connected:!1,listeners:[o]}):(this.removeListenerWithSender(e,t),e.listeners.push(o)),this.logToConsole("Listener for "+i+" (sender: "+t+") registered."),this.hubStarted&&(e.connected||(this.logToConsole("Event "+i+" added to hub."),this.hubConnection.on(i,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];r.invokeListenersForEvent.apply(r,__spreadArray([i],t,!1))}),e.connected=!0))},o.prototype.removeListener=function(e,t){var i=this.getEventRegistration(e);null!=i&&(this.removeListenerWithSender(i,t),0<i.listeners.length||(this.logToConsole("Event "+e+" removed from hub"),this.hubConnection.off(e),this.events=this.events.filter(function(t){return t.event!==e})),this.logToConsole("Listener for "+e+" and "+t+" removed."))},o.prototype.subscribe=function(e,t){this.subscriptions.filter(function(t){return t.groupName===e}).length?this.logToConsole("Subscription already exists"):(this.subscriptions.push(t={groupName:e,onReconnect:t,connected:!1}),this.logToConsole("Subscription for "+e+" registered."),this.hubStarted&&(this.invoke("subscribe",e),t.connected=!0,this.logToConsole("Subscription for "+e+" added to hub.")))},o.prototype.unSubscribe=function(e){this.hubStarted&&(this.invoke("unSubscribe",e),this.logToConsole("Unsubscribed for "+e)),this.subscriptions=this.subscriptions.filter(function(t){return t.groupName!==e})},o.prototype.connect=function(){var e=this;return this.hubConnection=(new signalR.HubConnectionBuilder).withUrl(this.connectionUrl).configureLogging(this.logging?signalR.LogLevel.Information:signalR.LogLevel.Error).build(),this.hubConnection.onclose(function(t){null!=t?e.logToConsole("Close event raised: "+t.name+" - "+t.message,new Date):e.logToConsole("Close event raised.",new Date),e.onConnectionClosed()}),this.hubConnection.start().then(function(){return e.hubStarted=!0,e.connectRegisteredEvents(),e.connectRegisteredSubscriptions().then(function(){e.logToConsole("SignalR connected and registered.")})},function(t){e.logToConsole("Error connecting: "+t),e.onConnectionClosed()})},o.prototype.onConnectionClosed=function(){this.hubConnection=null,this.hubStarted=!1,this.events.forEach(function(t){t.connected=!1}),this.subscriptions.forEach(function(t){t.connected=!1}),this.startHeartBeat()},o.prototype.keepAlive=function(){var t=this;document.addEventListener("visibilitychange",function(){document.hidden?(t.logToConsole("document hidden"),t.startHeartBeat()):t.logToConsole("document visible")},!1)},o.prototype.reConnect=function(){this.hubConnection||(this.logToConsole("Reconnecting signalR"),this.stopHeartBeat(),this.connect())},o.prototype.startHeartBeat=function(){var t=this;this.heartbeat||(this.stopHeartBeat(),this.logToConsole("starting heartbeat"),this.heartbeat=window.setInterval(function(){t.reConnect()},6e4))},o.prototype.stopHeartBeat=function(){this.heartbeat&&(this.logToConsole("stopping heartbeat"),window.clearInterval(this.heartbeat),this.heartbeat=null)},o.prototype.invokeListenersForEvent=function(e){for(var i=this,r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];var o=this.getEventRegistration(e);null!=o&&o.listeners.forEach(function(t){t.method.apply(t,r),i.$rootScope.$apply(),i.logToConsole("Listener "+e+" for "+t.senderId+" INVOKED")})},o.prototype.connectRegisteredSubscriptions=function(){var e=this,t=this.subscriptions.filter(function(t){return!1===t.connected}).map(function(t){return e.invoke("subscribe",t.groupName).then(function(){e.logToConsole("Subscription for "+t.groupName+" added to hub."),t.connected=!0,t.onReconnect&&(t.onReconnect(),e.$rootScope.$apply())})});return 0===t.length?new Promise(function(t){t()}):Promise.all(t).then(function(){})},o.prototype.connectRegisteredEvents=function(){var r=this;this.events.forEach(function(i){i.connected||(r.hubConnection.on(i.event,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];r.invokeListenersForEvent.apply(r,__spreadArray([i.event],t,!1))}),r.logToConsole("Event "+i.event+" added to hub."),i.connected=!0)})},o.prototype.getSubscription=function(e){var t=this.subscriptions.filter(function(t){return t.groupName===e});return 1===t.length?t[0]:null},o.prototype.getEventRegistration=function(e){var t=this.events.filter(function(t){return t.event===e});return 1===t.length?t[0]:null},o.prototype.removeListenerWithSender=function(t,e){for(var i=t.listeners.length-1;0<=i;--i)t.listeners[i]&&t.listeners[i].senderId===e&&t.listeners.splice(i,1)},o.prototype.logToConsole=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.logging&&(e.length?console.log(t,e):console.log(t))},o);function o(t){this.$rootScope=t,this.events=[],this.subscriptions=[]}t.SignalRService=r}(t.Signal||(t.Signal={}))}(FT=FT||{}),angular.module("ft.signal",[]).provider("signalRService",FT.Signal.SignalRServiceProvider);__spreadArray=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var r,o=0,n=e.length;o<n;o++)!r&&o in e||((r=r||Array.prototype.slice.call(e,0,o))[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))};!function(c){var t;(function(t){var e=(i.prototype.setup=function(t,e,i){this.widgetApiUrl=t,this.translationUrl=e,this.context=i},i);function i(){var r=this;this.$get=["$log","$stateParams","$q",function(t,e,i){return new o(r,t,e,i)}]}t.TranslateProvider=e;var o=(r.prototype.getApiPromise=function(e,i){var r=this,o=this.$q.defer();return this.$http.get(this.translateProvider.translationUrl+"/restaurant/"+e+"/"+i+"/"+this.translateProvider.context).then(function(t){t=t.data;r.translationSet.culture=t.culture,r.translationSet.informal=t.informal,r.translationSet.values=t.values,o.resolve(!0)}).catch(function(t){console.warn("Translation load through CDN failed! Trying direct call..."),console.error(t),r.$http.get(r.translateProvider.widgetApiUrl+"/api/translation/restaurant/"+e+"/"+i+"/"+r.translateProvider.context).then(function(t){t=t.data;r.translationSet.culture=t.culture,r.translationSet.informal=t.informal,r.translationSet.values=t.values,o.resolve(!0)}).catch(function(t){console.error("Translation load through direct call failed!"),console.error(t),o.resolve(!1)})}),o.promise},r.prototype.getCurrentCulture=function(){return this.$stateParams.culture||"en"},r.prototype.getTranslation=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!t||""===t)return"";(n=this.translationSet.values[t])||(this.$log.info("TRANSLATION MISSING\n                     Key: ["+t+"]\n Translation set culture: ["+this.translationSet.culture+"]\n           State culture: ["+this.$stateParams.culture+"]\n     getCurrentCulture(): ["+this.getCurrentCulture()+"]\n                 Context: ["+this.translateProvider.context+"]\n                Informal: ["+(this.translationSet.informal?"Yes":"No")+"]"),n=t);for(var r=0;r<e.length;r++)var o=new RegExp("\\{"+r+"\\}","gm"),n=n.replace(o,e[r]);return n},r.prototype.getPeopleDisplay=function(t){return t+" "+(1===t?this.getTranslation("person"):this.getTranslation("people"))},r.prototype.getItemsDisplay=function(t){return t+" "+(1===t?this.getTranslation("item"):this.getTranslation("items"))},r.$inject=["translateProvider","$log","$stateParams","$q"],r);function r(t,e,i,r){this.translateProvider=t,this.$log=e,this.$stateParams=i,this.$q=r,this.translationSet=new c.Widget.Side.TranslationSet;r=angular.injector(["ng"]);this.$http=r.get("$http")}function n(r,o){return function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(t)return o.trustAsHtml(r.getTranslation.apply(r,__spreadArray([t],e,!1)))}}function s(e){return function(t){if(t)return e.getPeopleDisplay(t)}}function a(e){return function(t){if(t)return e.getItemsDisplay(t)}}t.TranslateService=o,(t.TranslateFilter=n).$inject=["$translate","$sce"],(t.TranslatePeopleFilter=s).$inject=["$translate"],(t.TranslateItemsFilter=a).$inject=["$translate"]})((t=(t=(t=c.Widget||(c.Widget={})).Side||(t.Side={})).Modules||(t.Modules={})).Translate||(t.Translate={}))}(FT=FT||{}),angular.module("ft.translate",[]).provider("$translate",FT.Widget.Side.Modules.Translate.TranslateProvider).filter("translate",FT.Widget.Side.Modules.Translate.TranslateFilter).filter("translatePeople",FT.Widget.Side.Modules.Translate.TranslatePeopleFilter).filter("translateItems",FT.Widget.Side.Modules.Translate.TranslateItemsFilter),function(t){(function(t){(e=t.XhrType||(t.XhrType={}))[e.Request=0]="Request",e[e.Response=1]="Response";var e=(i.$inject=["$q","$rootScope","$timeout","$log","$location","$injector"],i);function i(e,t,i,r,o,n){var s=n.get("$state");return{request:function(t){for(var e,i,r=t.url.split("/"),o=0;o<r.length;o++)!/^\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d(.*)/.test(r[o])||0!=(i=(e=new Date(r[o])).getTimezoneOffset()+(c(e)?120:60))&&(r[o]=moment(e).subtract(i,"minutes").toISOString());return t.url=r.join("/"),t},requestError:function(t){return r.error("Request error:",t),e.reject(t)},response:function(t){return t},responseError:function(t){return 0==t.status&&r.error("Connection error: "+t.status+" -> ","No connection to formitable available"),0<t.status&&422!==t.status&&(r.error("Response error: "+t.status+" -> ",t.statusText+" -> "+t.data.message),s.go("error",{culture:n.get("$stateParams").culture,uid:n.get("$stateParams").uid,errorMessage:t.data.message,errorCode:t.status})),e.reject(t)}}}function a(t){try{var e=JSON.parse(t);if(e&&"object"==typeof e)return e}catch(t){}return!1}function c(t){var e=new Date(r(t.getFullYear(),3,"sun").setHours(3)),i=new Date(r(t.getFullYear(),10,"sun").setHours(3));return e<=t&&t<i}function r(t,e,i){for(var r={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},o=new Date(t+"/"+e+"/1"),n=e,s=!1;n===e;)s=o.getDay()===r[i]||s,o.setDate(o.getDate()+(s?7:1)),n=o.getMonth()+1;return o.setDate(o.getDate()-7),o}t.LoadingInterceptor=e,t.convertDateStringsToLocalDates=function t(e){var i,r,o,n,s;if("string"!=typeof e||(i=a(e))&&(e=i),"object"!=typeof e)return e;for(r in e)e.hasOwnProperty(r)&&("string"==typeof(o=e[r])&&/^\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d(.*)/.test(o)?(s=(n=new Date(o)).getTimezoneOffset()+(c(n)?120:60),e[r]=moment(n).add(s,"minutes").toDate()):"object"==typeof o&&t(o));return e},t.convertDateStringsToUtcString=function t(e){var i,r,o,n,s;if("string"!=typeof e||(i=a(e))&&(e=i),"object"!=typeof e)return e;for(r in e)e.hasOwnProperty(r)&&("string"==typeof(o=e[r])&&/^\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d(.*)/.test(o)?0!=(s=(n=new Date(o)).getTimezoneOffset()+(c(n)?120:60))&&(e[r]=moment(n).subtract(s,"minutes").toISOString()):"object"==typeof o&&t(o));return JSON.stringify(e)},t.tryParseJSON=a,t.isDST=c,t.lastDayOfMonth=r})((t=t.Widget||(t.Widget={})).Side||(t.Side={}))}(FT=FT||{}),angular.module("widgetSide").service("loadingInterceptor",FT.Widget.Side.LoadingInterceptor).factory("headerInterceptor",["settings",function(e){return{request:function(t){return e.returnUrl&&(t.headers["ft-returnurl"]=e.returnUrl),t}}}]).config(["$httpProvider",function(t){t.defaults.headers.get||(t.defaults.headers.get={}),t.defaults.transformResponse.push(function(t){return t=FT.Widget.Side.convertDateStringsToLocalDates(t)}),t.defaults.transformRequest.push(function(t){return t=FT.Widget.Side.convertDateStringsToUtcString(t)}),t.defaults.headers.get["If-Modified-Since"]="Mon, 26 Jul 1997 05:00:00 GMT",t.defaults.headers.get["Cache-Control"]="no-cache",t.defaults.headers.get.Pragma="no-cache",t.interceptors.push("loadingInterceptor"),t.interceptors.push("headerInterceptor")}]),function(t){!function(t){function e(t,e,i,r,o,n,s,a,c){this.$http=t,this.$localStorage=e,this.$state=i,this.$stateParams=r,this.$rootScope=o,this.$interval=n,this.widgetApiUrl=s,this.$location=a,this.$translate=c,this.widgetUrlBase=this.widgetApiUrl+"/api"}t=t.Side||(t.Side={}),e.prototype.getMultiVenueGroup=function(t){return this.$http.get(this.widgetUrlBase+"/restaurant/multivenuegroup/"+t)},e.prototype.getRestaurant=function(t,e){return this.$http.get(this.widgetUrlBase+"/restaurant/"+t+"/"+e)},e.prototype.getGuestStatus=function(t,e){return this.$http.post(this.widgetUrlBase+"/g/"+t,{e:e}).then(function(t){return t.data.irg})},e.prototype.sendBookingIntent=function(t,e,i,r,o){e={e:e};return i&&(e.bd=i),r&&(e.p=r),o&&(e.t=o),this.$http.post(this.widgetUrlBase+"/g/"+t+"/intent",e).then(function(){})},e.prototype.getVoucherSettings=function(t){return this.$http.get(this.widgetUrlBase+"/restaurant/"+t+"/vouchersettings/"+this.$translate.getCurrentCulture())},e.prototype.getTakeAwaySettings=function(t){return this.$http.get(this.widgetUrlBase+"/restaurant/"+t+"/takeawaysettings/"+this.$translate.getCurrentCulture())},e.prototype.getTakeAwayTimes=function(t,e,i,r){return this.$http.get(this.widgetUrlBase+"/restaurant/"+t+"/takeawaytimes/"+e+"/"+i+"/"+(r=void 0===r?[]:r).join(","))},e.prototype.getTakeAwayDates=function(t){return this.$http.get(this.widgetUrlBase+"/restaurant/"+t+"/takeawaydates")},e.prototype.getFirstDateTime=function(t,e,i,r,o,n,s,a){if(!o)return this.$http.get(this.widgetUrlBase+"/availability/"+t.uid+"/first/"+r+"/"+e+"/"+i);i=this.widgetUrlBase+"/availability/"+t.uid+"/ticket/first/"+o+"/"+r+"/"+e+"/"+i;return n&&(i=this.updateQueryStringParameter(i,"friendCode",n)),s&&(i=this.updateQueryStringParameter(i,"voucherCode",s)),null!=a&&(i=this.updateQueryStringParameter(i,"includeWaitlist",a)),this.$http.get(i)},e.prototype.getTimesForDay=function(t,e,i,r,o,n){if(!r)return this.$http.get(this.widgetUrlBase+"/availability/"+t.uid+"/day/"+e.toJSON()+"/"+i+"/"+this.$translate.getCurrentCulture());i=this.widgetUrlBase+"/availability/"+t.uid+"/ticket/day/"+r+"/"+e.toJSON()+"/"+i+"/"+this.$translate.getCurrentCulture();return o&&(i=this.updateQueryStringParameter(i,"friendCode",o)),n&&(i=this.updateQueryStringParameter(i,"voucherCode",n)),this.$http.get(i)},e.prototype.getAvailabilityMonthWeeks=function(t,e,i,r,o,n,s){if(!o)return this.$http.get(this.widgetUrlBase+"/availability/"+t.uid+"/monthWeeks/"+e+"/"+i+"/"+r+"/"+this.$translate.getCurrentCulture());r=this.widgetUrlBase+"/availability/"+t.uid+"/ticket/monthWeeks/"+o+"/"+e+"/"+i+"/"+r+"/"+this.$translate.getCurrentCulture();return n&&(r=this.updateQueryStringParameter(r,"friendCode",n)),s&&(r=this.updateQueryStringParameter(r,"voucherCode",s)),this.$http.get(r)},e.prototype.searchTickets=function(t,e,i,r,o){i=this.widgetUrlBase+"/product/"+t.uid+"/search/"+e.toJSON()+"/"+i+"/"+this.$translate.getCurrentCulture();return r&&(i=this.updateQueryStringParameter(i,"friendCode",r)),o&&(i=this.updateQueryStringParameter(i,"voucherCode",o)),this.$http.get(i)},e.prototype.getRecommendedTickets=function(t){return this.$http.get(this.widgetUrlBase+"/product/"+t.uid+"/recommended/"+this.$translate.getCurrentCulture())},e.prototype.getPaymentMethods=function(t,e,i){return this.$http.get(this.widgetUrlBase+"/payments/"+t.uid+"/methods/"+e+"/"+(i=void 0===i?"TICKET":i))},e.prototype.getPaymentUrlForBooking=function(t){return this.$http.get(this.widgetUrlBase+"/payments/url/booking/"+t)},e.prototype.getPaymentUrlForOrder=function(t){return this.$http.get(this.widgetUrlBase+"/payments/url/order/"+t)},e.prototype.getIdealIssuers=function(t){return this.$http.get(this.widgetUrlBase+"/payments/"+t.uid+"/issuers")},e.prototype.getProduct=function(t,e,i){void 0===i&&(i=null);e=this.widgetUrlBase+"/product/"+t+"/"+e+"/"+this.$translate.getCurrentCulture(),e=this.updateQueryStringParameter(e,"friendCode",i);return this.$http.get(e)},e.prototype.getProducts=function(t,e){e=this.widgetUrlBase+"/product/"+t+"/search/type/"+e+"/"+this.$translate.getCurrentCulture();return this.$http.get(e)},e.prototype.getTakeawayProductsForDate=function(t,e){t=this.widgetUrlBase+"/product/"+t+"/search/takeaway/"+this.$translate.getCurrentCulture();return e&&(t=this.updateQueryStringParameter(t,"date",e)),this.$http.get(t)},e.prototype.hasAnyProducts=function(t,e){return this.$http.get(this.widgetUrlBase+"/product/"+t+"/any/"+(e=void 0===e?null:e))},e.prototype.getVoucher=function(t,e){return this.$http.get(this.widgetUrlBase+"/order/"+t.uid+"/"+this.$translate.getCurrentCulture()+"/getvoucher/"+e)},e.prototype.hasActiveVouchers=function(t){return this.$http.get(this.widgetUrlBase+"/order/"+t+"/hasactivevouchers")},e.prototype.getPromotionCode=function(t,e,i){return this.$http.get(this.widgetUrlBase+"/order/"+t.uid+"/"+this.$translate.getCurrentCulture()+"/promotioncode/"+e+"/"+encodeURIComponent(i))},e.prototype.hasActivePromotionCodes=function(t){return this.$http.get(this.widgetUrlBase+"/order/"+t+"/hasactivepromotioncodes")},e.prototype.createBooking=function(t,e){return this.$http.post(this.widgetUrlBase+"/booking/"+t.uid,e)},e.prototype.createProductOrder=function(t,e){return this.$http.post(this.widgetUrlBase+"/order/"+t.uid+"/CreateProductOrder",e)},e.prototype.createTakeAwayOrder=function(t,e){return this.$http.post(this.widgetUrlBase+"/order/"+t.uid+"/CreateTakeAwayOrder",e)},e.prototype.acceptOption=function(t,e){return this.$http.put(this.widgetUrlBase+"/booking/option/accept",e)},e.prototype.cancelOption=function(t,e){return this.$http.delete(this.widgetUrlBase+"/booking/option/cancel/"+e)},e.prototype.getWaitlistItem=function(t,e){return this.$http.get(this.widgetUrlBase+"/waitlist/"+t+"/"+e)},e.prototype.createWaitlistItem=function(t,e){return this.$http.post(this.widgetUrlBase+"/waitlist/"+t.uid,e)},e.prototype.unsubscribeFromWaitlist=function(t,e){return this.$http.delete(this.widgetUrlBase+"/waitlist/"+t+"/unsubscribe/"+e,null)},e.prototype.getOrder=function(t,e){return this.$http.get(this.widgetUrlBase+"/order/"+e)},e.prototype.getBooking=function(t,e){return this.$http.get(this.widgetUrlBase+"/booking/"+e)},e.prototype.getOption=function(t,e){return this.$http.get(this.widgetUrlBase+"/booking/option/"+e)},e.prototype.getVoucherInfoForOrder=function(t,e){return this.$http.get(this.widgetUrlBase+"/order/getVoucherInfo/"+e)},e.prototype.updateQueryStringParameter=function(t,e,i){var r=new RegExp("([?&])"+e+"=.*?(&|$)","i"),o=-1!==t.indexOf("?")?"&":"?";return t.match(r)?t.replace(r,"$1"+e+"="+i+"$2"):t+o+e+"="+i},e.prototype.unsubscribe=function(t,e,i,r){return this.$http.put(this.widgetUrlBase+"/campaign/unsubscribe",JSON.stringify({email:t,restaurantUid:e,code:i,culture:this.$translate.getCurrentCulture(),recipientId:r}))},e.prototype.subscribe=function(t,e){return this.$http.put(this.widgetUrlBase+"/campaign/subscribe",JSON.stringify({email:t,restaurantUid:e,culture:this.$translate.getCurrentCulture()}))},e.prototype.confirmSubscription=function(t,e,i){return this.$http.put(this.widgetUrlBase+"/campaign/confirmSubscription",JSON.stringify({email:t,restaurantUid:e,code:i,culture:this.$translate.getCurrentCulture()}))},e.prototype.registerVisit=function(t,e,i,r){return void 0===r&&(r=""),this.$http.post(this.widgetUrlBase+"/campaign/event/register/visit",JSON.stringify({campaignId:e,restaurantUid:t,recipientId:r,url:i}))},e.prototype.getTableLinkForRestaurantAvailability=function(t){return this.$http.get(this.widgetUrlBase+"/table-link/"+t+"/availability").then(function(t){return{directLink:t.data.link}})},e.prototype.getTableLinkForTicket=function(t,e,i,r,o){if(!i||!r||!o)return this.$http.get(this.widgetUrlBase+"/table-link/"+t+"/ticket/"+e).then(function(t){return{directLink:t.data.link}});r=new Date(r.getTime()-6e4*r.getTimezoneOffset()).toJSON();return this.$http.get(this.widgetUrlBase+"/table-link/"+t+"/ticket/"+e+"/"+i+"/"+r+"/"+o).then(function(t){return{directLink:t.data.link}})},e.prototype.getTableLinkForWaitlist=function(t,e){return this.$http.get(this.widgetUrlBase+"/table-link/"+t+"/waitlist/"+e).then(function(t){return{directLink:t.data.link}})},e.$inject=["$http","$localStorage","$state","$stateParams","$rootScope","$interval","widgetApiUrl","$location","$translate"],t.ApiService=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").service("apiService",FT.Widget.Side.ApiService),function(i){!function(t){function e(t,e,i,r){this.$stateParams=t,this.apiService=e,this.$location=i,this.$rootScope=r}t=t.Side||(t.Side={}),e.prototype.handleCampaign=function(t){if(!i.Helpers.StorageHelper.storageAvailable("sessionStorage")||!i.Helpers.StorageHelper.storageAvailable("localStorage"))return t.campaignId&&(this.$rootScope.campaignId=t.campaignId),void(t.recipientId&&(this.$rootScope.recipientId=t.recipientId));sessionStorage.getItem("ft-campaignId")||(t.campaignId?(this.$rootScope.campaignId=t.campaignId,t.recipientId&&(this.$rootScope.recipientId=t.recipientId),localStorage.setItem("campaign",JSON.stringify({created:moment().toDate(),recipientId:this.$rootScope.recipientId,id:this.$rootScope.campaignId}))):localStorage.getItem("campaign")&&((t=JSON.parse(localStorage.getItem("campaign"))).created<moment().add("day",-30).toDate()?localStorage.setItem("campaign",null):(this.$rootScope.campaignId=t.id,this.$rootScope.recipientId=t.recipientId)),this.$rootScope.campaignId&&(sessionStorage.setItem("ft-campaignId",this.$rootScope.campaignId),this.apiService.registerVisit(this.$stateParams.uid,this.$rootScope.campaignId,this.$location.url(),this.$rootScope.recipientId)))},e.$inject=["$stateParams","apiService","$location","$rootScope"],t.CampaignService=e}(i.Widget||(i.Widget={}))}(FT=FT||{}),angular.module("widgetSide").service("campaignService",FT.Widget.Side.CampaignService),function(c){var t;(function(g){var n=function(){this.quantity=0,this.options=[]};g.CartProduct=n;var s=function(){};g.CartProductOption=s;var t=(e.prototype.reinitialize=function(){this.products=[],this.orderInfo=new g.OrderInfo},e.prototype.selectTakeAwayMethod=function(t){this.takeAwayMethod=t},e.prototype.getTotalItems=function(){return this.products.map(function(t){return t.quantity}).reduce(function(t,e){return t+e},0)},e.prototype.getTotalAmount=function(t,e){void 0===e&&(e=!1);t=this.getTotalWithoutDelivery(t=void 0===t?!0:t);return"delivery"==this.takeAwayMethod&&this.takeAwayService.takeAwaySettings.deliveryCosts&&(null==this.takeAwayService.takeAwaySettings.deliveryCostsThreshold||this.takeAwayService.takeAwaySettings.deliveryCostsThreshold>t)&&0<this.getTotalItems()&&(t+=this.takeAwayService.takeAwaySettings.deliveryCosts),this.paymentMethod&&(t+=this.paymentMethod.paymentFee),t<0&&!e?0:t},e.prototype.orderForToday=function(){return moment(this.preferredDate).isSame(new Date,"day")},e.prototype.getTotalWithoutDelivery=function(t){(t=void 0===t?!0:t)&&this.checkPromotionCodeStatusAndApplyParameters();var e=0,i=t&&this.promotionCode&&!this.promotionCode.invalid,t=c.Helpers.PromotionCodeHelper.amountOfSpecificApplicableProducts(this.promotionCode);if(i&&0===t){for(var r=0,o=this.products;r<o.length;r++)e+=(a=o[r]).quantity*a.priceIncOptions;e=c.Helpers.PromotionCodeHelper.applyPerOrderPromotionCodeToTotalAmount(e,this.promotionCode)}else for(var n=0,s=this.products;n<s.length;n++)var a=s[n],e=c.Helpers.PromotionCodeHelper.applyPromotionCodeToTotalAmount(e,i?this.promotionCode:null,a.uid,a.quantity,a.priceIncOptions);return e},e.prototype.getProduct=function(e){return this.products.filter(function(t){return t.uid==e})[0]},e.prototype.compareOptions=function(t,e){var t=t.options.map(function(t){return t.productOptionValueUid}),i=[];return e.productOptions.forEach(function(t){t.chosenValue?i.push(t.chosenValue.uid):t.chosenValues&&t.chosenValues.forEach(function(t){i.push(t.uid)})}),angular.equals(t.sort(),i.sort())},e.prototype.addProduct=function(e){var r,i=this,t=this.products.filter(function(t){return t.uid==e.uid}),o=!1;t.forEach(function(t){t&&i.compareOptions(t,e)&&(t.quantity+=e.quantity,o=!0,e.quantity=1,e.validationErrors=[],e.productOptions.forEach(function(t){t.chosenValueQuantity=1,t.chosenValue=null,t.chosenValues=null,t.productOptionValues.forEach(function(t){t.selected=!1})}))}),o||((r=new n).uid=e.uid,r.title=e.title,r.description=e.description,r.image=e.image,r.price=e.price,r.priceIncOptions=e.price,r.quantity=e.quantity||1,r.availability=e.availability,e.productOptions.forEach(function(i){var t;i.chosenValue?((t=new s).productOptionUid=i.uid,t.productOptionTitle=i.title,t.productOptionValueUid=i.chosenValue.uid,t.productOptionValueTitle=i.chosenValue.title,t.price=i.chosenValue.price,t.quantity=i.chosenValueQuantity||1,r.options.push(t),r.priceIncOptions+=t.price*(t.quantity||1)):i.chosenValues&&i.chosenValues.forEach(function(t){var e=new s;e.productOptionUid=i.uid,e.productOptionTitle=i.title,e.productOptionValueUid=t.uid,e.productOptionValueTitle=t.title,e.price=t.price,e.quantity=1,r.options.push(e),r.priceIncOptions+=e.price*(e.quantity||1)})}),r.priceIncOptions<0?e.validationErrors.push("Cannot add a negative priced product. Please change the options"):(this.products.push(r),e.quantity=1,e.validationErrors=[],e.productOptions.forEach(function(t){t.chosenValueQuantity=1,t.chosenValue=null,t.chosenValues=null,t.productOptionValues.forEach(function(t){t.selected=!1})})))},e.prototype.setPreferredDate=function(e){this.selectedDate=this.takeAwayService&&this.takeAwayService.dates&&this.takeAwayService.dates.filter(function(t){return moment(t.date).format("YYYY-MM-DD")===e})[0],this.selectedDate&&(this.selectedDate.deliveryEnabled&&this.selectedDate.pickUpEnabled?this.takeAwayMethod=this.takeAwayMethod||"pick-up":this.selectedDate.pickUpEnabled?this.takeAwayMethod="pick-up":this.selectedDate.deliveryEnabled&&(this.takeAwayMethod="delivery"),this.setPreferredTime())},e.prototype.setPreferredTime=function(){var e=this;this.takeAwayService.updateTimes(this.preferredDate,this.takeAwayMethod,this.products).then(function(t){e.preferredTime=e.takeAwayService.preferredTimeIsAvailable(e.preferredTime)?e.preferredTime:e.takeAwayService.getFirstAvailableTime()})},e.prototype.applyPromotionCode=function(t){var e=this;this.checkAndApplyPromotionCode(t).then(function(t){t||(e.invalidPromotionCode=!0,e.getTotalAmount())})},e.prototype.removePromotionCode=function(){this.promotionCode=null,this.widgetService.promotionCode=null,this.getTotalAmount()},e.prototype.checkAndApplyPromotionCode=function(t){var e=this,i=this.$q.defer();return this.promotionCode?i.resolve(!1):this.widgetService.checkPromotionCode("TAKEAWAY",t).then(function(t){t&&(e.setPromotionCode(),e.invalidPromotionCode=!1,i.resolve(!0)),i.resolve(!1)}),i.promise},e.prototype.setPromotionCode=function(){this.promotionCode=this.widgetService.promotionCode,this.getTotalAmount()},e.prototype.checkPromotionCodeStatusAndApplyParameters=function(){this.invalidPromotionCodeProductType=!1,this.invalidPromotionCodeProducts=!1,this.invalidPromotionCodeMinAmount=!1,this.promotionCode&&(this.promotionCode.invalid=!1,"TAKEAWAY"!==this.widgetService.promotionCode.productType&&(this.promotionCode.invalid=!0,this.invalidPromotionCodeProductType=!0),c.Helpers.PromotionCodeHelper.promotionCodeAppliesToAnyProduct(this.promotionCode,this.products.map(function(t){return t.uid}))||(this.promotionCode.invalid=!0,this.invalidPromotionCodeProducts=!0),this.promotionCode.minAmount&&this.getTotalWithoutDelivery(!1)<this.promotionCode.minAmount&&(this.promotionCode.invalid=!0,this.invalidPromotionCodeMinAmount=!0))},e.$inject=["settings","$filter","$location","$http","$localStorage","$state","$stateParams","$rootScope","$interval","takeAwayService","apiService","cssService","widgetService","$q"],e);function e(t,e,i,r,o,n,s,a,c,u,d,l,h,p){var m=this;this.settings=t,this.$filter=e,this.$location=i,this.$http=r,this.$localStorage=o,this.$state=n,this.$stateParams=s,this.$rootScope=a,this.$interval=c,this.takeAwayService=u,this.apiService=d,this.cssService=l,this.widgetService=h,this.$q=p,this.takeAwayMethod="pick-up",this.cssService.setWidgetId(this.widgetService.getWidgetId()),this.products=[],this.orderInfo=new g.OrderInfo,this.widgetService.promotionCodeLoaded().then(function(){m.setPromotionCode()}),this.$rootScope.$watch(function(){return m.preferredDate},function(t,e){t!==e&&m.setPreferredDate(t)}),this.$rootScope.$watch(function(){return m.takeAwayService.dates},function(t,e){m.preferredDate&&m.setPreferredDate(m.preferredDate)},!0),this.$rootScope.$watch(function(){return m.takeAwayMethod},function(t,e){m.setPreferredTime()},!0)}g.CartService=t})((t=c.Widget||(c.Widget={})).Side||(t.Side={}))}(FT=FT||{}),angular.module("widgetSide").service("cartService",FT.Widget.Side.CartService),function(t){!function(t){var l;function e(t,e,i,r,o,n,s,a,c,u,d,l,h,p){this.settings=t,this.$filter=e,this.$location=i,this.$http=r,this.$localStorage=o,this.$state=n,this.$stateParams=s,this.$rootScope=a,this.$interval=c,this.widgetService=u,this.apiService=d,this.cssService=l,this.trackingService=h,this.guestService=p,this.cssService.setWidgetId(this.widgetService.getWidgetId())}l=t.Side||(t.Side={}),e.prototype.createProductOrder=function(e,t,i,r,o,n,s,a,c){var u=this,d=new l.CreateProductOrderModel;return d.orderInfo=angular.copy(e),d.productUid=t,d.quantity=i,d.paymentMethodId=n?n.id:"",d.issuerId=s?s.id:"",d.returnUrl=this.settings.returnUrl,d.source=this.widgetService.source,d.campaignId=this.widgetService.campaignId,d.recipientId=this.widgetService.recipientId,o&&(d.promotionCode=o),a&&(d.voucherInfo=a),this.apiService.createProductOrder(this.widgetService.restaurant,d).then(function(t){t=t.data;u.guestService.saveOrderData(e),u.trackingService.logCreateProductOrderEvent(d,r,c),u.$state.go("voucherFinish",{uid:u.$stateParams.uid,order:t.orderUid,culture:u.$stateParams.culture,type:"regular",paymentRequired:!!n})})},e.prototype.createTakeAwayOrder=function(e,t,i,r,o,n,s){var a=this,c=new l.CreateTakeAwayOrderModel;return c.orderInfo=angular.copy(e),c.takeAwayInfo=t,i.forEach(function(t){0<t.quantity&&c.items.push(t)}),c.paymentMethodId=n?n.id:"",c.issuerId=s?s.id:"",c.returnUrl=this.settings.returnUrl,c.promotionCode=o,c.source=this.widgetService.source,c.campaignId=this.widgetService.campaignId,c.recipientId=this.widgetService.recipientId,this.apiService.createTakeAwayOrder(this.widgetService.restaurant,c).then(function(t){t=t.data;a.guestService.saveOrderData(e,c.takeAwayInfo.takeAwayMethod);i.map(function(t){return{productUid:t.productUid,quantity:t.quantity}});a.trackingService.logCreateTakeAwayOrderEvent(c,r),a.$state.go("takeAwayFinish",{uid:a.$stateParams.uid,order:t.orderUid,culture:a.$stateParams.culture,type:"regular",paymentRequired:!!n})})},e.prototype.createBooking=function(e,i,t,r,o,n,s){var a=this,c=new l.CreateBookingModel;return c.booking=angular.copy(e),c.ticketUid=o?o.uid:"",c.paymentMethodId=n?n.id:"",c.issuerId=s?s.id:"",c.returnUrl=this.settings.returnUrl,c.promotionCode=r,c.voucherCode=t,c.source=this.widgetService.source,c.campaignId=this.widgetService.campaignId,c.recipientId=this.widgetService.recipientId,this.widgetService.friendCode&&(c.friendCode=this.widgetService.friendCode),this.widgetService.waitlistItemId&&(c.waitlistItemId=this.widgetService.waitlistItemId),this.apiService.createBooking(this.widgetService.restaurant,c).then(function(t){t=t.data;a.guestService.saveBookingData(e),a.trackingService.logCreateBooking(c,a.widgetService.restaurant.uid,i,o),a.$state.go("finish",{uid:a.$stateParams.uid,culture:a.$stateParams.culture,booking:t.bookingUid,type:"regular",paymentRequired:!!n})})},e.prototype.createWaitlistItem=function(e){var i=this;return e.source=this.widgetService.source,e.campaignId=this.widgetService.campaignId,e.recipientId=this.widgetService.recipientId,this.widgetService.friendCode&&(e.invitationCode=this.widgetService.friendCode),this.apiService.createWaitlistItem(this.widgetService.restaurant,e).then(function(t){i.widgetService.waitlistItem=t.data,i.guestService.saveWaitlistData(e),i.trackingService.logCreateWaitlistItem(e),i.$state.go("waitlistFinish",{uid:i.$stateParams.uid,culture:i.$stateParams.culture,type:"regular",paymentRequired:!1})})},e.$inject=["settings","$filter","$location","$http","$localStorage","$state","$stateParams","$rootScope","$interval","widgetService","apiService","cssService","trackingService","guestService"],l.CheckoutService=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").service("checkoutService",FT.Widget.Side.CheckoutService),function(t){!function(t){function e(t,e,i,r,o,n,s,a){this.$http=t,this.$localStorage=e,this.$state=i,this.$stateParams=r,this.$rootScope=o,this.$interval=n,this.$location=s,this.sdkService=a,this.initialize()}t=t.Side||(t.Side={}),e.prototype.initialize=function(){this.reset()},e.prototype.setWidgetId=function(t){this.widgetId=t},e.prototype.full=function(t){var e=this;$("body").addClass("fullw"),this.sdkService.call("full",t||this.widgetId,[]),setTimeout(function(){e.sdkService.call("addClass",t||e.widgetId,["fullw-delayed"])},1e3)},e.prototype.small=function(t){var e=this;$("body").removeClass("fullw"),this.sdkService.call("small",t||this.widgetId,[]),setTimeout(function(){e.sdkService.call("removeClass",t||e.widgetId,["fullw-delayed"])},1e3)},e.prototype.close=function(t,e){$("body").removeClass("ft-open"),this.sdkService.call("close",e||this.widgetId,[t||"widget"])},e.prototype.open=function(t,e){$("body").addClass("ft-open"),this.sdkService.call("open",e||this.widgetId,[t||"widget"])},e.prototype.addClass=function(t,e){$("body").addClass(t),this.sdkService.call("addClass",e||this.widgetId,[t])},e.prototype.removeClass=function(t,e){$("body").removeClass(t),this.sdkService.call("removeClass",e||this.widgetId,[t])},e.prototype.removeAllClasses=function(t,e){void 0===e&&(e=!0);var i=$("body").hasClass("fullw");$("body").removeClass(),e||!i?this.sdkService.call("removeAllClasses",t||this.widgetId,[]):this.sdkService.call("removeAllClasses",t||this.widgetId,["fullw-delayed"])},e.prototype.setStyle=function(t,e,i){this.addCSSRule(this.sheet,t,e+":"+i)},e.prototype.reset=function(){var t=this.getSheet("extraStyles","screen");if(t.cssRules.length)for(var e=0;e<t.cssRules.length;e++)t.deleteRule?t.deleteRule(e):t.removeRule&&t.removeRule(e);this.sheet=t},e.prototype.getSheet=function(t,e){var i=document.getElementById(t);if(i)return i.sheet;i=document.createElement("style");return i.appendChild(document.createTextNode("")),i.type="text/css",i.media=e||"screen",i.id=t,document.head.appendChild(i),i.sheet},e.prototype.getHexBrightness=function(t){t=t.substring(1),t=parseInt(t,16);return.2126*(t>>16&255)+.7152*(t>>8&255)+.0722*(t>>0&255)},e.prototype.addCSSRule=function(t,e,i){var r=t.cssRules.length;"insertRule"in t?t.insertRule(e+"{"+i+"}",r):"addRule"in t&&t.addRule(e,i,r)},e.prototype.hex2rgb=function(t,e){for(var i=(i=t.replace("#","")).match(new RegExp("(.{"+i.length/3+"})","g")),r=0;r<i.length;r++)i[r]=parseInt(1==i[r].length?i[r]+i[r]:i[r],16);return void 0!==e&&i.push(e),"rgba("+i.join(",")+")"},e.$inject=["$http","$localStorage","$state","$stateParams","$rootScope","$interval","$location","sdkService"],t.CssService=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").service("cssService",FT.Widget.Side.CssService),function(t){!function(t){function e(t,e,i){this.$localStorage=t,this.$stateParams=e,this.apiService=i,this.loadGuestFromStorage()}t=t.Side||(t.Side={}),e.prototype.hasGuestData=function(){return null!=this.guest},e.prototype.loadGuestFromStorage=function(){this.$localStorage.email?(this.guest={title:this.$localStorage.title,company:"true"===this.$localStorage.company,companyName:this.$localStorage.companyName,firstName:this.$localStorage.firstName,lastName:this.$localStorage.lastName,email:this.$localStorage.email,telephone:this.$localStorage.telephone,address:this.$localStorage.address,zipcode:this.$localStorage.zipcode,city:this.$localStorage.city,isReturning:!1},this.getGuestStatus()):this.guest=null},e.prototype.getGuestStatus=function(){var e=this;if(this.guest)return this.apiService.getGuestStatus(this.$stateParams.uid,this.guest.email).then(function(t){e.guest.isReturning=t,console.log("guest",t,e.guest)})},e.prototype.saveOrderData=function(t,e){void 0===e&&(e=null),this.$localStorage.title=t.title,this.$localStorage.company=t.company?"true":"false",this.$localStorage.companyName=t.companyName,this.$localStorage.firstName=t.firstName,this.$localStorage.lastName=t.lastName,this.$localStorage.email=t.email,this.$localStorage.telephone=t.telephone,null!==e&&"delivery"===e&&(this.$localStorage.address=t.address,this.$localStorage.zipcode=t.zipcode,this.$localStorage.city=t.city),this.loadGuestFromStorage()},e.prototype.saveBookingData=function(t){this.$localStorage.title=t.title,this.$localStorage.company=t.company?"true":"false",this.$localStorage.companyName=t.companyName,this.$localStorage.firstName=t.firstName,this.$localStorage.lastName=t.lastName,this.$localStorage.email=t.email,this.$localStorage.telephone=t.telephone,this.loadGuestFromStorage()},e.prototype.saveWaitlistData=function(t){this.$localStorage.title=t.title,this.$localStorage.company=t.company?"true":"false",this.$localStorage.companyName=t.companyName,this.$localStorage.firstName=t.firstName,this.$localStorage.lastName=t.lastName,this.$localStorage.email=t.email,this.$localStorage.telephone=t.telephone,this.loadGuestFromStorage()},e.$inject=["$localStorage","$stateParams","apiService"],t.GuestService=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").service("guestService",FT.Widget.Side.GuestService);var FT,__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};!function(o){var t;(function(t){var n=function(){};t.MessageOut=n;var e=(i.prototype.call=function(t,e,i,r){var o=new n;o.address=e,o.method=t,o.args=i,parent.postMessage(o,"*")},i.prototype.setReturnUrl=function(t){this.settings.returnUrl=t},i.prototype.open=function(t){$("body").addClass("ft-open")},i.prototype.close=function(t){$("body").removeClass("ft-open")},i.prototype.setCampaign=function(t){t&&(o.Helpers.StorageHelper.storageAvailable("sessionStorage")&&sessionStorage.removeItem("ft-campaignId"),this.campaignService.handleCampaign({campaignId:t}))},i.prototype.navigate=function(t,e,i,r){r={uid:r||this.$stateParams.uid,culture:this.$stateParams.culture};i&&(o.Helpers.StorageHelper.storageAvailable("sessionStorage")&&sessionStorage.removeItem("ft-campaignId"),this.campaignService.handleCampaign(__assign(__assign({},r),{campaignId:i}))),"ticket"===t&&(r.ticketId=e),"voucher"===t&&(r.productUid=e),"voucherCheckout"===t&&(r.productUid=e),"subscribe"===t&&(r.email=e),"takeaway"===t&&(r.productUid=e),this.$state.go(t,r)},i.$inject=["settings","$state","$stateParams","$timeout","campaignService"],i);function i(t,e,i,r,o){var n=this;this.settings=t,this.$state=e,this.$stateParams=i,this.$timeout=r,this.campaignService=o,window.addEventListener("message",function(t){var e=t.data,t=n[e.method];t&&t.apply(n,e.args)},!1)}t.SdkService=e})((t=o.Widget||(o.Widget={})).Side||(t.Side={}))}(FT=FT||{}),angular.module("widgetSide").service("sdkService",FT.Widget.Side.SdkService),function(t){!function(t){function e(t,e,i,r,o,n,s,a,c){var u=this;this.widgetService=t,this.$state=e,this.$stateParams=i,this.$timeout=r,this.apiService=o,this.cssService=n,this.$q=s,this.$filter=a,this.$translate=c,this.widgetService.restaurantLoaded().then(function(t){u.initialize()})}t=t.Side||(t.Side={}),e.prototype.initialize=function(){var e=this;this.getTakeAwaySettings().then(function(t){e.takeAwaySettings=t,e.widgetService.showOrderBtn=e.takeAwaySettings.enabled,e.takeAwaySettings.enabled&&e.getTakeAwayDates().then(function(t){e.dates=t,e.loaded=!0}),e.widgetService.showOrderBtn&&!e.widgetService.multiVenue&&e.cssService.addClass("ft-vouchers-active")})},e.prototype.reinitialize=function(){var e=this;this.takeAwaySettings=null,this.dates=null,this.times=null,this.widgetService.restaurantLoaded().then(function(t){e.initialize()})},e.prototype.validateZipcode=function(e){return!(this.takeAwaySettings.deliveryZipcodes&&this.takeAwaySettings.deliveryZipcodes.length&&e)||this.takeAwaySettings.deliveryZipcodes.some(function(t){return e.trim().substr(0,t.length)==t})},e.prototype.getFirstPossibleDate=function(){var e=this.$q.defer();return this.getTakeAwayDates().then(function(t){t=t.filter(function(t){return!t.closed})[0];t?e.resolve(t):e.reject()}),e.promise},e.prototype.getOpenTimes=function(e){var t,i=this;return(t=this.takeAwaySettings?angular.copy(this.takeAwaySettings.days):t).splice(0,1),t.push(this.takeAwaySettings.days[0]),t.map(function(t){return{dayOfWeek:t.dayOfWeek,day:moment().day(t.dayOfWeek).format("ddd"),times:"delivery"==e?t.deliveryEnabled?i.$filter("timeFromMinutes")(t.deliveryStartTime,i.widgetService.restaurant.timeFormat)+" - "+i.$filter("timeFromMinutes")(t.deliveryEndTime,i.widgetService.restaurant.timeFormat):i.$translate.getTranslation("CLOSED"):t.pickUpEnabled?i.$filter("timeFromMinutes")(t.pickUpStartTime,i.widgetService.restaurant.timeFormat)+" - "+i.$filter("timeFromMinutes")(t.pickUpEndTime,i.widgetService.restaurant.timeFormat):i.$translate.getTranslation("CLOSED")}})},e.prototype.getTakeAwaySettings=function(){var e=this.$q.defer();return this.takeAwaySettings?e.resolve(this.takeAwaySettings):this.apiService.getTakeAwaySettings(this.$stateParams.uid).then(function(t){e.resolve(t.data)}),e.promise},e.prototype.getTakeAwayDateSettings=function(e){return this.dates.filter(function(t){return moment(t.date).isSame(e,"day")})[0]},e.prototype.updateTimes=function(t,e,i){var r=this;void 0===i&&(i=[]);var o=this.$q.defer();return this.apiService.getTakeAwayTimes(this.$stateParams.uid,t,e,i.filter(function(t){return 0<t.quantity}).map(function(t){return t.uid})).then(function(t){r.times=t.data.times,o.resolve(r.times)}),o.promise},e.prototype.getTakeAwayDates=function(){var e=this.$q.defer();return this.dates?e.resolve(this.dates):this.apiService.getTakeAwayDates(this.$stateParams.uid).then(function(t){e.resolve(t.data)}),e.promise},e.prototype.timesAvailable=function(){return this.times.some(function(t){return t.isAvailable})},e.prototype.preferredTimeIsAvailable=function(e){return this.times.some(function(t){return t.isAvailable&&t.time==e})},e.prototype.getFirstAvailableTime=function(){var t=this.times.filter(function(t){return t.isAvailable})[0];return t?t.time:null},e.prototype.applyPromotionCode=function(){var e=this;this.widgetService.checkPromotionCode("TAKEAWAY",this.code).then(function(t){t&&(e.promotionCode=e.widgetService.promotionCode)})},e.$inject=["widgetService","$state","$stateParams","$timeout","apiService","cssService","$q","$filter","$translate"],t.TakeAwayService=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").service("takeAwayService",FT.Widget.Side.TakeAwayService),function(t){!function(t){function e(t){this.$translate=t,this.m=6e4,this.h=60*this.m,this.d=24*this.h,this.w=7*this.d}t=t.Side||(t.Side={}),e.prototype.dateFromNow=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var r=new Date,o=r.getFullYear(),n=r.getMonth(),r=r.getDate();return new Date(o+t,n+e,r+i)},e.prototype.milliSecondsFromMidnight=function(){var t=new Date;return t.getTime()-t.setHours(0,0,0,0)},e.prototype.milliSecondsToMidnight=function(){var t=new Date;return(new Date).setHours(24,0,0,0)-t.getTime()},e.prototype.getMilliSeconds=function(t,e){if("0"==t)return 0;var i=/(\-{0,1}\d{1,2})([A-Za-z]{0,1})(\d{2,4})?/g.exec(t),t=parseInt(i[1]),i=i[2];return"m"==i?t*this.m:"h"==i?t*this.h:"d"==i?e?t*this.d:this.milliSecondsToMidnight()+(t-1)*this.d:"w"==i?this.getMilliSeconds(7*t+"d"):void 0},e.prototype.toString=function(t){if(!t)return"";var e=/(\-{0,1}\d{1,2})([A-Za-z]{0,1})(\d{2,4})?/g.exec(t),i=parseInt(e[1]),t=e[2],e=e[3]?parseInt(e[3]):null,t=0===i?this.$translate.getTranslation("the same")+" "+this.$translate.getTranslation("ts_single_"+t):i+" "+this.$translate.getTranslation((1===i?"ts_single_":"ts_multiple_")+t);return t=e?t+" ("+this.$translate.getTranslation("at")+" "+moment.utc(moment.duration(e,"minutes").asMilliseconds()).format("LT")+")":t},e.$inject=["$translate"],t.TimeSpanService=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").service("timeSpanService",FT.Widget.Side.TimeSpanService),function(c){!function(t){function e(t,e,i){this.trackingEnabled=t,this.$q=e,this.$sessionStorage=i,this.COMPONENT="widget"}t=t.Side||(t.Side={}),e.prototype.logVisit=function(t,e,i){var r;(r=this.$sessionStorage.trackingSessionId)||((t={trackingSessionId:r=c.Helpers.GuidHelper.short(),campaignId:t,component:this.COMPONENT}).widgetToTableLandingEnabled=i,this.addGuestData(e,t),amplitude.getInstance().logEvent("WidgetLoad",t),this.$sessionStorage.trackingSessionId=r)},e.prototype.setRestaurant=function(t){amplitude.getInstance().setGroup("restaurant_uid",t.uid)},e.prototype.setCampaign=function(t){amplitude.getInstance().setGroup("campaign_id",t)},e.prototype.logNavAction=function(t,e,i,r){void 0===r&&(r=null);var o=this.$q.defer(),n=this.$sessionStorage.trackingSessionId;n||(n=c.Helpers.GuidHelper.short(),this.$sessionStorage.trackingSessionId=n);var s={trackingSessionId:n,campaignId:e,component:this.COMPONENT};if(r)for(var a in r)s[a]=r[a];return this.addGuestData(i,s),amplitude.getInstance().logEvent("WidgetNavigation"+t,s,function(){o.resolve()}),o.promise},e.prototype.logCreateBooking=function(t,e,i,r){var o;t.booking.email&&(o=t.booking.email.toLowerCase(),amplitude.getInstance().setUserId(c.Helpers.HashHelper.MD5(o)),r=r?r.price:0,e={productUid:t.ticketUid,quantity:t.booking.numberOfPeople,campaignId:t.campaignId,source:t.source,culture:t.booking.culture,bookingUid:t.booking.uid,bookingDate:t.booking.bookingDate,bookingTime:t.booking.bookingTime,bookingDuration:t.booking.bookingDuration,short:t.booking.short,tags:t.booking.tags,newsletter:t.booking.newsletter,ticketAmount:r,totalAmount:r*t.booking.numberOfPeople,totalAmountPaid:i,restaurantGroupMember:"Formitable",restaurantUid:e,component:this.COMPONENT},amplitude.getInstance().logEvent("CreateBooking",e))},e.prototype.logCreateTakeAwayOrderEvent=function(e,t){var i,r=this;e.orderInfo.email&&(i=e.orderInfo.email.toLowerCase(),amplitude.getInstance().setUserId(c.Helpers.HashHelper.MD5(i)),e.items.forEach(function(t){t={productUid:t.productUid,quantity:t.quantity,priceIncOptions:t.priceIncOptions,campaignId:e.campaignId,source:e.source,culture:e.orderInfo.culture,takeAway_date:e.takeAwayInfo.date,takeAway_preferredTime:e.takeAwayInfo.preferredTime,takeAway_takeAwayMethod:e.takeAwayInfo.takeAwayMethod,newsletter:e.orderInfo.newsletter,component:r.COMPONENT};amplitude.getInstance().logEvent("CreateTakeAwayOrderItem",t)}),t={campaignId:e.campaignId,source:e.source,culture:e.orderInfo.culture,takeAway_date:e.takeAwayInfo.date,takeAway_preferredTime:e.takeAwayInfo.preferredTime,takeAway_takeAwayMethod:e.takeAwayInfo.takeAwayMethod,newsletter:e.orderInfo.newsletter,totalAmountPaid:t,component:this.COMPONENT},amplitude.getInstance().logEvent("CreateTakeAwayOrder",t))},e.prototype.logCreateProductOrderEvent=function(t,e,i){var r;t.orderInfo.email&&(r=t.orderInfo.email.toLowerCase(),amplitude.getInstance().setUserId(c.Helpers.HashHelper.MD5(r)),i=i?i.price:0,e={productUid:t.productUid,quantity:t.quantity,campaignId:t.campaignId,source:t.source,culture:t.orderInfo.culture,newsletter:t.orderInfo.newsletter,productAmount:i,totalAmount:i*t.quantity,totalAmountPaid:e,component:this.COMPONENT},amplitude.getInstance().logEvent("CreateProductOrder",e))},e.prototype.logCreateWaitlistItem=function(t){var e;t.email&&(e=t.email.toLowerCase(),amplitude.getInstance().setUserId(c.Helpers.HashHelper.MD5(e)),t={productUid:t.productUid,quantity:t.partySize,campaignId:t.campaignId,source:t.source,culture:t.culture,date:t.date,fromTime:t.fromTime,untilTime:t.untilTime,duration:t.duration,newsletter:t.newsletter,component:this.COMPONENT},amplitude.getInstance().logEvent("CreateWaitlistItem",t))},e.prototype.logRequestSubscribeGuest=function(t){t&&(t=t.toLowerCase(),amplitude.getInstance().setUserId(c.Helpers.HashHelper.MD5(t)),t={component:this.COMPONENT},amplitude.getInstance().logEvent("RequestSubscribeGuest",t))},e.prototype.logConfirmSubscribeGuest=function(t){t&&(t=t.toLowerCase(),amplitude.getInstance().setUserId(c.Helpers.HashHelper.MD5(t)),t={component:this.COMPONENT},amplitude.getInstance().logEvent("ConfirmSubscribeGuest",t))},e.prototype.logUnsubscribeGuest=function(t){t&&(t=t.toLowerCase(),amplitude.getInstance().setUserId(c.Helpers.HashHelper.MD5(t)),t={component:this.COMPONENT},amplitude.getInstance().logEvent("UnsubscribeGuest",t))},e.prototype.addGuestData=function(t,e){var i;e.knownGuest=null!=t,null!=t&&(i=t.email.toLowerCase(),amplitude.getInstance().setUserId(c.Helpers.HashHelper.MD5(i)),e.restaurantReturnee=t.isReturning)},e.$inject=["trackingEnabled","$q","$sessionStorage"],t.TrackingService=e}(c.Widget||(c.Widget={}))}(FT=FT||{}),angular.module("widgetSide").config(["trackingEnabled","amplitudeApiKey",function(t,e){t&&amplitude.getInstance().init(e,null,{"plan.source":"widget"})}]).service("trackingService",FT.Widget.Side.TrackingService),function(t){!function(t){function e(t,e,i){this.$stateParams=t,this.apiService=e,this.$q=i}t=t.Side||(t.Side={}),e.prototype.getVoucherSettings=function(t){var e=this,i=this.$q.defer();return this.apiService.getVoucherSettings(t).then(function(t){e.voucherSettings=t.data,i.resolve(e.voucherSettings)}),i.promise},e.$inject=["$stateParams","apiService","$q"],t.VoucherService=e}(t.Widget||(t.Widget={}))}(FT=FT||{}),angular.module("widgetSide").service("voucherService",FT.Widget.Side.VoucherService),function(c){var t;(function(w){var k;(t=k=w.BookViewState||(w.BookViewState={})).Landing="landing",t.Suggested="suggested",t.Search="search";var t=(Object.defineProperty(e.prototype,"campaignId",{get:function(){return this.$rootScope.campaignId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"recipientId",{get:function(){return this.$rootScope.recipientId},enumerable:!1,configurable:!0}),e.prototype.getWidgetId=function(){return"b2_"+(this.multiVenue?this.multiVenueUid:this.$stateParams.uid)},e.prototype.checkVoucherCode=function(e){var i=this,r=this.$q.defer();return this.restaurantLoaded().then(function(t){i.apiService.getVoucher(t,e).then(function(t){t.data?(i.voucher=t.data,i.voucher.ticket&&(i.ticketOnly=!0),r.resolve(!0)):r.resolve(!1)})}),r.promise},e.prototype.checkPromotionCode=function(e,i){var r=this,o=this.$q.defer();return this.restaurantLoaded().then(function(t){r.apiService.getPromotionCode(t,e,i).then(function(t){t.data?(r.promotionCode=t.data,o.resolve(!0)):o.resolve(!1),r.deferredPromotionCode.resolve(r.promotionCode)})}),o.promise},e.prototype.hasFeature=function(e){return this.restaurant&&this.restaurant.features.some(function(t){return t===e})},e.prototype.redirect=function(t){switch(t.paymentProvider){case w.PaymentProvider.MOLLIE:default:window.top.location.href=t.paymentUrl;break;case w.PaymentProvider.STRIPE:window.Stripe(t.publicStripeApiKey,{stripeAccount:t.stripeAccountId}).redirectToCheckout({sessionId:t.stripeSessionId})}},e.prototype.showTitleInCheckout=function(){return!this.hasFeature("REMOVE_TITLE_FROM_WIDGET")},e.prototype.showGenderNeutralOptionInCheckout=function(){return this.hasFeature("SHOW_GENDER_NEUTRAL_OPTION")},e.prototype.initialize=function(e,t,i,r){var o=this;void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===r&&(r=!1),this.onMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this.settings.returnUrl=this.widgetUrl+"/side/"+this.$stateParams.culture+"/"+this.$stateParams.uid+"/finish",moment.locale(this.$translate.getCurrentCulture()),i?this.multiVenueCurrentState=!1:r?this.multiVenueCurrentState=!0:(r=(i=window.location.href.split("?")[0]).split("/"),r="multi"===(i.lastIndexOf("/")!==i.length-1?r[r.length-1]:r[r.length-2]),this.multiVenueCurrentState=r,this.multiVenueSet||(this.multiVenueSet=!0,this.multiVenue=r,this.multiVenue&&(this.multiVenueUid=this.$stateParams.uid,this.multiVenueLanguage=this.$stateParams.culture)));var n,s,a=e||this.$location.search();this.originalSearchParams=a,t||this.campaignService.handleCampaign(a),this.isOption=this.$stateParams.optionId,this.ticketOnly=""==a.ticketOnly,this.showToolbar=!0,screen.width<600&&a.mobileToolbar?this.showToolbar="true"===a.mobileToolbar:a.toolbar&&(this.showToolbar="true"===a.toolbar),this.showToolbar||this.cssService.addClass("ft-no-toolbar"),this.preview="true"===a.preview,this.reopen="false"!==a.reopen,a.tag&&(this.source=a.tag.substring(0,99),this.booking.source=a.tag.substring(0,99)),a.color||(a.color="#000"),this.setColor(a.color),this.color=a.color,a.friendCode&&(this.friendCode=a.friendCode),a.partysize?(this.searchParams.numberOfPeople&&this.searchParams.numberOfPeople!=parseInt(a.partysize)?this.isNumberOfPeopleChanged=!0:this.isNumberOfPeopleChanged=!1,this.searchParams.numberOfPeople=parseInt(a.partysize)):this.searchParams.numberOfPeople||!this.isOption&&!this.ticketOnly||(this.searchParams.numberOfPeople=null),a.date&&(t=moment(this.$stateParams.date).toDate(),this.searchParams.bookingDate&&!moment(this.searchParams.bookingDate).isSame(t,"day")?this.isSearchDateChanged=!0:this.isSearchDateChanged=!1,this.searchParams.bookingDate=t),a.time&&(n=c.Helpers.DateHelper.timeFromMinutes(this.$stateParams.time),this.searchParams.bookingTime&&this.searchParams.bookingTime!=n?this.isSearchTimeChanged=!0:this.isSearchTimeChanged=!1,this.searchParams.bookingTime=n),a.waitlistItem&&this.apiService.getWaitlistItem(this.$stateParams.uid,this.$stateParams.waitlistItem).then(function(t){"CREATED"===t.data.status&&(o.waitlistItemId=o.$stateParams.waitlistItem,o.deferredWaitlistItem.resolve(t.data))}),a.site&&"wix-mobile"==a.site&&this.cssService.addClass("wix-mobile"),this.embedded=a.embed||""==a.embedded||"1"==a.embedded,this.embedded&&(this.settings.returnUrl=document.referrer.split(/[?#]/)[0],-1<document.referrer.indexOf("ft-booking")&&(n=document.referrer.match(/ft-booking=([^&]*)/)[1],this.$state.go("finish",{uid:this.$stateParams.uid,culture:this.$stateParams.culture,booking:n,type:"prepaid"})),-1<document.referrer.indexOf("ft-ticket")&&(s=document.referrer.match(/ft-ticket=([^&]*)/)[1],this.$state.go("ticket",{uid:this.$stateParams.uid,culture:this.$stateParams.culture,ticketId:s})),-1<document.referrer.indexOf("ft-option")&&(s=document.referrer.replace(new RegExp("\\bFT.Core.ViewModels.MailTemplates.BookingMail.\\b"),"").match(/ft-option=([^&]*)/)[1],this.$state.go("option",{uid:this.$stateParams.uid,culture:this.$stateParams.culture,optionId:s,accept:!0}))),this.restaurantLoaded().then(function(t){o.showVoucherBtn=o.restaurant.productTypes.some(function(t){return"GIFTVOUCHER"===t}),o.showVoucherBtn&&!o.multiVenue&&o.cssService.addClass("ft-vouchers-active"),o.apiService.hasActiveVouchers(t.uid).then(function(t){o.hasActiveVouchers=t.data,o.hasActiveVouchers&&!o.multiVenueCurrentState&&o.cssService.addClass("show-redeem")}),o.apiService.hasActivePromotionCodes(t.uid).then(function(t){o.hasActivePromotionCodes=t.data,o.hasActivePromotionCodes&&a.promotioncode?o.checkPromotionCode("ALL",a.promotioncode):o.deferredPromotionCode.resolve(null)}),o.trackingService.setRestaurant(t),o.campaignId&&o.trackingService.setCampaign(o.campaignId),o.trackingService.logVisit(o.campaignId,o.guestService.guest,o.widgetToTableLandingEnabled)}),this.multiVenueCurrentState?this.apiService.getMultiVenueGroup(this.multiVenueUid).then(function(t){o.multiVenueGroup=t.data,o.multiVenueGroup?(o.multiVenueHasStripe=o.multiVenueGroup.restaurants.some(function(t){return"Stripe"===t.paymentProvider}),o.setVoucherAndOrderBtnForMulti(),o.cssService.addClass("ft-widget-side"),(o.showVoucherBtn||o.showOrderBtn)&&o.cssService.addClass("ft-vouchers-active")):console.log("Multi venue group not found!"),o.deferredMultiVenueGroup.resolve(o.multiVenueGroup),o.sdkService.call("event",o.getWidgetId(),["ft-widget-ready",{init:!e,widgetUid:o.getWidgetId()}],!0)}):this.apiService.getRestaurant(this.$stateParams.uid,this.$stateParams.culture).then(function(t){o.reloadRestaurant(t.data)})},e.prototype.reloadRestaurant=function(t,e,i){var r=this;void 0===i&&(i=!1),this.noAvailability=!1,this.restaurant=t,this.apiService.getTableLinkForRestaurantAvailability(this.restaurant.uid).then(function(t){r.currentTableLink=t}),this.deferredRestaurant.resolve(this.restaurant),this.widgetToTableLandingEnabled=this.hasFeature("WIDGET2TABLE_PROMOTION")&&this.hasFeature("TABLE_PROMOTIONS")&&this.onMobile,this.widgetToTableLandingEnabled?this.bookView=k.Landing:this.bookView=k.Suggested,this.getRecommendedTickets();for(var o=Math.max(this.restaurant.minPartySize,this.restaurant.minSeating);o<=Math.min(this.restaurant.maxPartySize,this.restaurant.maxSeating);o++)this.peopleArray.push(o);this.sdkService.call("event",this.getWidgetId(),["ft-widget-ready",{init:!e,widgetUid:this.getWidgetId()}],!0),(this.isOption||this.ticketOnly)&&!i||this.findFirstOption().then(function(t){r.setupFirstDate(t)},function(t){t.status=422,r.noAvailability=!0,"book"==r.$state.current.name&&r.cssService.close("Availability")}),this.shouldLoadMultiVenueOnFinish=!!this.$location.search().multivenue},e.prototype.findFirstOption=function(){var i=this,r=this.$q.defer();return this.apiService.getFirstDateTime(this.restaurant,this.dateFromBooking(this.searchParams),this.$translate.getCurrentCulture(),this.searchParams.numberOfPeople,null,this.friendCode,null).then(function(t){var e=t.data;i.waitlistItemLoaded().then(function(t){(moment(e.time).format("YYYY-MM-DD")!=moment(t.date).format("YYYY-MM-DD")||e.minutes>t.untilTime||e.minutes<t.fromTime)&&i.$state.go("waitlistSpotUnavailable",{uid:i.$stateParams.uid,culture:i.$stateParams.culture,waitlistItem:i.$stateParams.waitlistItem})}),r.resolve(e)},function(t){r.reject(t)}),r.promise},e.prototype.setupFirstDate=function(t){var i=this;this.searchParams.numberOfPeople&&this.searchParams.numberOfPeople!=this.booking.numberOfPeople?this.isNumberOfPeopleChanged=!0:this.isNumberOfPeopleChanged=!1,this.searchParams.numberOfPeople=this.booking.numberOfPeople=t.partySize,this.selectedArea=t.area,this.showAreaToGuest=t.showAreaToGuest,this.setParams(t,!0),this.$rootScope.$broadcast("searchReady"),this.apiService.getTimesForDay(this.restaurant,new Date(this.dateFromBooking(this.searchParams)),this.searchParams.numberOfPeople).then(function(t){i.times=t.data});this.$rootScope.$watch(function(){return i.searchParams.bookingDate},function(t,e){e!==t&&i.apiService.getTimesForDay(i.restaurant,new Date(i.dateFromBooking(i.searchParams)),i.searchParams.numberOfPeople).then(function(t){i.times=t.data||[];var e=i.times.filter(function(t){return"UNAVAILABLE"!=t.status&&"WAITLIST"!=t.status}),t=i.getClosestTime(e,i.searchParams.bookingTime);null!=t?i.setParams(t,!1):(e=i.times.filter(function(t){return"UNAVAILABLE"!=t.status}),null!=(t=i.getClosestTime(e,i.searchParams.bookingTime))?i.setParams(t,!1):i.setParams(e[0],!1))})},!1),this.$rootScope.$watch(function(){return i.searchParams.numberOfPeople},function(t,e){e!==t&&(i.isNumberOfPeopleChanged=!0,i.apiService.getFirstDateTime(i.restaurant,i.dateFromBooking(i.searchParams),i.$translate.getCurrentCulture(),i.searchParams.numberOfPeople).then(function(t){t=t.data;t&&i.setParams(t,!0)}))},!1),this.$rootScope.$watch(function(){return i.searchParams},function(t,e){e!==t&&i.searchTickets()},!0),this.$interval(function(){var t;c.Helpers.DateHelper.getRestaurantNow(i.restaurant)>new Date(i.dateFromBooking(i.searchParams))&&((t=(t=i.times.map(function(t){return t.timeString}))[t.indexOf(i.searchParams.bookingTime)+1])?(i.searchParams.bookingTime&&i.searchParams.bookingTime!=t?i.isSearchTimeChanged=!0:i.isSearchTimeChanged=!1,i.searchParams.bookingTime=t):i.apiService.getFirstDateTime(i.restaurant,i.dateFromBooking(i.searchParams),i.$translate.getCurrentCulture(),i.searchParams.numberOfPeople).then(function(t){t=t.data;i.setParams(t,!0)}))},1e4)},e.prototype.getClosestTime=function(t,e){if(!t)return null;if(0===t.length)return null;var i=t.filter(function(t){return moment(t.time).format("HH:mm")===e});if(0<i.length)return i[0];for(var r,o=this.restaurant.timeslotSize,n=1,s=!1,a=!1;;){if(r=moment(e,"HH:mm").add("minutes",o*n).format("HH:mm"),!s)if("00:00"!==r){if(0<(i=t.filter(function(t){return moment(t.time).format("HH:mm")===r})).length)return i[0]}else s=!0;if(r=moment(e,"HH:mm").subtract("minutes",o*n).format("HH:mm"),!a)if("07:00"<=r){if(0<(i=t.filter(function(t){return moment(t.time).format("HH:mm")===r})).length)return i[0]}else a=!0;switch(o){case 15:if(67<n)return null;break;case 30:if(33<n)return null;break;case 60:if(16<n)return null}n++}},e.prototype.multiVenueGroupLoaded=function(){return this.deferredMultiVenueGroup.promise},e.prototype.restaurantLoaded=function(){return this.deferredRestaurant.promise},e.prototype.waitlistItemLoaded=function(){return this.deferredWaitlistItem.promise},e.prototype.promotionCodeLoaded=function(){return this.deferredPromotionCode.promise},e.prototype.setParams=function(t,e){e&&(this.searchParams.bookingDate&&!moment(this.searchParams.bookingDate).isSame(t.time,"day")?this.isSearchDateChanged=!0:this.isSearchDateChanged=!1,this.searchParams.bookingDate=t.time),this.searchParams.bookingTime&&this.searchParams.bookingTime!=t.timeString?this.isSearchTimeChanged=!0:this.isSearchTimeChanged=!1,this.searchParams.bookingTime=t.timeString,this.searchParams.short="SHORT"===t.status||t.showEndTime,this.searchParams.bookingDuration="SHORT"===t.status||t.showEndTime?t.maxDuration:0,this.searchParams.showAreaToGuest=t.showAreaToGuest,this.selectedArea=t.area,this.showAreaToGuest=t.showAreaToGuest},e.prototype.setBookingTimes=function(t,e){e&&(this.booking.bookingDate=t.time,this.waitlistItem.date=t.time),this.booking.bookingTime=t.timeString,this.booking.short="SHORT"===t.status||t.showEndTime,this.booking.bookingDuration="SHORT"===t.status||t.showEndTime?t.maxDuration:0,this.waitlistItem.fromTime=c.Helpers.DateHelper.minutesFromTime(t.timeString),this.waitlistItem.untilTime=c.Helpers.DateHelper.minutesFromTime(t.timeString),this.waitlistItem.sendNotifications=t.waitlistAutoNotify,this.selectedArea=t.area,this.showAreaToGuest=t.showAreaToGuest},e.prototype.bookingUntilTime=function(t){var e=this.searchParams;if(e){var i=e.bookingTime.split(":"),i=moment(e.bookingDate).hour(parseInt(i[0])).minute(parseInt(i[1]));return 24===this.restaurant.timeFormat?moment(i).add("m",t).format("H:mm"):moment(i).add("m",t).format("h:mm A")}},e.prototype.setColor=function(t){this.cssService.setStyle('.table-handoff-wrapper, table-handoff-bar, .ticket-search, .widget-content.-multi, .summaryButton, .choice-input [type="radio"]:checked, .choice-input [type="checkbox"]:checked, .choice-input [type="radio"]:hover, .choice-input [type="checkbox"]:hover, .redeem-btn.primary, .selected-indicator, ._cartQuantity, .takeawayCart ._cartToggle ._cartActions .large-button.cart-button.primary, .add-option .button, .choice-input:after, .sold-out-notify > div, ._waitlist-icon, .timeline .dropdown-holder .time-dropdown > div.selected, .timeline .timeslot-wrapper li.selected, .shop-message:before, .options-header ._option-select a.selected, .show-map .button, .quantity-indicator, .order-summary .large-button, ._select-day .button, .availability-message, .selected-voucher-wrap, .redeem .redeem-wrapper .continue-active-voucher a.continue-voucher-btn, .checkout-summary .checkout-total .redeem-row .button, a.large-button.accent, .redeem-box a.redeem-btn, .vouchers-wrapper .vouchers-intro, input.checkbox:after, .dp-calendar-wrapper .dp-calendar-body .dp-calendar-day a.date-selected:not(.date-past):not(.other-month):after, .widget-footer, .voucher-info a.button, .step-option.selected, .payment-methods .method.selected, .widget-footer .vouchers-footer, .ticket-search-button a span, a.error-btn, .ft-w-recommended-0 .suggested .widget-content, .tooltip .select-btn, table.calendar-days tbody tr td.selected .span-wrap:after, .month-start, .proceed-btn .large-button, .widget-header,.book-landing,.ticket-checkout-button a,.ticket .ticket-filter, .ticket-tag span, .date-dropdown .large-button, .payment-button, .step-indicator span, .checkout-intro .area-checkout, [type="radio"]:checked, [type="checkbox"]:checked, .ft-interact .ft-interact-wrapper .ft-actions-wrap a .ft-promote-label span, .finish-screen .finish-wrapper .finish-footer a.button.primary',"background",t),this.cssService.setStyle(".sold-out-notify, .takeawayProduct, .error-content-wrapper p a, .time-dropdown .dropdown-wrapper .time-option:hover, .time-dropdown .dropdown-wrapper .time-option.time-selected, .people-dropdown .dropdown-wrapper .persons-option:hover, .filtered-bottom-bar .end-time span","color",t),this.cssService.setStyle("._finish-icon svg, .widget-footer .about-tickets .creator a svg, .ft-interact .ft-interact-wrapper .ft-symbol a svg, .finish-screen .finish-wrapper .status-icon svg.gift-card-icon","fill",t),this.cssService.setStyle("input.summaryInput:focus, .input:focus, .textarea:focus,.takeawayProduct.-product-selected, .voucher-item.order-product.-product-selected, .step-options .step-option.selected, .checkout-summary .checkout-total .redeem-row input:focus, .billing .billing-type-inputs input:focus, .billing .billing-type-inputs textarea:focus, .payment-methods .method:hover, .payment-methods .method.selected, .time-dropdown .dropdown-wrapper .time-option:hover,.time-dropdown .dropdown-wrapper .time-option.selected, .time-dropdown .dropdown-wrapper .time-option.time-selected, .people-dropdown .dropdown-wrapper .persons-option:hover, .people-dropdown .dropdown-wrapper .persons-option.selected","border-color",t);t=this.cssService.getHexBrightness(t);t<10&&this.cssService.addClass("dark"),220<t&&this.cssService.addClass("light")},e.prototype.searchTickets=function(){var e=this,i=this.$q.defer();return this.searchParams.bookingDate?(this.searching=!0,this.apiService.searchTickets(this.restaurant,new Date(this.dateFromBooking(this.searchParams)),this.searchParams.numberOfPeople,this.friendCode,this.voucher?this.voucher.code:"").then(function(t){e.result=t.data,i.resolve(t.data),e.$timeout(function(){e.searching=!1},300)})):i.resolve(new Array),i.promise},e.prototype.getRecommendedTickets=function(){var e=this;this.recommendedTickets=[],this.apiService.getRecommendedTickets(this.restaurant).then(function(t){e.recommendedTickets=t.data,e.multiVenueCurrentState||(e.recommendedTickets.length<4?e.cssService.addClass("ft-w-recommended-"+e.recommendedTickets.length):e.cssService.addClass("ft-w-recommended-full"))})},e.prototype.dateFromBooking=function(t){if(t.bookingTime){var e=t.bookingTime.split(":");return moment(t.bookingDate).hour(parseInt(e[0])).minute(parseInt(e[1])).toISOString()}},e.prototype.getLinkToFormitableLandingPage=function(){var t=this.webUrl+"/welcome?source-id=2448";return this.restaurant&&(t+="&ft-restaurant="+this.restaurant.uid),t},e.prototype.applePayEligible=function(){return window.ApplePaySession&&window.ApplePaySession.canMakePayments()},e.prototype.triggerBookingIntent=function(){var e=this,i=this.$q.defer();return!this.bookingIntentTriggered&&this.widgetToTableLandingEnabled&&this.guestService.hasGuestData()?this.apiService.sendBookingIntent(this.restaurant.uid,this.guestService.guest.email,this.dateFromBooking(this.searchParams),this.searchParams.numberOfPeople).then(function(t){e.bookingIntentTriggered=!0,i.resolve(!0)}):i.resolve(!1),i.promise},e.prototype.backToMultiVenue=function(){this.multiVenue?this.reinitializeMultiVenueWidget(!0):history.back()},e.prototype.home=function(){var t;this.reopen&&(this.shouldLoadMultiVenueOnFinish&&((t=new URLSearchParams(this.originalSearchParams)).set("paymentProvider","Stripe"),window.location.href="/side/"+this.$translate.getCurrentCulture()+"/"+this.originalSearchParams.multivenue+"/multi?"+t.toString()),this.reset(),this.initialize(this.originalSearchParams,!0,!1,this.multiVenue),this.multiVenue?this.reinitializeMultiVenueWidget(!1):this.$state.go("book",{uid:this.$stateParams.uid,culture:this.$stateParams.culture}))},e.prototype.reinitializeRestaurantWidget=function(e,i,r){var o=this;this.reset(),this.initialize(this.originalSearchParams,!1,!0),this.multiVenueLanguage!==r?this.$translate.getApiPromise(i,r).then(function(t){o.$state.go(e,{uid:i,culture:r})}):this.$state.go(e,{uid:i,culture:r})},e.prototype.reinitializeMultiVenueWidget=function(t){var e=this;this.resetClassesForMulti(t),this.multiVenueCurrentState=!0,this.multiVenueLanguage===this.$stateParams.culture&&this.$state.go("multi",{uid:this.multiVenueUid,culture:this.multiVenueLanguage}),this.$translate.getApiPromise(this.multiVenueUid,this.multiVenueLanguage).then(function(t){e.$state.go("multi",{uid:e.multiVenueUid,culture:e.multiVenueLanguage})})},e.prototype.resetClassesForMulti=function(t){this.cssService.removeAllClasses(null,!1),this.cssService.addClass("ft-widget-side"),this.cssService.addClass("ft-w-page-multi"),(this.showVoucherBtn||this.showOrderBtn)&&this.cssService.addClass("ft-vouchers-active"),t&&this.cssService.addClass("ft-open")},e.prototype.setVoucherAndOrderBtnForMulti=function(){this.showVoucherBtn=this.multiVenueGroup.restaurants.some(function(t){return t.live&&!0===t.giftVouchersEnabled}),this.showOrderBtn=this.multiVenueGroup.restaurants.some(function(t){return t.live&&!0===t.takeawayEnabled})},e.prototype.resetClassesForRestaurant=function(){this.cssService.removeAllClasses(null,!1),this.cssService.addClass("ft-widget-side"),this.cssService.addClass("ft-open")},e.prototype.reset=function(){this.peopleArray=[],this.result=[];var t=this.hasFeature("WIDGET2TABLE_PROMOTION");this.bookView=t?k.Landing:k.Suggested,this.booking=new w.Booking,this.booking.numberOfPeople=2,this.booking.culture=this.$translate.getCurrentCulture(),this.searchParams=new w.Search,this.searchParams.numberOfPeople=2},e.prototype.getIsNumberOfPeopleChanged=function(){return this.isNumberOfPeopleChanged},e.prototype.setIsNumberOfPeopleChanged=function(){this.isNumberOfPeopleChanged=!0},e.prototype.getIsSearchDateChanged=function(){return this.isSearchDateChanged},e.prototype.setIsSearchDateChanged=function(){this.isSearchDateChanged=!0},e.prototype.getIsSearchTimeChanged=function(){return this.isSearchTimeChanged},e.prototype.setIsSearchTimeChanged=function(){this.isSearchTimeChanged=!0},e.prototype.resetSearchParamChangeFlags=function(){this.isNumberOfPeopleChanged=!1,this.isSearchDateChanged=!1,this.isSearchTimeChanged=!1},e.prototype.trackNavAction=function(t,e){return this.trackingService.logNavAction(t,this.campaignId,this.guestService.guest,e)},e.$inject=["settings","$translate","$q","$transitions","$localStorage","$state","$stateParams","$rootScope","$timeout","$interval","widgetUrl","$location","apiService","cssService","sdkService","voucherService","webUrl","campaignService","trackingService","guestService"],e);function e(t,e,i,r,o,n,s,a,c,u,d,l,h,p,m,g,f,v,S,y){this.settings=t,this.$translate=e,this.$q=i,this.$transitions=r,this.$localStorage=o,this.$state=n,this.$stateParams=s,this.$rootScope=a,this.$timeout=c,this.$interval=u,this.widgetUrl=d,this.$location=l,this.apiService=h,this.cssService=p,this.sdkService=m,this.voucherService=g,this.webUrl=f,this.campaignService=v,this.trackingService=S,this.guestService=y,this.reopen=!0,this.widgetToTableLandingEnabled=!1,this.source="Widget",this.isNumberOfPeopleChanged=!1,this.isSearchDateChanged=!1,this.isSearchTimeChanged=!1,this.bookingIntentTriggered=!1,this.onMobile=!1,this.peopleArray=[],this.result=[],this.bookView=k.Suggested,this.booking=new w.Booking,this.booking.numberOfPeople=2,this.booking.culture=this.$translate.getCurrentCulture(),this.waitlistItem=new w.WaitlistItem,this.waitlistItem.culture=this.$translate.getCurrentCulture(),this.searchParams=new w.Search,this.deferredMultiVenueGroup=this.$q.defer(),this.deferredRestaurant=this.$q.defer(),this.deferredWaitlistItem=this.$q.defer(),this.deferredPromotionCode=this.$q.defer(),this.noAvailability=!1,this.initialize()}w.WidgetService=t})((t=c.Widget||(c.Widget={})).Side||(t.Side={}))}(FT=FT||{}),angular.module("widgetSide").service("widgetService",FT.Widget.Side.WidgetService);